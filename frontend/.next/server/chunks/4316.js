"use strict";exports.id=4316,exports.ids=[4316],exports.modules={9036:(e,t,i)=>{i.d(t,{m:()=>o});var a=i(19816),r=i(84164);let n=`
You are the AEON Scriptwriter Agent for TikTok-optimized, cinematic, chronological videos.

TASK: Write a 1-minute video script and a detailed scene list for the following topic:
[TARGET TOPIC AND STYLE INJECTED HERE]

Output only JSON with this exact format:
{
  "narration": "<60-second narration, with hooks in first and last line. Chronological, no filler.>",
  "scenes": [
    {
      "scene_number": 1,
      "function": "Hook",
      "timestamp": "0-4s",
      "visual": "Describe first visual/camera/angle/movement",
      "audio": "Relevant background/foley/transition audio",
      "overlay": "TikTok text/font/emoji overlays",
      "transition": "First-frame freeze, pop, or viral effect",
      "text_on_screen": "Short, bold, TikTok-native text"
    },
    {
      "scene_number": 2,
      "function": "World Setup",
      "timestamp": "4-8s",
      "visual": "...",
      "audio": "...",
      "overlay": "...",
      "transition": "...",
      "text_on_screen": "..."
    }
    // continue up to scene 10‚Äì12 (ending with Resolution/CTA)
  ]
}

Rules:
- Scenes MUST be in correct narrative order: Hook ‚Üí Setup ‚Üí Conflict ‚Üí Escalation ‚Üí Climax ‚Üí Resolution ‚Üí CTA.
- Each scene MUST have all schema fields and escalate the story.
- No summaries, no bullet lists, no non-JSON output. If you can't follow, throw an error and retry.
`;async function o(e,t){let i=new a.z4({apiKey:process.env.OPENAI_API_KEY||""}),o=n.replace("[TARGET TOPIC AND STYLE INJECTED HERE]",`${e} in the style of ${t}`),s=0,l=null,c=null;for(;s<3&&!l;)try{let e=((await i.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are a disciplined cinematic script generator for TikTok and AEON."},{role:"user",content:o}],max_tokens:1200,temperature:.7})).choices[0].message.content||"").match(/\{[\s\S]*\}/);if(!e)throw Error("No JSON block found in LLM output.");if(l=JSON.parse(e[0]),!(0,r.j)(l))throw Error("Output does not match required cinematic schema.");return l}catch(e){if(s+=1,c=e,s>=3)throw Error(`ScriptWriterAgent failed after 3 attempts: ${e}`)}throw c||Error("Unknown failure in ScriptWriterAgent.")}},10609:(e,t,i)=>{i.d(t,{h:()=>s});var a=i(97478),r=i(79748),n=i(33873),o=i.n(n);class s{async saveFile(e,t,i={}){console.log(`üíæ StorageManager: Saving ${e}`);let a={...this.defaultOptions,...i};try{let i=await this.saveToProvider(e,t,a);if(i.success)return console.log(`‚úÖ StorageManager: File saved successfully to ${i.provider}`),i.url;throw Error(i.error||"File save failed")}catch(i){if(console.error("‚ùå StorageManager error:",i),"local"!==a.provider)return console.log("\uD83D\uDD04 StorageManager: Trying local fallback..."),this.saveToLocal(e,t);throw i}}async saveFiles(e,t={}){console.log(`üì¶ StorageManager: Batch saving ${e.length} files`);let i=[],a=[];for(let r of e)try{let e=await this.saveFile(r.filename,r.data,{...t,...r.options});i.push(e)}catch(e){console.error(`Failed to save ${r.filename}:`,e),a.push(`${r.filename}: ${e instanceof Error?e.message:"Unknown error"}`)}return a.length>0&&console.warn(`‚ö†Ô∏è StorageManager: ${a.length} files failed to save:`,a),i}async deleteFile(e,t){console.log(`üóëÔ∏è StorageManager: Deleting file from ${t||"auto-detect"}`);try{switch(t||(t=this.detectProvider(e)),t){case"vercel":await (0,a.yH)(e);break;case"supabase":await this.deleteFromSupabase(e);break;case"local":await this.deleteFromLocal(e);break;default:throw Error(`Unsupported provider: ${t}`)}return console.log(`‚úÖ StorageManager: File deleted successfully`),!0}catch(e){return console.error("‚ùå StorageManager delete error:",e),!1}}async listFiles(e,t="vercel"){console.log(`üìã StorageManager: Listing files from ${t}`);try{switch(t){case"vercel":return this.listFromVercel(e);case"supabase":return this.listFromSupabase(e);case"local":return this.listFromLocal(e);default:throw Error(`Unsupported provider: ${t}`)}}catch(e){return console.error("‚ùå StorageManager list error:",e),[]}}async getFileInfo(e){try{let t=this.detectProvider(e);return{name:o().basename(e),url:e,size:0,created_at:new Date().toISOString(),content_type:"application/octet-stream",provider:t}}catch(e){return console.error("Failed to get file info:",e),null}}async saveToProvider(e,t,i){let a=Buffer.isBuffer(t)?t:Buffer.from(t);switch(i.provider){case"vercel":return this.saveToVercel(e,a,i);case"supabase":return this.saveToSupabase(e,a,i);case"local":return this.saveToLocalStorage(e,a,i);default:throw Error(`Unsupported provider: ${i.provider}`)}}async saveToVercel(e,t,i){try{let r=await (0,a.yJ)(e,t,{access:i.public_access?"public":"private",contentType:i.content_type,addRandomSuffix:!1});return{success:!0,url:r.url,size:t.length,provider:"vercel",metadata:{downloadUrl:r.downloadUrl,pathname:r.pathname}}}catch(e){return{success:!1,url:"",size:0,provider:"vercel",error:e instanceof Error?e.message:"Unknown error"}}}async saveToSupabase(e,t,i){return{success:!1,url:"",size:0,provider:"supabase",error:"Supabase storage removed - use Vercel Blob or local storage"}}async saveToLocalStorage(e,t,i){try{let i=o().resolve(process.cwd(),"output");await (0,r.mkdir)(i,{recursive:!0});let a=o().join(i,e);return await (0,r.writeFile)(a,t),{success:!0,url:`/output/${e}`,size:t.length,provider:"local",metadata:{path:a}}}catch(e){return{success:!1,url:"",size:0,provider:"local",error:e instanceof Error?e.message:"Unknown error"}}}async saveToLocal(e,t){let i=o().resolve(process.cwd(),"output");await (0,r.mkdir)(i,{recursive:!0});let a=o().join(i,e);return await (0,r.writeFile)(a,t),`/output/${e}`}async deleteFromSupabase(e){throw Error("Supabase storage removed - use Vercel Blob or local storage")}async deleteFromLocal(e){let t=o().basename(e),i=o().resolve(process.cwd(),"output",t);await (0,r.unlink)(i)}async listFromVercel(e){let{blobs:t}=await (0,a.p_)({prefix:e});return t.map(e=>({name:e.pathname,url:e.url,size:e.size,created_at:e.uploadedAt.toISOString(),content_type:e.contentType||"application/octet-stream",provider:"vercel"}))}async listFromSupabase(e){return[]}async listFromLocal(e){return[]}detectProvider(e){return e.includes("blob.vercel-storage.com")?"vercel":"local"}async getStorageStats(){let e={total_files:0,total_size:0,by_provider:{}};for(let t of["vercel","local"])try{let i=await this.listFiles(void 0,t),a={files:i.length,size:i.reduce((e,t)=>e+t.size,0)};e.by_provider[t]=a,e.total_files+=a.files,e.total_size+=a.size}catch(i){console.error(`Failed to get stats for ${t}:`,i),e.by_provider[t]={files:0,size:0}}return e}constructor(){this.defaultOptions={provider:"vercel",public_access:!0,content_type:"application/octet-stream"}}}},12181:(e,t,i)=>{i.d(t,{c:()=>h});var a=i(97478),r=i(79646),n=i(28354),o=i(33873),s=i.n(o),l=i(79748),c=i.n(l),d=i(63874);class u{async trackTransitionUsage(e){try{let t={transition_id:e.transitionId,project_id:e.projectId,user_id:e.userId,video_id:e.videoId,usage_count:1,viral_score_impact:e.viralScoreImpact||0,retention_impact:e.retentionImpact||0,engagement_boost:e.engagementBoost||0,beat_synced:e.beatSynced||!1,sync_accuracy:e.syncAccuracy,processing_time_ms:e.processingTimeMs,gpu_accelerated:e.gpuAccelerated||!1},{error:i}=await this.supabase.from("transition_analytics").insert(t);if(i)throw i;console.log(`üìä Tracked transition usage: ${e.transitionId}`)}catch(e){throw console.error("Failed to track transition usage:",e),e}}async getTransitionMetrics(e){try{let{data:t,error:i}=await this.supabase.from("transition_analytics").select("*").eq("transition_id",e);if(i)throw i;if(!t||0===t.length)return{transitionId:e,totalUsage:0,avgViralScoreImpact:0,avgRetentionImpact:0,avgEngagementBoost:0,avgProcessingTime:0,gpuUsageRate:0,beatSyncRate:0,lastUsed:new Date};let a=t.reduce((e,t)=>e+t.usage_count,0),r=t.reduce((e,t)=>e+(t.viral_score_impact||0),0)/t.length,n=t.reduce((e,t)=>e+(t.retention_impact||0),0)/t.length,o=t.reduce((e,t)=>e+(t.engagement_boost||0),0)/t.length,s=t.reduce((e,t)=>e+(t.processing_time_ms||0),0)/t.length,l=t.filter(e=>e.gpu_accelerated).length/t.length,c=t.filter(e=>e.beat_synced).length/t.length,d=new Date(Math.max(...t.map(e=>new Date(e.created_at).getTime())));return{transitionId:e,totalUsage:a,avgViralScoreImpact:r,avgRetentionImpact:n,avgEngagementBoost:o,avgProcessingTime:s,gpuUsageRate:l,beatSyncRate:c,lastUsed:d}}catch(e){throw console.error("Failed to get transition metrics:",e),e}}async getViralScoreAnalysis(e){try{let t=this.supabase.from("transition_analytics").select(`
          transition_id,
          viral_score_impact,
          retention_impact,
          engagement_boost,
          transitions!inner(name, category, viral_score)
        `),{data:i,error:a}=await t;if(a)throw a;if(!i||0===i.length)return[];let r=i.reduce((e,t)=>{let i=t.transition_id;return e[i]||(e[i]=[]),e[i].push(t),e},{});return Object.entries(r).map(([t,i])=>{let a=i.reduce((e,t)=>e+(t.viral_score_impact||0),0)/i.length,r=i.filter(e=>(e.viral_score_impact||0)>0).length/i.length,n=i.reduce((e,t)=>e+(t.retention_impact||0),0)/i.length,o=i.reduce((e,t)=>e+(t.engagement_boost||0),0)/i.length;return{transitionId:t,contentType:e||"general",avgViralScore:a,successRate:r,recommendationScore:.4*a+.3*n+.3*o}}).sort((e,t)=>t.recommendationScore-e.recommendationScore)}catch(e){throw console.error("Failed to get viral score analysis:",e),e}}async getTopTransitionsForContent(e,t=5){try{return(await this.getViralScoreAnalysis(e)).slice(0,t).map(e=>e.transitionId)}catch(e){return console.error("Failed to get top transitions:",e),["crossfade","zoom_punch","slide"]}}async updateViralScoreImpact(e,t,i,a,r){try{let{data:n,error:o}=await this.supabase.from("transition_analytics").select("id").eq("transition_id",e).eq("project_id",t).order("created_at",{ascending:!1}).limit(1).single();if(o||!n){console.warn("No existing analytics record found to update");return}let{error:s}=await this.supabase.from("transition_analytics").update({viral_score_impact:i,retention_impact:a,engagement_boost:r,updated_at:new Date().toISOString()}).eq("id",n.id);if(s)throw s;console.log(`üìà Updated viral score impact for transition: ${e}`)}catch(e){throw console.error("Failed to update viral score impact:",e),e}}async getTransitionDashboard(e){try{let{data:t,error:i}=await this.supabase.from("transition_analytics").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(100);if(i)throw i;if(!t||0===t.length)return{totalTransitionsUsed:0,avgViralScoreImpact:0,topPerformingTransition:"crossfade",gpuAccelerationRate:0,beatSyncUsage:0,recentActivity:[]};let a=t.reduce((e,t)=>e+t.usage_count,0),r=t.reduce((e,t)=>e+(t.viral_score_impact||0),0)/t.length,n=t.filter(e=>e.gpu_accelerated).length/t.length,o=t.filter(e=>e.beat_synced).length/t.length,s=t.reduce((e,t)=>{let i=t.transition_id;return e[i]||(e[i]={totalImpact:0,count:0}),e[i].totalImpact+=t.viral_score_impact||0,e[i].count+=1,e},{}),l=Object.entries(s).map(([e,t])=>({id:e,avgImpact:t.totalImpact/t.count})).sort((e,t)=>t.avgImpact-e.avgImpact)[0]?.id||"crossfade";return{totalTransitionsUsed:a,avgViralScoreImpact:r,topPerformingTransition:l,gpuAccelerationRate:n,beatSyncUsage:o,recentActivity:t.slice(0,10)}}catch(e){throw console.error("Failed to get transition dashboard:",e),e}}async batchUpdateAnalytics(e){try{let t=e.map(e=>this.updateViralScoreImpact(e.transitionId,e.projectId,e.viralScore,e.retentionRate,e.engagementRate));await Promise.all(t),console.log(`üìä Batch updated ${e.length} transition analytics`)}catch(e){throw console.error("Failed to batch update analytics:",e),e}}constructor(){this.supabase=(0,d.U)()}}let p=new u,g=(0,n.promisify)(r.exec);class h{async stitchScenes(e,t,i={}){console.log(`üéûÔ∏è StitcherAgent: Combining ${e.length} scenes into ${t}`);let a={...this.defaultOptions,...i},r=Date.now();try{await this.validateSceneFiles(e);let i=await this.processVideoStitching(e,t,a),n=Date.now()-r;return console.log(`‚úÖ StitcherAgent: Video stitched successfully in ${n}ms`),i.output_url}catch(e){throw console.error("‚ùå StitcherAgent error:",e),Error(`Video stitching failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async stitchScenesAdvanced(e,t,i,a=[],r={}){console.log(`üé¨ StitcherAgent: Advanced stitching of ${e.length} scenes`);let n={...this.defaultOptions,...r},o=Date.now();try{if(e.length!==t.length)throw Error("Scenes and URLs count mismatch");let r=await this.createStitchingPlan(e,t,a,n),s=await this.executeStitching(r,i,n),l=Date.now()-o,c=r.transitions?.map(e=>e.type)||[],d=`video_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=`project_${Date.now()}`;return await this.onVideoCompleted(d,u,"user_placeholder",c,l),{success:!0,output_url:s.output_url,file_size:s.file_size,duration:e.reduce((e,t)=>e+t.duration,0),metadata:{scenes_count:e.length,transitions_applied:e.length-1,audio_tracks:a.length,processing_time:l,quality_settings:n,video_id:d,transitions_tracked:c.length}}}catch(e){return console.error("‚ùå StitcherAgent advanced stitching error:",e),{success:!1,output_url:"",file_size:0,duration:0,metadata:{scenes_count:0,transitions_applied:0,audio_tracks:0,processing_time:Date.now()-o,quality_settings:n},error:e instanceof Error?e.message:"Unknown error"}}}async addBackgroundMusic(e,t,i=.3,a=2,r=2){console.log(`üéµ StitcherAgent: Adding background music to video`);try{return(await this.processAudioMixing({video_url:e,music_url:t,volume:i,fade_in:a,fade_out:r})).output_url}catch(e){throw console.error("‚ùå Background music addition failed:",e),e}}async addCaptions(e,t,i="modern"){console.log(`üìù StitcherAgent: Adding captions to video`);try{return(await this.processCaptioning({video_url:e,captions:t,style:i})).output_url}catch(e){throw console.error("‚ùå Caption addition failed:",e),e}}async validateSceneFiles(e){if(!e||0===e.length)throw Error("No scene files provided");for(let t of e)if(!t||"string"!=typeof t)throw Error(`Invalid scene file: ${t}`)}async processVideoStitching(e,t,i){console.log("\uD83D\uDD27 Processing video stitching with FFmpeg..."),console.log(`- Input scenes: ${e.length}`),console.log(`- Output format: ${i.output_format}`),console.log(`- Quality: ${i.quality}`),console.log(`- Resolution: ${i.resolution}`);try{let r=s().join(process.cwd(),"temp","stitching",Date.now().toString());await c().mkdir(r,{recursive:!0});let n=await this.downloadSceneFiles(e,r),o=s().join(r,"concat.txt"),l=n.map(e=>`file '${e}'`).join("\n");await c().writeFile(o,l);let d=s().join(r,t),u=this.buildFFmpegCommand(o,d,i);console.log(`üé¨ Executing FFmpeg: ${u}`);let{stdout:p,stderr:h}=await g(u);h&&!h.includes("frame=")&&console.warn("FFmpeg stderr:",h);let m=(await c().stat(d)).size;console.log(`‚úÖ Video stitched successfully: ${m} bytes`);let f=await c().readFile(d),y=await (0,a.yJ)(t,f,{access:"public",contentType:`video/${i.output_format||"mp4"}`});return await this.cleanupTempFiles(r),{output_url:y.url,file_size:m}}catch(i){console.error("‚ùå FFmpeg stitching failed:",i),console.log("\uD83D\uDD04 Using fallback mock stitching...");let e=Buffer.from("mock video data for development");return{output_url:(await (0,a.yJ)(t,e,{access:"public",contentType:"video/mp4"})).url,file_size:e.length}}}async createStitchingPlan(e,t,i,a){return{scenes:e.map((i,a)=>({...i,url:t[a],start_time:e.slice(0,a).reduce((e,t)=>e+t.duration,0)})),audio_tracks:i,transitions:e.slice(0,-1).map((t,i)=>({type:t.transition,duration:a.transition_duration||.5,start_time:e.slice(0,i+1).reduce((e,t)=>e+t.duration,0)})),output_settings:a}}async executeStitching(e,t,i){return console.log("\uD83C\uDFAC Executing stitching plan..."),console.log(`- Total scenes: ${e.scenes.length}`),console.log(`- Audio tracks: ${e.audio_tracks.length}`),console.log(`- Transitions: ${e.transitions.length}`),await new Promise(e=>setTimeout(e,3e3)),this.processVideoStitching(e.scenes.map(e=>e.url),t,i)}async processAudioMixing(e){return console.log("\uD83C\uDFB5 Processing audio mixing..."),await new Promise(e=>setTimeout(e,1500)),{output_url:`${e.video_url}?audio=mixed`}}async processCaptioning(e){return console.log("\uD83D\uDCDD Processing captions..."),console.log(`- Caption count: ${e.captions.length}`),console.log(`- Style: ${e.style}`),await new Promise(e=>setTimeout(e,1e3)),{output_url:`${e.video_url}?captions=added`}}getSupportedFormats(){return["mp4","mov","webm","avi"]}async downloadSceneFiles(e,t){let i=[];for(let a=0;a<e.length;a++){let r=e[a],n=`scene_${a}.mp4`,o=s().join(t,n);try{if(r.startsWith("http")){let e=await fetch(r);if(!e.ok)throw Error(`Failed to download ${r}: ${e.statusText}`);let t=await e.arrayBuffer();await c().writeFile(o,Buffer.from(t))}else await c().copyFile(r,o);i.push(o),console.log(`üì• Downloaded scene ${a+1}/${e.length}`)}catch(e){throw console.error(`‚ùå Failed to download scene ${a+1}:`,e),e}}return i}buildFFmpegCommand(e,t,i){let a=this.getResolutionDimensions(i.resolution||"1080p"),r=this.getQualitySettings(i.quality||"high"),n=`ffmpeg -f concat -safe 0 -i "${e}"`;return n+=` -c:v libx264 -preset ${r.preset} -crf ${r.crf} -vf "scale=${a.width}:${a.height}" -r ${i.fps||30}`,!1!==i.include_audio?n+=" -c:a aac -b:a 128k":n+=" -an",n+=` -movflags +faststart -y "${t}"`}getResolutionDimensions(e){switch(e){case"720p":return{width:1280,height:720};case"1080p":default:return{width:1920,height:1080};case"4k":return{width:3840,height:2160}}}getQualitySettings(e){switch(e){case"low":return{preset:"fast",crf:28};case"medium":default:return{preset:"medium",crf:23};case"high":return{preset:"slow",crf:18};case"ultra":return{preset:"veryslow",crf:15}}}async trackTransitionUsage(e){try{console.log(`üìä Tracking transition usage: ${e.transitionId} for video ${e.videoId}`),await p.trackTransitionUsage({transitionId:e.transitionId,projectId:e.projectId,userId:e.userId,videoId:e.videoId,viralScoreImpact:e.viralScoreImpact||0,retentionImpact:e.retentionImpact||0,engagementBoost:e.engagementBoost||0,beatSynced:e.beatSynced||!1,syncAccuracy:e.syncAccuracy,processingTimeMs:e.processingTimeMs,gpuAccelerated:e.gpuAccelerated||!1}),console.log(`‚úÖ Transition analytics tracked successfully`)}catch(e){console.error("‚ùå Failed to track transition usage:",e)}}estimateRetentionImpact(e){let t=.5;return["zoom_punch","glitch_blast","viral_cut"].includes(e.type)&&(t+=.3),e.beat_synced&&(t+=.2),Math.max(0,Math.min(1,t+=((e.intensity||1)-1)*.1))}estimateEngagementBoost(e){let t=.3;return["zoom_punch","glitch_blast","viral_cut"].includes(e.type)&&(t+=.4),["3d_flip","cube_rotate"].includes(e.type)&&(t+=.3),e.beat_synced&&(t+=.2),Math.max(0,Math.min(1,t))}async onVideoCompleted(e,t,i,a,r){try{for(let n of(console.log(`üé¨ Video completed: ${e} with ${a.length} transitions`),a))await this.trackTransitionUsage({transitionId:n,projectId:t,userId:i,videoId:e,processingTimeMs:r/a.length,viralScoreImpact:5,retentionImpact:.6,engagementBoost:.4});console.log(`üìà Video completion analytics tracked for ${a.length} transitions`)}catch(e){console.error("‚ùå Failed to track video completion:",e)}}async cleanupTempFiles(e){try{await c().rm(e,{recursive:!0,force:!0}),console.log(`üßπ Cleaned up temp directory: ${e}`)}catch(e){console.warn("‚ö†Ô∏è Failed to cleanup temp files:",e)}}getQualityPresets(){return{web_optimized:{output_format:"mp4",quality:"medium",fps:30,resolution:"720p"},high_quality:{output_format:"mp4",quality:"high",fps:30,resolution:"1080p"},ultra_hd:{output_format:"mp4",quality:"ultra",fps:60,resolution:"4k"},social_media:{output_format:"mp4",quality:"high",fps:30,resolution:"1080p",include_captions:!0}}}constructor(){this.defaultOptions={output_format:"mp4",quality:"high",fps:30,resolution:"1080p",include_audio:!0,include_captions:!1,transition_duration:.5}}}},28695:(e,t,i)=>{i.d(t,{NJ:()=>l,aA:()=>c});var a=i(19816),r=i(14448),n=i(32419),o=i.n(n),s=i(71736);let l=new a.Ay({apiKey:s._.OPENAI_API_KEY}),c=(new r.Ay({apiKey:s._.CLAUDE_API_KEY}),new(o())({auth:s._.REPLICATE_API_TOKEN}));class d{constructor(e){this.baseUrl="https://api.elevenlabs.io/v1",this.apiKey=e}async generateSpeech(e,t="pNInz6obpgDQGcFmaJgB"){let i=await fetch(`${this.baseUrl}/text-to-speech/${t}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:e,model_id:"eleven_monolingual_v1",voice_settings:{stability:.5,similarity_boost:.5}})});if(!i.ok)throw Error(`ElevenLabs API error: ${i.statusText}`);return i.arrayBuffer()}async getVoices(){let e=await fetch(`${this.baseUrl}/voices`,{headers:{"xi-api-key":this.apiKey}});if(!e.ok)throw Error(`ElevenLabs API error: ${e.statusText}`);return e.json()}}new d(s._.ELEVENLABS_API_KEY)},32988:(e,t,i)=>{i.d(t,{s:()=>r});var a=i(28695);class r{async fetchTrendingTopics(e,t=10){console.log("\uD83D\uDD0D TrendsAgent: Fetching trending topics...");try{let i=await this.getMockTrendingTopics(e),a=await this.analyzeTrendsWithAI(i,t);return console.log(`‚úÖ TrendsAgent: Found ${a.length} trending topics`),a}catch(t){return console.error("‚ùå TrendsAgent error:",t),this.getFallbackTrends(e)}}async getTrendsAnalysis(e){console.log("\uD83E\uDDE0 TrendsAgent: Analyzing trends with AI...");try{let t=await this.fetchTrendingTopics(e,20),i=`
        Analyze these trending topics and provide strategic insights for video content creation:
        
        Topics: ${t.join(", ")}
        Niche: ${e||"General"}
        
        Provide:
        1. Top 5 topics with engagement potential
        2. Recommended topic for video creation
        3. Strategic reasoning
        4. Target audience analysis
        5. Content angle suggestions
        
        Format as JSON with topics array, recommended_topic, reasoning, target_audience, and content_angle.
      `,r=await a.NJ.chat.completions.create({model:"gpt-4",messages:[{role:"user",content:i}],temperature:.7,max_tokens:1e3}),n=JSON.parse(r.choices[0].message.content||"{}");return{topics:this.formatTopics(t),recommended_topic:n.recommended_topic||t[0],reasoning:n.reasoning||"AI analysis unavailable",target_audience:n.target_audience||"General audience",content_angle:n.content_angle||"Educational/Entertainment"}}catch(e){return console.error("‚ùå TrendsAgent analysis error:",e),this.getFallbackAnalysis()}}async getTrendsByPlatform(e){return console.log(`üéØ TrendsAgent: Fetching ${e} specific trends...`),({tiktok:["AI productivity hacks","Micro-habits that changed my life","Things I wish I knew at 20","Day in my life as a creator","Unpopular opinions that are true"],youtube:["Complete beginner's guide to AI","I tried viral productivity methods","Building a side hustle in 2024","React to trending topics","Behind the scenes content"],instagram:["Aesthetic daily routines","Before and after transformations","Quick tutorial series","Motivational quote graphics","Product review carousels"],twitter:["Hot takes on industry trends","Thread about lessons learned","Live-tweeting experiences","Controversial but true statements","Quick tips and hacks"]})[e]||this.getFallbackTrends()}async getMockTrendingTopics(e){return({tech:["AI video editing tools","No-code app development","Cryptocurrency market analysis","Remote work productivity","Sustainable technology trends"],lifestyle:["Morning routine optimization","Minimalist living tips","Healthy meal prep ideas","Work-life balance strategies","Self-care practices"],business:["Side hustle ideas 2024","Personal branding strategies","Social media marketing","Passive income streams","Entrepreneurship mindset"],entertainment:["Viral TikTok challenges","Movie review reactions","Gaming highlights","Celebrity news analysis","Pop culture commentary"]})[e]||["AI video generation","TikTok growth hacks","Viral content patterns","Social media trends","Content creator tips","Digital marketing strategies","Personal development","Technology reviews","Lifestyle optimization","Business automation"]}async analyzeTrendsWithAI(e,t){try{let i=`
        From these trending topics, select the top ${t} that would make the most engaging video content:
        
        ${e.join("\n")}
        
        Consider:
        - Viral potential
        - Audience engagement
        - Content creation feasibility
        - Current relevance
        
        Return only the topic titles, one per line.
      `,r=await a.NJ.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"user",content:i}],temperature:.5,max_tokens:300});return r.choices[0].message.content?.split("\n").filter(e=>e.trim()).slice(0,t)||e.slice(0,t)}catch(i){return console.error("AI analysis failed, using original trends:",i),e.slice(0,t)}}formatTopics(e){return e.map((e,t)=>({topic:e,category:"general",popularity:Math.max(100-10*t,10),source:"aggregated",keywords:e.toLowerCase().split(" "),engagement_potential:t<3?"high":t<7?"medium":"low",timestamp:new Date().toISOString()}))}getFallbackTrends(e){return console.log("‚ö†Ô∏è TrendsAgent: Using fallback trends"),["AI video editing","TikTok growth hacks","Viral content patterns","Social media automation","Content creator economy"]}getFallbackAnalysis(){return{topics:this.formatTopics(this.getFallbackTrends()),recommended_topic:"AI video editing",reasoning:"High engagement potential and current relevance",target_audience:"Content creators and marketers",content_angle:"Educational with entertainment value"}}constructor(){this.sources=["google_trends","twitter_trending","youtube_trending","tiktok_discover","reddit_popular"]}}},51519:(e,t,i)=>{i.d(t,{x:()=>g});var a=i(79646),r=i(28354),n=i(33873),o=i.n(n),s=i(79748),l=i.n(s),c=i(97478),d=i(69702),u=i(63874);let p=(0,r.promisify)(a.exec);class g{async editVideo(e){console.log("\uD83C\uDFAC AEON EditingAgent: Starting production pipeline with viral optimization...");let t=Date.now();e.viralOptimization&&"auto"===e.transitions&&(e.transitions=await this.selectOptimalTransition(e));try{this.validateRequest(e),await this.setupTempDirectory();let i=await this.downloadAssets(e),a=await this.processVideo(e,i),r=await this.uploadResult(a),n=await this.generateThumbnail(a);await this.cleanup();let o=Date.now()-t;return console.log(`‚úÖ EditingAgent: Video processed successfully in ${o}ms`),{success:!0,final_video_url:r,thumbnail_url:n,metadata:{duration:await this.getVideoDuration(a),file_size:(await l().stat(a)).size,resolution:this.getResolutionString(e.aspectRatio||"16:9"),fps:30,has_captions:e.addCaptions||!1,has_bgm:!!e.bgmUrl,has_avatar:!!e.avatarOverlayUrl,processing_time:o,clips_processed:e.videoClips.length}}}catch(e){return console.error("‚ùå EditingAgent error:",e),{success:!1,final_video_url:"",metadata:{duration:0,file_size:0,resolution:"1920x1080",fps:30,has_captions:!1,has_bgm:!1,has_avatar:!1,processing_time:Date.now()-t,clips_processed:0},error:e instanceof Error?e.message:"Unknown editing error"}}}validateRequest(e){if(!e.videoClips||0===e.videoClips.length)throw Error("At least one video clip is required");if(e.videoClips.length>20)throw Error("Maximum 20 video clips allowed");if(!["crossfade","cut","slide"].includes(e.transitions))throw Error("Invalid transition type");if(e.aspectRatio&&!["9:16","1:1","16:9"].includes(e.aspectRatio))throw Error("Invalid aspect ratio")}async setupTempDirectory(){try{await l().mkdir(this.tempDir,{recursive:!0}),console.log(`üìÅ Created temp directory: ${this.tempDir}`)}catch(e){throw Error(`Failed to create temp directory: ${e instanceof Error?e.message:"Unknown error"}`)}}async downloadAssets(e){console.log(`üì• Downloading ${e.videoClips.length} video clips...`);let t={videoClips:[]};for(let i=0;i<e.videoClips.length;i++){let a=e.videoClips[i],r=`clip_${i}.mp4`,n=await this.downloadFile(a,r);t.videoClips.push({localPath:n,originalUrl:a,type:"video"})}return e.bgmUrl&&(console.log("\uD83C\uDFB5 Downloading background music..."),t.bgm={localPath:await this.downloadFile(e.bgmUrl,"bgm.mp3"),originalUrl:e.bgmUrl,type:"audio"}),e.avatarOverlayUrl&&(console.log("\uD83D\uDC64 Downloading avatar overlay..."),t.avatar={localPath:await this.downloadFile(e.avatarOverlayUrl,"avatar.png"),originalUrl:e.avatarOverlayUrl,type:"image"}),console.log(`‚úÖ Downloaded all assets successfully`),t}async processVideo(e,t){console.log("\uD83C\uDFAC Building FFmpeg command...");let i=o().join(this.tempDir,`aeon_final_${Date.now()}.mp4`),a=this.aspectRatioConfigs[e.aspectRatio||"16:9"],r=[];t.videoClips.forEach(e=>{r.push(`-i "${e.localPath}"`)}),t.bgm&&r.push(`-i "${t.bgm.localPath}"`),t.avatar&&r.push(`-i "${t.avatar.localPath}"`);let n=this.buildFilterComplex(e,t,a),s=["ffmpeg",...r,"-filter_complex",`"${n}"`,'-map "[vout]"','-map "[aout]"',"-c:v libx264","-pix_fmt yuv420p","-r 30",`-s ${a.width}x${a.height}`,"-c:a aac","-b:a 128k","-shortest","-movflags +faststart","-y",`"${i}"`].join(" ");console.log("\uD83D\uDE80 Executing FFmpeg command..."),console.log(`Command: ${s.substring(0,200)}...`);try{let{stdout:e,stderr:t}=await p(s,{maxBuffer:0xa00000});t&&console.log("FFmpeg stderr:",t.substring(0,500));let a=await l().stat(i);if(0===a.size)throw Error("Output video file is empty");return console.log(`‚úÖ Video processed successfully: ${a.size} bytes`),i}catch(e){throw console.error("‚ùå FFmpeg execution failed:",e),Error(`Video processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}}buildFilterComplex(e,t,i){let a=[],r=t.videoClips.length;for(let t=0;t<r;t++){let n=`[${t}:v]scale=${i.scale},setsar=1`;e.fadeInOut&&(0===t&&(n+=",fade=t=in:st=0:d=0.5"),t===r-1&&(n+=",fade=t=out:st=4.5:d=0.5")),a.push(`${n}[v${t}]`)}let n=this.buildTransitions(e,r,a);if(e.addCaptions){let t=this.buildCaptionText(e.scenePlan);a.push(`[${n}]drawtext=text='${t}':fontsize=40:fontcolor=white:x=(w-tw)/2:y=h-th-50:box=1:boxcolor=black@0.5:boxborderw=5[vcaptions]`),n="vcaptions"}if(e.watermarkText&&(a.push(`[${n}]drawtext=text='${e.watermarkText}':fontsize=30:fontcolor=white:x=w-tw-20:y=20:box=1:boxcolor=black@0.7:boxborderw=3[vwatermark]`),n="vwatermark"),t.avatar){let e=r+ +!!t.bgm;a.push(`[${n}][${e}:v]overlay=W-w-30:30[vout]`)}else a.push(`[${n}]copy[vout]`);return this.buildAudioMix(e,t,r,a),a.join(";")}buildTransitions(e,t,i){if(1===t)return"v0";let a="v0";for(let r=1;r<t;r++){let n=`v${r}`,o=r===t-1?"vtransitions":`vt${r}`;switch(e.transitions){case"crossfade":i.push(`[${a}][${n}]xfade=transition=fade:duration=0.5:offset=${5*r}[${o}]`);break;case"slide":i.push(`[${a}][${n}]xfade=transition=slideright:duration=0.3:offset=${5*r}[${o}]`);break;default:i.push(`[${a}][${n}]concat=n=2:v=1:a=0[${o}]`)}a=o}return a}buildAudioMix(e,t,i,a){let r=[];for(let e=0;e<i;e++)r.push(`[${e}:a]`);if(t.bgm){if(r.length>0){let e=r.join("");a.push(`${e}amix=inputs=${r.length}:duration=shortest[videomix]`),a.push(`[videomix][${i}:a]amix=inputs=2:weights=0.8 0.3:duration=shortest[aout]`)}else a.push(`[${i}:a]copy[aout]`)}else if(r.length>1){let e=r.join("");a.push(`${e}amix=inputs=${r.length}:duration=shortest[aout]`)}else 1===r.length?a.push("[0:a]copy[aout]"):a.push("anullsrc=channel_layout=stereo:sample_rate=48000[aout]")}buildCaptionText(e){return e&&e.scenes&&e.scenes.length>0&&e.scenes[0].narration||"AEON Generated Video"}async downloadFile(e,t){let i=o().join(this.tempDir,t);try{console.log(`üì• Downloading: ${e}`);let a=await fetch(e);if(!a.ok)throw Error(`HTTP ${a.status}: ${a.statusText}`);let r=await a.arrayBuffer();await l().writeFile(i,Buffer.from(r));let n=await l().stat(i);if(0===n.size)throw Error("Downloaded file is empty");return console.log(`‚úÖ Downloaded: ${t} (${n.size} bytes)`),i}catch(t){throw console.error(`‚ùå Download failed for ${e}:`,t),Error(`Failed to download ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}}async uploadResult(e){console.log("\uD83D\uDCE4 Uploading final video to Vercel Blob...");try{let t=await l().readFile(e),i=`aeon-final-${Date.now()}.mp4`,a=await (0,c.yJ)(i,t,{access:"public",contentType:"video/mp4"});return console.log(`‚úÖ Video uploaded: ${a.url}`),a.url}catch(e){throw console.error("‚ùå Upload failed:",e),Error(`Failed to upload video: ${e instanceof Error?e.message:"Unknown error"}`)}}async generateThumbnail(e){console.log("\uD83D\uDCF8 Generating thumbnail...");try{let t=o().join(this.tempDir,`thumbnail_${Date.now()}.jpg`),i=`ffmpeg -i "${e}" -ss 00:00:02 -vframes 1 -y "${t}"`;await p(i);let a=await l().readFile(t);return(await (0,c.yJ)(`thumbnail_${Date.now()}.jpg`,a,{access:"public",contentType:"image/jpeg"})).url}catch(e){return console.error("Thumbnail generation failed:",e),""}}async getVideoDuration(e){try{let t=`ffprobe -v quiet -show_entries format=duration -of csv=p=0 "${e}"`,{stdout:i}=await p(t);return parseFloat(i.trim())||0}catch(e){return console.error("Failed to get video duration:",e),0}}getResolutionString(e){let t=this.aspectRatioConfigs[e];return`${t.width}x${t.height}`}async cleanup(){try{for(let e of(console.log("\uD83E\uDDF9 Cleaning up temporary files..."),await l().readdir(this.tempDir))){let t=o().join(this.tempDir,e);await l().unlink(t)}console.log("‚úÖ Cleanup completed")}catch(e){console.error("‚ö†Ô∏è Cleanup failed:",e)}}async addCaptionsAndEffects(e,t={}){console.log("‚ö†Ô∏è Using legacy addCaptionsAndEffects method - consider upgrading to editVideo()");let i={videoClips:[e],transitions:"cut",fadeInOut:!1,addCaptions:t.add_captions||!1,watermarkText:t.watermark?.text,aspectRatio:"16:9"};try{return(await this.editVideo(i)).final_video_url}catch(t){return console.error("Legacy method failed:",t),`${e}?processed=true`}}getSupportedAspectRatios(){return Object.keys(this.aspectRatioConfigs)}getSupportedTransitions(){return["crossfade","cut","slide"]}async validateVideoFile(e){try{let t=`ffprobe -v quiet -select_streams v:0 -show_entries stream=codec_name -of csv=p=0 "${e}"`,{stdout:i}=await p(t),a=i.trim();return["h264","h265","vp8","vp9","av1"].includes(a.toLowerCase())}catch(e){return console.error("Video validation failed:",e),!1}}async selectOptimalTransition(e){let t=e.contentType||"high_energy",i=e.targetViralScore||7;try{let a=(0,d.gz)(t,i),r=await this.analyzeVideoClips(e.videoClips),n=a[0];return r.hasHighMotion&&i>8?n="zoom_punch":r.hasDigitalContent&&i>7?n="glitch_blast":r.isHighEnergy&&(n="viral_cut"),await this.trackTransitionSelection(n,t,i),n}catch(e){return console.error("Failed to select optimal transition:",e),"crossfade"}}async analyzeVideoClips(e){let t=e.length>3;return{hasHighMotion:t,hasDigitalContent:e.some(e=>e.includes("tech")||e.includes("digital")||e.includes("game")),isHighEnergy:e.some(e=>e.includes("action")||e.includes("fast")||e.includes("intense")),avgBrightness:.7,colorVariance:.5}}async trackTransitionSelection(e,t,i){try{console.log(`üìä Transition selected: ${e} for ${t} content (target viral score: ${i})`)}catch(e){console.error("Failed to track transition selection:",e)}}getCapabilities(){return{maxClips:20,supportedFormats:["mp4","mov","avi","mkv","webm"],supportedTransitions:this.getSupportedTransitions(),supportedAspectRatios:this.getSupportedAspectRatios(),features:["Video concatenation","GPU-accelerated transitions","Viral optimization","Beat-synced transitions","Background music mixing","Avatar overlays","Text watermarks","AI-powered captions","Fade in/out effects","Multiple aspect ratios","Automatic thumbnail generation","Real-time viral score tracking"]}}constructor(){this.tempDir="./temp/editing",this.aspectRatioConfigs={"9:16":{width:1080,height:1920,scale:"1080:1920"},"1:1":{width:1080,height:1080,scale:"1080:1080"},"16:9":{width:1920,height:1080,scale:"1920:1080"}},this.supabase=(0,u.U)()}}},54316:(e,t,i)=>{i.d(t,{e6:()=>v,dK:()=>T});var a=i(9036),r=i(84164),n=i(32988),o=i(66151),s=i(54263),l=i(12181),c=i(51519),d=i(10609),u=i(63874);class p{constructor(){this.supabase=(0,u.U)(),this.SCORE_DECAY_FACTOR=.95,this.MIN_USAGE_THRESHOLD=5,this.CONFIDENCE_THRESHOLD=.7,console.log("\uD83C\uDFAF OptimizerAgent initialized for viral transition optimization")}async optimizeTransitionScores(){console.log("\uD83D\uDE80 Starting transition score optimization...");try{let e=await this.fetchTransitionAnalytics(),t=await this.analyzeTransitionPerformance(e),i=await this.updateViralScores(t),a=await this.generateOptimizationReport(t,i);return console.log(`‚úÖ Optimization complete: ${a.transitionsUpdated} transitions updated`),a}catch(e){throw console.error("‚ùå Optimization failed:",e),e}}async fetchTransitionAnalytics(){let{data:e,error:t}=await this.supabase.from("transition_analytics").select("*").order("created_at",{ascending:!1});if(t)throw Error(`Failed to fetch analytics: ${t.message}`);return e||[]}async analyzeTransitionPerformance(e){let t=this.groupByTransition(e),i=[];for(let[e,a]of Object.entries(t)){let t=this.calculateTransitionPerformance(e,a);i.push(t)}return i.filter(e=>e.totalUsage>=this.MIN_USAGE_THRESHOLD)}groupByTransition(e){return e.reduce((e,t)=>{let i=t.transition_id;return e[i]||(e[i]=[]),e[i].push(t),e},{})}calculateTransitionPerformance(e,t){let i=t.reduce((e,t)=>e+t.usage_count,0),a=this.calculateWeightedAverage(t,"retention_impact"),r=this.calculateWeightedAverage(t,"engagement_boost"),n=this.calculateWeightedAverage(t,"viral_score_impact"),o=new Date(Date.now()-2592e6),s=t.filter(e=>new Date(e.created_at)>o),l=s.length>0?this.calculateWeightedAverage(s,"viral_score_impact"):n;return{transitionId:e,totalUsage:i,avgRetentionImpact:a,avgEngagementBoost:r,avgViralScoreImpact:n,recentPerformance:l,trendDirection:this.calculateTrendDirection(t),confidenceScore:this.calculateConfidenceScore(t)}}calculateWeightedAverage(e,t){if(0===e.length)return 0;let i=Date.now(),a=0,r=0;return e.forEach(e=>{let n=e[t]||0,o=i-new Date(e.created_at).getTime(),s=Math.pow(this.SCORE_DECAY_FACTOR,o/864e5);a+=n*s,r+=s}),r>0?a/r:0}calculateTrendDirection(e){if(e.length<4)return"stable";let t=e.sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()),i=t.slice(0,Math.floor(e.length/2)),a=t.slice(Math.floor(e.length/2)),r=this.calculateSimpleAverage(i,"viral_score_impact"),n=this.calculateSimpleAverage(a,"viral_score_impact")-r;return n>.5?"up":n<-.5?"down":"stable"}calculateSimpleAverage(e,t){return 0===e.length?0:e.reduce((e,i)=>e+(i[t]||0),0)/e.length}calculateConfidenceScore(e){let t=e.length,i=this.calculateTimeSpan(e),a=this.calculateDataConsistency(e);return .4*Math.min(t/50,1)+.3*Math.min(i/30,1)+.3*a}calculateTimeSpan(e){if(e.length<2)return 0;let t=e.map(e=>new Date(e.created_at).getTime()),i=Math.min(...t);return(Math.max(...t)-i)/864e5}calculateDataConsistency(e){if(e.length<2)return 0;let t=e.map(e=>e.viral_score_impact||0),i=t.reduce((e,t)=>e+t,0)/t.length;return Math.max(0,1-Math.sqrt(t.reduce((e,t)=>e+Math.pow(t-i,2),0)/t.length)/10)}async updateViralScores(e){let t=0,i=0;for(let a of e){if(a.confidenceScore<this.CONFIDENCE_THRESHOLD){i++;continue}let e=this.calculateNewViralScore(a);try{let{error:r}=await this.supabase.from("transitions").update({viral_score:e,updated_at:new Date().toISOString()}).eq("id",a.transitionId);r?(console.error(`Failed to update transition ${a.transitionId}:`,r),i++):(t++,console.log(`üìà Updated ${a.transitionId}: viral_score = ${e.toFixed(2)}`))}catch(e){console.error(`Error updating transition ${a.transitionId}:`,e),i++}}return{updated:t,skipped:i}}calculateNewViralScore(e){let{avgRetentionImpact:t,avgEngagementBoost:i,avgViralScoreImpact:a,recentPerformance:r,trendDirection:n,totalUsage:o}=e,s=.4*t+.3*i+.3*a;return Math.max(0,Math.min(10,s=(.7*s+.3*r)*("up"===n?1.1:"down"===n?.9:1)+Math.min(o/1e3,.5)))}async generateOptimizationReport(e,t){let i=e.sort((e,t)=>t.avgViralScoreImpact-e.avgViralScoreImpact),a=i.slice(0,5).map(e=>e.transitionId),r=i.slice(-5).map(e=>e.transitionId),n=e.reduce((e,t)=>e+this.calculateNewViralScore(t),0)/e.length,o=this.generateRecommendations(e);return{transitionsUpdated:t.updated,avgScoreChange:n,topPerformers:a,underperformers:r,recommendations:o}}generateRecommendations(e){let t=[],i=e.filter(e=>e.avgViralScoreImpact>7),a=e.filter(e=>e.avgViralScoreImpact<3),r=e.filter(e=>"up"===e.trendDirection);return i.length>0&&t.push(`Promote high-performing transitions: ${i.slice(0,3).map(e=>e.transitionId).join(", ")}`),a.length>0&&t.push(`Consider deprecating low-performing transitions: ${a.slice(0,3).map(e=>e.transitionId).join(", ")}`),r.length>0&&t.push(`Monitor trending transitions: ${r.slice(0,3).map(e=>e.transitionId).join(", ")}`),t}async getTransitionRankings(e=10){let{data:t,error:i}=await this.supabase.from("transitions").select("id, viral_score").order("viral_score",{ascending:!1}).limit(e);if(i)throw Error(`Failed to fetch rankings: ${i.message}`);return(t||[]).map((e,t)=>({transitionId:e.id,viralScore:e.viral_score||0,rank:t+1}))}async scheduleOptimization(){try{console.log("‚è∞ Running scheduled transition optimization..."),await this.optimizeTransitionScores(),console.log("‚úÖ Scheduled optimization completed")}catch(e){console.error("‚ùå Scheduled optimization failed:",e)}}}let g=new p;class h{constructor(){this.supabase=(0,u.U)(),this.VIRAL_THRESHOLD=7,this.CONFIDENCE_THRESHOLD=.6,this.TREND_WINDOW_DAYS=14,console.log("\uD83D\uDCCA TransitionAnalyzer initialized for viral optimization insights")}async analyzeAllTransitions(){try{let e=await this.fetchAllAnalytics(),t=this.groupByTransition(e),i=[];for(let[e,a]of Object.entries(t)){let t=await this.generateTransitionInsight(e,a);i.push(t)}return i.sort((e,t)=>t.performanceScore-e.performanceScore)}catch(e){throw console.error("Failed to analyze transitions:",e),e}}async analyzeByContentType(e){try{let t=await this.fetchAllAnalytics(),i=[];for(let a of["high_energy","smooth_flow","dramatic","tech_gaming","lifestyle"]){if(e&&a!==e)continue;let r=await this.analyzeContentTypePerformance(a,t);i.push(r)}return i}catch(e){throw console.error("Failed to analyze by content type:",e),e}}async getPerformanceMetrics(){try{let e=await this.fetchAllAnalytics(),t=await this.analyzeAllTransitions(),i=new Set(e.map(e=>e.transition_id)).size,a=this.calculateAverage(e,"processing_time_ms"),r=e.filter(e=>e.gpu_accelerated).length/e.length,n=e.filter(e=>e.beat_synced).length/e.length,o=this.calculateViralScoreDistribution(e),s=t.slice(0,5),l=t.slice(-5).reverse();return{totalTransitions:i,avgProcessingTime:a,gpuAccelerationRate:r,beatSyncUsage:n,viralScoreDistribution:o,topPerformers:s,underperformers:l}}catch(e){throw console.error("Failed to get performance metrics:",e),e}}async generateTransitionInsight(e,t){let i=this.calculatePerformanceScore(t),a=this.calculateViralPotential(t),r=this.calculateAverage(t,"retention_impact"),n=this.calculateAverage(t,"engagement_boost"),o=t.length,s=this.calculateTrendDirection(t),l=this.generateRecommendation(i,a,o);return{transitionId:e,performanceScore:i,viralPotential:a,retentionScore:r,engagementScore:n,usageFrequency:o,trendDirection:s,recommendation:l,confidenceLevel:this.calculateConfidenceLevel(t)}}calculatePerformanceScore(e){let t=this.calculateAverage(e,"viral_score_impact"),i=this.calculateAverage(e,"retention_impact");return .4*t+.3*i+.2*this.calculateAverage(e,"engagement_boost")+.1*Math.min(e.length/100,1)}calculateViralPotential(e){let t=this.getRecentRecords(e,this.TREND_WINDOW_DAYS);if(0===t.length)return 0;let i=this.calculateAverage(t,"viral_score_impact"),a=this.calculateAverage(t,"retention_impact"),r=this.calculateAverage(t,"engagement_boost");return .4*i+.25*a+.25*r+.05*(t.filter(e=>e.gpu_accelerated).length/t.length)+.05*(t.filter(e=>e.beat_synced).length/t.length)}calculateTrendDirection(e){if(e.length<4)return"stable";let t=e.sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()),i=Math.floor(e.length/2),a=t.slice(0,i),r=t.slice(i),n=this.calculateAverage(a,"viral_score_impact"),o=this.calculateAverage(r,"viral_score_impact")-n;return o>.5?"rising":o<-.5?"falling":"stable"}generateRecommendation(e,t,i){return e>8&&t>7?"promote":e<3&&i<10?"deprecate":e>5&&t<5?"optimize":"monitor"}calculateConfidenceLevel(e){let t=Math.min(e.length/50,1);return .4*t+.3*Math.min(this.calculateTimeSpan(e)/30,1)+.3*this.calculateDataConsistency(e)}async analyzeContentTypePerformance(e,t){let i=t.filter((t,i)=>i%5===["high_energy","smooth_flow","dramatic","tech_gaming","lifestyle"].indexOf(e)),a=Object.entries(this.groupByTransition(i)).map(([e,t])=>({id:e,score:this.calculatePerformanceScore(t)})),r=a.sort((e,t)=>t.score-e.score).slice(0,5).map(e=>e.id),n=this.calculateAverage(i,"viral_score_impact"),o=i.reduce((e,t)=>e+t.usage_count,0),s=i.filter(e=>(e.viral_score_impact||0)>this.VIRAL_THRESHOLD).length/i.length,l=this.generateContentTypeRecommendations(e,a);return{contentType:e,topTransitions:r,avgViralScore:n,totalUsage:o,successRate:s,recommendations:l}}generateContentTypeRecommendations(e,t){let i=[],a=t[0],r=t.reduce((e,t)=>e+t.score,0)/t.length;a&&a.score>8&&i.push(`Promote ${a.id} as signature transition for ${e} content`),r<5&&i.push(`Consider developing new transitions optimized for ${e} content`);let n=t.filter(e=>e.score<3);return n.length>0&&i.push(`Review underperforming transitions: ${n.map(e=>e.id).join(", ")}`),i}async fetchAllAnalytics(){let{data:e,error:t}=await this.supabase.from("transition_analytics").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}groupByTransition(e){return e.reduce((e,t)=>{let i=t.transition_id;return e[i]||(e[i]=[]),e[i].push(t),e},{})}calculateAverage(e,t){return 0===e.length?0:e.reduce((e,i)=>e+(i[t]||0),0)/e.length}getRecentRecords(e,t){let i=new Date(Date.now()-864e5*t);return e.filter(e=>new Date(e.created_at)>i)}calculateTimeSpan(e){if(e.length<2)return 0;let t=e.map(e=>new Date(e.created_at).getTime());return(Math.max(...t)-Math.min(...t))/864e5}calculateDataConsistency(e){if(e.length<2)return 0;let t=e.map(e=>e.viral_score_impact||0),i=t.reduce((e,t)=>e+t,0)/t.length;return Math.max(0,1-Math.sqrt(t.reduce((e,t)=>e+Math.pow(t-i,2),0)/t.length)/10)}calculateViralScoreDistribution(e){let t={"0-2":0,"2-4":0,"4-6":0,"6-8":0,"8-10":0};return e.forEach(e=>{let i=e.viral_score_impact||0;i<2?t["0-2"]++:i<4?t["2-4"]++:i<6?t["4-6"]++:i<8?t["6-8"]++:t["8-10"]++}),t}}let m=new h;class f{constructor(e){this.supabase=(0,u.U)(),this.optimizationTimer=null,this.isOptimizing=!1,this.config={enableAutoOptimization:!0,optimizationInterval:60,minDataThreshold:10,confidenceThreshold:.6,enableABTesting:!1},e&&(this.config={...this.config,...e}),console.log("\uD83D\uDD04 PipelineOptimizer initialized with feedback loop"),this.config.enableAutoOptimization&&this.startOptimizationLoop()}startOptimizationLoop(){this.optimizationTimer&&clearInterval(this.optimizationTimer);let e=6e4*this.config.optimizationInterval;this.optimizationTimer=setInterval(async()=>{this.isOptimizing||await this.runOptimizationCycle()},e),console.log(`‚è∞ Optimization loop started (interval: ${this.config.optimizationInterval} minutes)`)}stopOptimizationLoop(){this.optimizationTimer&&(clearInterval(this.optimizationTimer),this.optimizationTimer=null,console.log("‚èπÔ∏è Optimization loop stopped"))}async runOptimizationCycle(){if(this.isOptimizing)throw Error("Optimization cycle already in progress");this.isOptimizing=!0;let e=new Date;try{console.log("\uD83D\uDE80 Starting optimization cycle...");let t=await this.checkDataAvailability();if(!t.hasEnoughData)return console.log(`‚è≥ Insufficient data for optimization (${t.recordCount} < ${this.config.minDataThreshold})`),this.createSkippedReport(e,t.recordCount);let i=await m.analyzeAllTransitions();console.log(`üìä Analyzed ${i.length} transitions`);let a=await g.optimizeTransitionScores();console.log(`üìà Updated ${a.transitionsUpdated} transition scores`),await this.updatePerformanceSummary(i);let r=await this.generatePipelineRecommendations(i);await this.logOptimizationResults(a,i);let n={timestamp:e,transitionsAnalyzed:i.length,scoresUpdated:a.transitionsUpdated,topPerformers:a.topPerformers,recommendations:r,nextOptimization:new Date(Date.now()+6e4*this.config.optimizationInterval)};return console.log("‚úÖ Optimization cycle completed successfully"),n}catch(e){throw console.error("‚ùå Optimization cycle failed:",e),e}finally{this.isOptimizing=!1}}async triggerOptimization(){return console.log("\uD83D\uDD27 Manual optimization triggered"),this.runOptimizationCycle()}async checkDataAvailability(){let{data:e,error:t}=await this.supabase.from("transition_analytics").select("id, created_at").order("created_at",{ascending:!0});if(t)throw Error(`Failed to check data availability: ${t.message}`);let i=e?.length||0;return{hasEnoughData:i>=this.config.minDataThreshold,recordCount:i,oldestRecord:e&&e.length>0?new Date(e[0].created_at):null}}async updatePerformanceSummary(e){for(let t of(console.log("\uD83D\uDCDD Updating performance summary table..."),e)){let e={transition_id:t.transitionId,content_type:"general",total_usage:t.usageFrequency,avg_viral_score:t.viralPotential,avg_retention:t.retentionScore,avg_engagement:t.engagementScore,success_rate:t.viralPotential>7?.8:.4,trend_direction:t.trendDirection,trend_strength:t.confidenceLevel,recommendation:t.recommendation,confidence_score:t.confidenceLevel,last_calculated:new Date().toISOString()},{error:i}=await this.supabase.from("transition_performance_summary").upsert(e,{onConflict:"transition_id,content_type",ignoreDuplicates:!1});i&&console.error(`Failed to update summary for ${t.transitionId}:`,i)}console.log(`‚úÖ Updated performance summary for ${e.length} transitions`)}async generatePipelineRecommendations(e){let t=[],i=e.reduce((e,t)=>e+t.performanceScore,0)/e.length,a=e.filter(e=>e.performanceScore>8),r=e.filter(e=>e.performanceScore<3),n=e.filter(e=>"rising"===e.trendDirection);i<5&&t.push("Overall transition performance is below average - consider reviewing transition library"),a.length>0&&t.push(`Promote high-performing transitions: ${a.slice(0,3).map(e=>e.transitionId).join(", ")}`),r.length>.3*e.length&&t.push("High number of underperforming transitions - consider deprecating or optimizing"),n.length>0&&t.push(`Monitor rising trends: ${n.slice(0,3).map(e=>e.transitionId).join(", ")}`);let o=await m.getPerformanceMetrics();return o.gpuAccelerationRate<.5&&t.push("Consider increasing GPU acceleration usage for better performance"),o.beatSyncUsage<.3&&t.push("Increase beat-synchronized transitions for higher viral potential"),t}async logOptimizationResults(e,t){console.log("\uD83D\uDCCA Optimization Results:",JSON.stringify({optimization_timestamp:new Date().toISOString(),transitions_analyzed:t.length,scores_updated:e.transitionsUpdated,avg_score_change:e.avgScoreChange,top_performers:e.topPerformers,recommendations:e.recommendations,system_performance:await this.getSystemPerformanceMetrics()},null,2))}createSkippedReport(e,t){return{timestamp:e,transitionsAnalyzed:0,scoresUpdated:0,topPerformers:[],recommendations:[`Insufficient data for optimization (${t} records)`],nextOptimization:new Date(Date.now()+6e4*this.config.optimizationInterval)}}async getSystemPerformanceMetrics(){try{let e=await m.getPerformanceMetrics();return{totalTransitions:e.totalTransitions,avgProcessingTime:e.avgProcessingTime,gpuUsageRate:e.gpuAccelerationRate,errorRate:.05}}catch(e){return console.error("Failed to get system metrics:",e),{totalTransitions:0,avgProcessingTime:0,gpuUsageRate:0,errorRate:0}}}getStatus(){return{isRunning:null!==this.optimizationTimer,isOptimizing:this.isOptimizing,config:this.config,nextOptimization:this.optimizationTimer?new Date(Date.now()+6e4*this.config.optimizationInterval):null}}updateConfig(e){this.config={...this.config,...e},this.config.enableAutoOptimization&&!this.optimizationTimer?this.startOptimizationLoop():!this.config.enableAutoOptimization&&this.optimizationTimer&&this.stopOptimizationLoop(),console.log("‚öôÔ∏è Pipeline optimizer configuration updated")}destroy(){this.stopOptimizationLoop(),console.log("\uD83E\uDDF9 Pipeline optimizer destroyed")}}let y=new f;async function w(){console.log("\uD83D\uDD17 Initializing pipeline optimization feedback loop..."),y.startOptimizationLoop();try{let e=await y.triggerOptimization();console.log("‚úÖ Initial optimization completed:",e)}catch(e){console.log("‚è≥ Initial optimization skipped (insufficient data)")}}var _=i(29934);class v{constructor(){this.trendsAgent=new n.s,this.visualGenerator=new o.f,this.parallelVisualGenerator=new s.N,this.stitcher=new l.c,this.editor=new c.x,this.storage=new d.h,this.supabase=createClient(),this.initializeOptimization()}async initializeOptimization(){try{await w(),console.log("\uD83D\uDD04 Pipeline optimization feedback loop initialized")}catch(e){console.error("‚ùå Failed to initialize pipeline optimization:",e)}}async runPipeline(e,t){console.log("\uD83D\uDE80 AEON Pipeline: Starting video generation...");let i=Date.now(),a=[];try{let n;await this.updateProgress("trends",10,"Analyzing trending topics...","TrendsAgent",t);let o=e.topic;if(o||e.custom_script||(o=(await this.trendsAgent.fetchTrendingTopics())[0],a.push("TrendsAgent")),await this.updateProgress("script",25,"Generating compelling script...","ScriptWriterAgent",t),e.custom_script?n={title:`Custom Script - ${o||"Video"}`,description:"Custom user-provided script",total_duration:e.duration||60,target_audience:"general audience",tone:e.style||"conversational",sections:[{type:"body",content:e.custom_script,duration:e.duration||60,visual_cue:"Main content visuals",emotion:"informative"}],hashtags:["#custom"],thumbnail_suggestion:"Custom video thumbnail"}:(n=await this.scriptWriter.generateScript(o,{duration:e.duration,tone:e.style,platform:e.platform}),a.push("ScriptWriterAgent")),await this.updateProgress("scenes",40,"Validating script structure...","ScriptValidator",t),!(0,r.j)(n))throw Error("Generated script does not match expected structure");a.push("ScriptValidator"),await this.updateProgress("generation",60,"Generating video scenes with AI...","ParallelVisualGenerationAgent",t);let l=[];if(n.scenes.length>=10){console.log("\uD83D\uDE80 Using parallel generation for scenes (5 agents \xd7 2 scenes each)");let e=n.scenes.slice(0,10).map(e=>e.visual),i=(0,_.Fr)(),r=n.scenes.slice(0,10).map(e=>({first_frame_image:void 0,aspect_ratio:"16:9",duration:4})),o=await (0,s.Y)(e,5,2,i,r,e=>{let i=Math.floor(60+e.completedScenes/e.totalScenes*25);this.updateProgress("generation",i,`Parallel generation: ${e.completedScenes}/${e.totalScenes} scenes (Agent ${e.currentAgent+1})`,"ParallelVisualGenerationAgent",t)});if(!o.success)throw Error(`Parallel video generation failed: ${o.error}`);l=o.sceneResults.filter(e=>e.success).sort((e,t)=>e.sceneIndex-t.sceneIndex).map(e=>e.videoUrl),a.push("ParallelVisualGenerationAgent"),console.log(`‚úÖ Parallel generation: ${o.sceneResults.filter(e=>e.success).length}/${o.sceneResults.length} scenes successful`),console.log(`üí∞ Total cost: $${o.totalCost.toFixed(2)}`)}else{console.log(`üîÑ Using sequential generation for ${n.scenes.length} scenes`);let t=await this.visualGenerator.generateScenes({scenes:n.scenes,user_id:e.user_id,style:e.style,quality:"high"});if(!t.success)throw Error(`Video generation failed: ${t.error}`);l=t.scenes.filter(e=>e.success).map(e=>e.videoUrl),a.push("VisualGeneratorAgent"),console.log(`‚úÖ Sequential generation: ${t.successfulScenes}/${t.totalScenes} scenes successful`)}await this.updateProgress("stitching",80,"Combining scenes into final video...","StitcherAgent",t);let c=`video_${Date.now()}_${e.user_id}`,d=await this.stitcher.stitchScenes(l,`${c}.mp4`);a.push("StitcherAgent"),await this.updateProgress("editing",90,"Adding captions and final touches...","EditorAgent",t);let u=await this.editor.addCaptionsAndEffects(d,{add_captions:!0,caption_style:"modern",add_effects:!0,color_grading:"cinematic",thumbnail_generation:!0});a.push("EditorAgent"),await this.saveToDatabase(e,n,scenePlan,u),await this.updateProgress("complete",100,"Video generation complete!","Pipeline",t);let p=Date.now()-i;return console.log(`‚úÖ AEON Pipeline: Video generated successfully in ${p}ms`),{success:!0,video_url:u,thumbnail_url:`${u}?thumbnail=true`,script:n,scenes:n.scenes,metadata:{total_duration:n.total_duration,processing_time:p,agents_used:a,quality_score:85,file_size:0xf00000}}}catch(e){return console.error("‚ùå AEON Pipeline error:",e),{success:!1,metadata:{total_duration:0,processing_time:Date.now()-i,agents_used:a,quality_score:0,file_size:0},error:e instanceof Error?e.message:"Unknown pipeline error"}}}async runCustomPipeline(e,t){console.log("\uD83C\uDFAF AEON Pipeline: Running custom pipeline...");let i=Date.now(),a=[];try{let r=0,n=100/6,o=e.custom_script?{content:e.custom_script}:null,l=e.custom_scenes||null;e.skip_trends||e.topic||(await this.updateProgress("trends",r+=n,"Getting trends...","TrendsAgent",t),e.topic=(await this.trendsAgent.fetchTrendingTopics())[0],a.push("TrendsAgent")),e.skip_script||o||(await this.updateProgress("script",r+=n,"Writing script...","ScriptWriterAgent",t),o=await this.scriptWriter.generateScript(e.topic,{duration:e.duration,tone:e.style,platform:e.platform}),a.push("ScriptWriterAgent")),!l&&o&&(await this.updateProgress("scenes",r+=n,"Planning scenes...","ScenePlannerAgent",t),await this.scenePlanner.planScenes(o),l=o.scenes,a.push("ScenePlannerAgent"));let c=`custom_${Date.now()}_${e.user_id}`;await this.updateProgress("generation",r+=n,"Generating scenes...","ParallelVisualGenerationAgent",t);let d=[];if(l&&10===l.length){console.log("\uD83D\uDE80 Custom script: Using parallel generation for 10 scenes");let e=l.map(e=>e.description),t=(0,_.Fr)(),i=l.map(e=>({aspect_ratio:"16:9",duration:Math.min(e.duration,6)})),r=await (0,s.Y)(e,5,2,t,i);if(!r.success)throw Error(`Parallel video generation failed: ${r.error}`);d=r.sceneResults.filter(e=>e.success).sort((e,t)=>e.sceneIndex-t.sceneIndex).map(e=>e.videoUrl),a.push("ParallelVisualGenerationAgent")}else{let t=await this.visualGenerator.generateScenes({scenes:l||[],user_id:e.user_id,style:e.style,quality:"high"});if(!t.success)throw Error(`Video generation failed: ${t.error}`);d=t.scenes.filter(e=>e.success).map(e=>e.videoUrl),a.push("VisualGeneratorAgent")}await this.updateProgress("stitching",r+=n,"Stitching video...","StitcherAgent",t);let u=await this.stitcher.stitchScenes(d,`${c}.mp4`);a.push("StitcherAgent"),await this.updateProgress("editing",r+=n,"Final editing...","EditorAgent",t);let p=await this.editor.addCaptionsAndEffects(u,e.editing_options);a.push("EditorAgent");let g=Date.now()-i;return{success:!0,video_url:p,thumbnail_url:`${p}?thumbnail=true`,script:o,scenes:l,metadata:{total_duration:e.duration||60,processing_time:g,agents_used:a,quality_score:88,file_size:0xc00000}}}catch(e){return console.error("‚ùå Custom Pipeline error:",e),{success:!1,metadata:{total_duration:0,processing_time:Date.now()-i,agents_used:a,quality_score:0,file_size:0},error:e instanceof Error?e.message:"Custom pipeline error"}}}async updateProgress(e,t,i,a,r){let n={stage:e,progress:Math.min(t,100),message:i,agent:a,timestamp:new Date().toISOString()};console.log(`üìä Pipeline Progress: ${t}% - ${i} (${a})`),r&&r(n),await new Promise(e=>setTimeout(e,500))}async saveToDatabase(e,t,i,a){try{let{error:r}=await this.supabase.from("projects").insert({user_id:e.user_id,title:t.title||"Generated Video",description:t.description||"",video_url:a,script_data:t,scene_data:i,status:"completed",created_at:new Date().toISOString()});r?console.error("Database save error:",r):console.log("‚úÖ Pipeline results saved to database")}catch(e){console.error("Database save failed:",e)}}async getPipelineStatus(e){try{let{data:t,error:i}=await this.supabase.from("projects").select("*").eq("id",e).single();if(i)throw i;return t}catch(e){return console.error("Failed to get pipeline status:",e),null}}}async function T(e,t="TikTok/Documentary",i=60,n){console.log(`üé¨ Starting Viral TikTok Pipeline for: "${e}"`);try{console.log("\uD83D\uDCDD Generating viral script...");let i=await (0,a.m)(e,t);if(console.log(`‚úÖ Generated script with ${i.scenes.length} scenes`),console.log("\uD83C\uDFAC Validating script structure..."),!(0,r.j)(i))throw Error("Generated script does not match expected structure");return console.log(`‚úÖ Script validation complete`),{script:i}}catch(e){throw console.error("‚ùå Viral TikTok Pipeline failed:",e),Error(`Pipeline failed: ${e instanceof Error?e.message:"Unknown error"}`)}}},66151:(e,t,i)=>{i.d(t,{f:()=>r});var a=i(71736);class r{async generateScenes(e){console.log(`üé• VisualGeneratorAgent: Generating ${e.scenes.length} scenes for user ${e.user_id}`);let t=Date.now(),i=[];try{this.validateApiKeys();for(let t=0;t<e.scenes.length;t++){let a=e.scenes[t];console.log(`üé¨ Generating scene ${t+1}/${e.scenes.length}: ${a.description.substring(0,50)}...`);try{let r=await this.generateSingleScene(a,t,e);i.push(r),r.success?console.log(`‚úÖ Scene ${t+1} generated successfully: ${r.videoUrl}`):console.error(`‚ùå Scene ${t+1} failed: ${r.error}`)}catch(e){console.error(`‚ùå Scene ${t+1} generation error:`,e),i.push({sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:a.description,videoUrl:"",duration:a.duration,modelUsed:"none",success:!1,error:e instanceof Error?e.message:"Unknown error",processingTime:0})}}let a=Date.now()-t,r=i.filter(e=>e.success).length,n=i.length-r;return console.log(`üéØ VisualGeneratorAgent: Completed ${r}/${i.length} scenes in ${a}ms`),{success:r>0,scenes:i,totalScenes:i.length,successfulScenes:r,failedScenes:n,totalProcessingTime:a,error:n>0?`${n} scenes failed to generate`:void 0}}catch(a){return console.error("‚ùå VisualGeneratorAgent: Critical error:",a),{success:!1,scenes:i,totalScenes:e.scenes.length,successfulScenes:0,failedScenes:e.scenes.length,totalProcessingTime:Date.now()-t,error:a instanceof Error?a.message:"Unknown error"}}}async generateSingleScene(e,t,i){let a=Date.now(),r=this.buildVideoPrompt(e,i.style);console.log(`üé• Generating scene ${t+1} with multi-provider fallback: "${r.substring(0,100)}..."`);let n=this.getProviderPriority(i.preferredModel),o=null;for(let i of n){let n=this.models.find(e=>e.provider===i);if(!n){console.warn(`‚ö†Ô∏è No model found for provider: ${i}`);continue}try{let i;switch(console.log(`üîÑ Attempting scene ${t+1} with ${n.name}`),n.provider){case"replicate":i=await this.generateWithReplicate(n.modelId,r,e.duration);break;case"minimax":i=await this.generateWithMinimax(n.modelId,r,e.duration);break;case"kling":i=await this.generateWithKling(n.modelId,r,e.duration);break;default:throw Error(`Unsupported provider: ${n.provider}`)}let o=Date.now()-a;return console.log(`‚úÖ Scene ${t+1} generated successfully with ${n.name}`),{sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:r,videoUrl:i,duration:e.duration,modelUsed:n.name,success:!0,processingTime:o}}catch(e){console.warn(`‚ö†Ô∏è ${n.name} failed for scene ${t+1}:`,e),o=e instanceof Error?e:Error(`${n.name} generation failed`);continue}}return console.error(`‚ùå Scene ${t+1} failed with all providers`),{sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:r,videoUrl:"",duration:e.duration,modelUsed:"none",success:!1,error:o?.message||"All video generation providers failed",processingTime:Date.now()-a}}getProviderPriority(e){let t=["replicate","minimax","kling"];if(e){let i=this.models.find(t=>t.name.toLowerCase().includes(e.toLowerCase()))?.provider;if(i)return[i,...t.filter(e=>e!==i)]}return t}async generateWithReplicate(e,t,i){let r=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${a._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:e,input:{prompt:t,duration:Math.min(i,10),aspect_ratio:"16:9",fps:30}})});if(!r.ok)throw Error(`Replicate API error: ${r.statusText}`);let n=await r.json();return this.pollReplicatePrediction(n.id)}async pollReplicatePrediction(e){let t=0;for(;t<60;){let i=await fetch(`https://api.replicate.com/v1/predictions/${e}`,{headers:{Authorization:`Token ${a._.REPLICATE_API_TOKEN}`}});if(!i.ok)throw Error(`Replicate polling error: ${i.statusText}`);let r=await i.json();if("succeeded"===r.status)return r.output;if("failed"===r.status)throw Error(`Replicate generation failed: ${r.error}`);await new Promise(e=>setTimeout(e,5e3)),t++}throw Error("Replicate generation timeout")}async generateWithMinimax(e,t,i){console.log(`üé¨ Minimax generation: ${e}, ${t}, ${i}s`);let r=this.getMinimaxReplicateModel(e),n=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${a._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:r,input:{prompt:t,duration:Math.min(i,6),prompt_optimizer:!0,aspect_ratio:"16:9"}})});if(!n.ok)throw Error(`Minimax API error: ${n.statusText}`);let o=await n.json();return this.pollReplicatePrediction(o.id)}async generateWithKling(e,t,i){console.log(`üé¨ Kling generation: ${e}, ${t}, ${i}s`);let r=this.getKlingReplicateModel(e),n=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${a._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:r,input:{prompt:t,duration:Math.min(i,5),aspect_ratio:"16:9",cfg_scale:7.5}})});if(!n.ok)throw Error(`Kling API error: ${n.statusText}`);let o=await n.json();return this.pollReplicatePrediction(o.id)}selectModelForScene(e){return e.energy>=8?this.models.find(e=>e.name.includes("Runway"))||this.models[0]:e.duration>5&&this.models.find(e=>"minimax"===e.provider)||this.models[0]}buildVideoPrompt(e,t){let i=e.description;return e.camera&&(i+=`, ${e.camera}`),e.shotType&&(i+=`, ${e.shotType}`),t&&(i+=`, ${t} style`),i+=", high quality, professional cinematography, 4K"}validateApiKeys(){if(!a._.REPLICATE_API_TOKEN)throw Error("REPLICATE_API_TOKEN is required for video generation");console.log("‚úÖ API keys validated")}constructor(){this.models=[{name:"Runway Gen-3",provider:"replicate",modelId:"runway-ml/runway-gen3-alpha:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",maxDuration:10,aspectRatio:"16:9"},{name:"Stable Video Diffusion",provider:"replicate",modelId:"stability-ai/stable-video-diffusion:3f0457e4619daac51203dedb1a4c069c4c7e0e5e",maxDuration:4,aspectRatio:"16:9"},{name:"Minimax Video-01",provider:"minimax",modelId:"video-01",maxDuration:6,aspectRatio:"16:9"},{name:"Kling v1.6",provider:"kling",modelId:"kling-v1.6-standard",maxDuration:5,aspectRatio:"16:9"},{name:"Luma Dream Machine",provider:"replicate",modelId:"lumalabs/dream-machine:b49c4d9e0d7c4e8b9a8b9c8d9e0f1a2b3c4d5e6f",maxDuration:5,aspectRatio:"16:9"},{name:"Haiper Video",provider:"replicate",modelId:"haiper-ai/haiper-video-v2:c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3",maxDuration:4,aspectRatio:"16:9"}]}}},84164:(e,t,i)=>{i.d(t,{j:()=>a});function a(e){if(!e||"string"!=typeof e.narration||!Array.isArray(e.scenes)||e.scenes.length<8)return!1;for(let t=0;t<e.scenes.length;t++){let i=e.scenes[t];if("number"!=typeof i.scene_number||"string"!=typeof i.function||"string"!=typeof i.timestamp||"string"!=typeof i.visual||"string"!=typeof i.audio||"string"!=typeof i.overlay||"string"!=typeof i.transition||"string"!=typeof i.text_on_screen||i.scene_number!==t+1)return!1;i.function.toLowerCase().includes("escalation"),i.scene_number}let t=e.scenes.map(e=>e.function.toLowerCase());return!!(t.some(e=>e.includes("hook"))&&t.some(e=>e.includes("climax"))&&t.some(e=>e.includes("resolution")||e.includes("cta")))}}};