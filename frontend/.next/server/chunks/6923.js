"use strict";exports.id=6923,exports.ids=[6923],exports.modules={6923:(e,t,i)=>{i.d(t,{e6:()=>c.e6,k6:()=>m,He:()=>h,sg:()=>l,mw:()=>o.m}),i(32988);var o=i(9036);i(66151),i(13064),i(12181),i(51519),i(62841);var a=i(19816),r=i(72289),s=i(71736),n=i(10609);r.Ik({script_id:r.Yj(),hook:r.Ik({text:r.Yj(),duration_seconds:r.ai(),emotion_tags:r.YO(r.Yj()),friction_level:r.ai().min(1).max(10)}),body:r.Ik({text:r.Yj(),duration_seconds:r.ai(),narrative_beats:r.YO(r.Yj()),complexity:r.Yj()}),cta:r.Ik({text:r.Yj(),duration_seconds:r.ai(),cta_type:r.Yj(),engagement_target:r.Yj()}),metadata:r.Ik({pacing:r.Yj(),tone:r.Yj(),total_duration:r.ai(),retention_optimization:r.YO(r.Yj())})});class l{constructor(){this.deepseek=new a.z4({apiKey:s._.DEEPSEEK_API_KEY,baseURL:"https://api.deepseek.com/v1"}),this.openai=new a.z4({apiKey:s._.OPENAI_API_KEY}),this.storage=new n.h("2_script-writer")}async createTikTokScriptAndScene(e,t="engaging",i,o){console.log("\uD83D\uDE80 Starting DeepSeek + OpenAI unified pipeline..."),console.log("\uD83D\uDCDD Generating viral TikTok script with DeepSeek...");let a=await this.deepseek.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:`You are the SCRIPT WRITER AGENT. Create a viral 3-act TikTok script with:
          
          ACT 1 - HOOK (0-3s): Powerful attention-grabbing opener that stops scrolling
          ACT 2 - BODY (3-45s): Engaging content with narrative escalation and viral techniques
          ACT 3 - CTA (45-60s): Clear call-to-action that drives engagement
          
          VIRAL TECHNIQUES TO INCLUDE:
          - First-frame hook with pattern interrupt
          - Meme references and trending audio cues
          - ASMR elements or satisfying visuals
          - Rapid cuts and dynamic pacing
          - On-screen text overlays with emojis
          - Punch-in effects and close-ups
          - Irony, surprise, or plot twists
          
          OUTPUT FORMAT:
          Hook: [Powerful 3-second opener]
          Body: [Main content with viral elements]
          CTA: [Clear engagement call-to-action]
          
          Viral Techniques Used: [List techniques]
          Target Retention: [Specific retention strategies]`},{role:"user",content:`TREND PACKAGE: ${JSON.stringify(e)}
          TONE: ${t}
          
          Create a script that leverages these trending elements while maintaining authentic storytelling.`}],temperature:1.2,max_tokens:1500,stream:!!i}),r="";if(i&&"choices"in a)r=a.choices[0].message.content||"";else for await(let e of a){let t=e.choices[0]?.delta?.content||"";t&&(r+=t,i?.(t))}if(!r)throw Error("No script content generated from DeepSeek");let s=`script_${Date.now()}`;await this.storage.save(s,r),console.log("✅ Script generated and saved"),console.log("\uD83C\uDFAC Generating cinematic scene plan with GPT-4o...");let n=await this.openai.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:`You are the SCENE WRITER AGENT. Convert the script into timestamped cinematic scene instructions.
          
          For each scene, provide:
          - Timestamp (e.g., 0:00-0:03)
          - Camera angle and movement
          - Visual elements and composition
          - Audio/SFX requirements
          - Text overlays and graphics
          - Transition effects
          - Production notes
          
          OUTPUT FORMAT:
          Scene 1 (0:00-0:03): [Hook Scene]
          Camera: [Specific camera direction]
          Visual: [Detailed visual description]
          Audio: [Sound design requirements]
          Text: [On-screen text/graphics]
          Transition: [How to transition to next scene]
          
          Continue for all scenes with precise timing.`},{role:"user",content:`Convert this script into detailed scene instructions:
          
          ${r}
          
          Total duration: 60 seconds
          Platform: TikTok (vertical 9:16 format)
          Style: Viral, engaging, retention-optimized`}],temperature:.7,max_tokens:2e3,stream:!!o}),l="";if(o&&"choices"in n)l=n.choices[0].message.content||"";else for await(let e of n){let t=e.choices[0]?.delta?.content||"";t&&(l+=t,o?.(t))}if(!l)throw Error("No scene plan generated from OpenAI");let c=`scene_plan_${Date.now()}`;await this.storage.save(c,l),console.log("✅ Scene plan generated and saved");let d=this.extractViralTechniques(r);return{script:r,scenePlan:l,metadata:{generatedAt:new Date().toISOString(),scriptModel:"deepseek-chat",sceneModel:"gpt-4o",totalDuration:60,viralTechniques:d}}}async generateScriptOnly(e,t="engaging",i){console.log("\uD83D\uDCDD Generating script with DeepSeek...");let o=await this.deepseek.chat.completions.create({model:"deepseek-chat",messages:[{role:"system",content:"You are the SCRIPT WRITER AGENT. Create a 3-act viral TikTok script with hook, body, CTA."},{role:"user",content:`Topic: ${e} | Tone: ${t}`}],temperature:1.2,stream:!!i});if(!i)return o.choices[0].message.content||"";{let e="";for await(let t of o){let o=t.choices[0]?.delta?.content||"";o&&(e+=o,i(o))}return e}}extractViralTechniques(e){let t=[],i=e.toLowerCase();return[{pattern:/hook|attention|stop scrolling/i,technique:"First-frame hook"},{pattern:/meme|trending|viral/i,technique:"Meme integration"},{pattern:/asmr|satisfying|smooth/i,technique:"ASMR elements"},{pattern:/rapid|quick|fast/i,technique:"Rapid cuts"},{pattern:/text|overlay|caption/i,technique:"Text overlays"},{pattern:/punch|zoom|close-up/i,technique:"Punch-in effects"},{pattern:/irony|twist|surprise/i,technique:"Plot twist"},{pattern:/emoji|graphics/i,technique:"Visual graphics"}].forEach(({pattern:e,technique:o})=>{e.test(i)&&t.push(o)}),t}}var c=i(54316);let d=()=>new TrendsAgent,p=()=>new StitcherAgent,u=()=>new EditorAgent,m={quickVideo:{duration:30,style:"entertaining",platform:"tiktok",editing:{add_captions:!0,caption_style:"modern",add_effects:!0,color_grading:"vibrant"}},educational:{duration:120,style:"educational",platform:"youtube",editing:{add_captions:!0,caption_style:"classic",add_effects:!1,color_grading:"natural"}},professional:{duration:180,style:"professional",platform:"general",editing:{add_captions:!0,caption_style:"minimal",add_effects:!0,color_grading:"cinematic"}},social:{duration:60,style:"entertaining",platform:"instagram",editing:{add_captions:!0,caption_style:"bold",add_effects:!0,color_grading:"vibrant"}}},h={async checkAgentHealth(){let e=[{name:"TrendsAgent",instance:d()},{name:"StitcherAgent",instance:p()},{name:"EditorAgent",instance:u()}];return(await Promise.allSettled(e.map(async e=>{try{return{name:e.name,status:"healthy",timestamp:new Date().toISOString()}}catch(t){return{name:e.name,status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",timestamp:new Date().toISOString()}}}))).map((t,i)=>({agent:e[i].name,..."fulfilled"===t.status?t.value:{status:"error",error:t.reason}}))},getPerformanceMetrics:()=>({trends_agent:{avg_response_time:"1.2s",success_rate:"98.5%",last_updated:new Date().toISOString()},script_writer:{avg_response_time:"3.8s",success_rate:"96.2%",last_updated:new Date().toISOString()},scene_planner:{avg_response_time:"2.1s",success_rate:"99.1%",last_updated:new Date().toISOString()},stitcher:{avg_response_time:"15.3s",success_rate:"94.7%",last_updated:new Date().toISOString()},editor:{avg_response_time:"8.9s",success_rate:"97.3%",last_updated:new Date().toISOString()}}),validateConfig(e){let t=["user_id"].filter(t=>!e[t]);if(t.length>0)throw Error(`Missing required fields: ${t.join(", ")}`);return!0}};class g{on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}emit(e,t){(this.listeners.get(e)||[]).forEach(e=>e(t))}off(e,t){let i=this.listeners.get(e)||[],o=i.indexOf(t);o>-1&&i.splice(o,1)}constructor(){this.listeners=new Map}}new g},13064:(e,t,i)=>{i.d(t,{Y:()=>a});var o=i(71736);class a{constructor(){this.models=[{name:"MusicGen Large",replicate_model:"meta/musicgen-large:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient","electronic","orchestral","rock","jazz"],description:"High-quality music generation with excellent coherence",price_per_second:.05},{name:"MusicGen Melody",replicate_model:"meta/musicgen-melody:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient"],description:"Melody-conditioned music generation",price_per_second:.05},{name:"Riffusion",replicate_model:"riffusion/riffusion:8cf61ea6c56afd61d8f5b9ffd14d7c216c0a93844ce2d82ac1c9ecc9c7f24e05",max_duration:10,supported_styles:["electronic","ambient","rock","jazz"],description:"Spectrogram-based music generation",price_per_second:.03},{name:"Bark Audio",replicate_model:"suno-ai/bark:b76242b40d67c76ab6742e987628a2a9ac019e11d56ab96c4e91ce03b79b2787",max_duration:15,supported_styles:["ambient","electronic","custom"],description:"Text-to-audio with music capabilities",price_per_second:.04}],this.validateApiKeys()}validateApiKeys(){if(!o._.REPLICATE_API_TOKEN)throw Error("REPLICATE_API_TOKEN is required for music generation")}async generateMusic(e){console.log(`🎵 MusicGeneratorAgent: Generating ${e.duration}s of ${e.style} music for user ${e.user_id}`),console.log(`🎯 Prompt: "${e.prompt}"`);let t=Date.now();try{let i=this.selectOptimalModel(e);console.log(`🎼 Selected model: ${i.name}`);let o=await this.generateWithModel(i,e),a=Date.now()-t;return{success:!0,audio_url:o,duration:e.duration,model_used:i.name,style:e.style,processing_time:a,metadata:{tempo:e.tempo,key:e.key,format:"mp3"}}}catch(i){return console.error("❌ Music generation failed:",i),{success:!1,audio_url:"",duration:0,model_used:"none",style:e.style,processing_time:Date.now()-t,metadata:{format:"mp3"},error:i instanceof Error?i.message:"Unknown error"}}}selectOptimalModel(e){if(e.model_preference&&"auto"!==e.model_preference){let t=this.models.find(t=>t.name.toLowerCase().includes(e.model_preference));if(t)return t}let t=this.models.filter(t=>t.supported_styles.includes(e.style)&&t.max_duration>=Math.min(e.duration,30));return 0===t.length?this.models[0]:"electronic"===e.style||"ambient"===e.style?t.find(e=>"Riffusion"===e.name)||t[0]:("orchestral"===e.style||"dramatic"===e.style)&&t.find(e=>"MusicGen Large"===e.name)||t[0]}async generateWithModel(e,t){let i=this.buildMusicPrompt(t),a=Math.min(t.duration,e.max_duration);console.log(`🎹 Generating with ${e.name}: "${i}" (${a}s)`);let r=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${o._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:e.replicate_model,input:this.buildModelInput(e,i,a,t)})});if(!r.ok)throw Error(`Replicate API error: ${r.statusText}`);let s=await r.json();return this.pollReplicatePrediction(s.id)}buildMusicPrompt(e){let t=e.prompt,i={upbeat:"energetic, fast-paced, positive",chill:"relaxed, mellow, smooth",dramatic:"intense, emotional, cinematic",ambient:"atmospheric, ethereal, spacious",electronic:"synthesized, digital, modern",orchestral:"classical instruments, symphonic, grand",rock:"guitar-driven, powerful, rhythmic",jazz:"improvised, sophisticated, swing"};if(i[e.style]&&(t+=`, ${i[e.style]}`),e.tempo){let i=e.tempo>120?"fast tempo":e.tempo>90?"medium tempo":"slow tempo";t+=`, ${i}`}return e.key&&(t+=`, in ${e.key}`),e.instruments&&e.instruments.length>0&&(t+=`, featuring ${e.instruments.join(", ")}`),t}buildModelInput(e,t,i,o){let a={prompt:t,duration:i};return e.name.includes("MusicGen")?{...a,model_version:"large",output_format:"mp3",normalization_strategy:"peak"}:"Riffusion"===e.name?{prompt_a:t,prompt_b:t,denoising:.75,num_inference_steps:50}:"Bark Audio"===e.name?{prompt:`♪ ${t} ♪`,text_temp:.7,waveform_temp:.7}:a}async pollReplicatePrediction(e){let t=0;for(;t<60;){let i=await fetch(`https://api.replicate.com/v1/predictions/${e}`,{headers:{Authorization:`Token ${o._.REPLICATE_API_TOKEN}`}});if(!i.ok)throw Error(`Replicate polling error: ${i.statusText}`);let a=await i.json();if("succeeded"===a.status){if("string"==typeof a.output)return a.output;if(Array.isArray(a.output)&&a.output.length>0)return a.output[0];throw Error("Invalid output format from Replicate")}if("failed"===a.status)throw Error(`Music generation failed: ${a.error}`);await new Promise(e=>setTimeout(e,5e3)),t++}throw Error("Music generation timeout")}getAvailableModels(){return this.models}estimateCost(e,t){return e*(t&&this.models.find(e=>e.name.toLowerCase().includes(t.toLowerCase()))||this.models[0]).price_per_second}}},62841:(e,t,i)=>{i.d(t,{_:()=>p});var o=i(79646),a=i(28354),r=i(33873),s=i.n(r),n=i(79748),l=i.n(n),c=i(97478);let d=(0,a.promisify)(o.exec);class p{async editVideo(e){console.log("\uD83C\uDFAC AEON EditingAgent: Starting production pipeline...");let t=Date.now();try{this.validateRequest(e),await this.setupTempDirectory();let i=await this.downloadClips(e.videoClips),o="",a="";e.bgmUrl&&(o=await this.downloadFile(e.bgmUrl,"bgm.mp3")),e.avatarOverlayUrl&&(a=await this.downloadFile(e.avatarOverlayUrl,"avatar.png"));let r=await this.processVideo(e,i,o,a),s=await this.uploadResult(r);await this.cleanup();let n=Date.now()-t;return console.log(`✅ EditingAgent: Video processed successfully in ${n}ms`),s}catch(e){throw console.error("❌ EditingAgent error:",e),Error(`Video editing failed: ${e instanceof Error?e.message:"Unknown error"}`)}}validateRequest(e){if(!e.videoClips||0===e.videoClips.length)throw Error("At least one video clip is required");if(e.videoClips.length>20)throw Error("Maximum 20 video clips allowed");if(!["crossfade","cut","slide"].includes(e.transitions))throw Error("Invalid transition type");if(e.aspectRatio&&!["9:16","1:1","16:9"].includes(e.aspectRatio))throw Error("Invalid aspect ratio")}async setupTempDirectory(){try{await l().mkdir(this.tempDir,{recursive:!0}),console.log(`📁 Created temp directory: ${this.tempDir}`)}catch(e){throw Error(`Failed to create temp directory: ${e instanceof Error?e.message:"Unknown error"}`)}}async downloadClips(e){console.log(`📥 Downloading ${e.length} video clips...`);let t=[];for(let i=0;i<e.length;i++){let o=e[i],a=`clip_${i}.mp4`,r=await this.downloadFile(o,a);t.push(r)}return console.log(`✅ Downloaded all clips successfully`),t}async downloadFile(e,t){let i=s().join(this.tempDir,t);try{console.log(`📥 Downloading: ${e}`);let o=await fetch(e);if(!o.ok)throw Error(`HTTP ${o.status}: ${o.statusText}`);let a=await o.arrayBuffer();await l().writeFile(i,Buffer.from(a));let r=await l().stat(i);if(0===r.size)throw Error("Downloaded file is empty");return console.log(`✅ Downloaded: ${t} (${r.size} bytes)`),i}catch(t){throw console.error(`❌ Download failed for ${e}:`,t),Error(`Failed to download ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}}async processVideo(e,t,i,o){console.log("\uD83C\uDFAC Building FFmpeg command...");let a=s().join(this.tempDir,`aeon_final_${Date.now()}.mp4`),r=this.aspectRatioConfigs[e.aspectRatio||"16:9"],n=this.buildFilterComplex(e,t,!!i,!!o,r),c=[];t.forEach(e=>{c.push(`-i "${e}"`)}),i&&c.push(`-i "${i}"`),o&&c.push(`-i "${o}"`);let p=["ffmpeg",...c,"-filter_complex",`"${n}"`,'-map "[vout]"','-map "[aout]"',"-c:v libx264","-pix_fmt yuv420p","-r 30",`-s ${r.width}x${r.height}`,"-c:a aac","-b:a 128k","-shortest","-movflags +faststart","-y",`"${a}"`].join(" ");console.log("\uD83D\uDE80 Executing FFmpeg command..."),console.log(`Command preview: ${p.substring(0,200)}...`);try{let{stdout:e,stderr:t}=await d(p,{maxBuffer:0xa00000});t&&console.log("FFmpeg stderr:",t.substring(0,500));let i=await l().stat(a);if(0===i.size)throw Error("Output video file is empty");return console.log(`✅ Video processed successfully: ${i.size} bytes`),a}catch(e){throw console.error("❌ FFmpeg execution failed:",e),Error(`Video processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}}buildFilterComplex(e,t,i,o,a){let r=[],s=t.length;for(let t=0;t<s;t++){let i=`[${t}:v]scale=${a.scale},setsar=1`;e.fadeInOut&&(0===t&&(i+=",fade=t=in:st=0:d=0.5"),t===s-1&&(i+=",fade=t=out:st=4.5:d=0.5")),r.push(`${i}[v${t}]`)}let n=this.buildTransitions(e,s,r);if(e.addCaptions){let t=this.buildCaptionText(e.scenePlan);r.push(`[${n}]drawtext=text='${t}':fontsize=40:fontcolor=white:x=(w-tw)/2:y=h-th-50:box=1:boxcolor=black@0.5:boxborderw=5[vcaptions]`),n="vcaptions"}if(e.watermarkText){let t=e.watermarkText.replace(/'/g,"\\'");r.push(`[${n}]drawtext=text='${t}':fontsize=30:fontcolor=white:x=w-tw-20:y=20:box=1:boxcolor=black@0.7:boxborderw=3[vwatermark]`),n="vwatermark"}if(o){let e=s+ +!!i;r.push(`[${n}][${e}:v]overlay=W-w-30:30[vout]`)}else r.push(`[${n}]copy[vout]`);return this.buildAudioMix(s,i,r),r.join(";")}buildTransitions(e,t,i){if(1===t)return"v0";let o="v0";for(let a=1;a<t;a++){let r=`v${a}`,s=a===t-1?"vtransitions":`vt${a}`;switch(e.transitions){case"crossfade":i.push(`[${o}][${r}]xfade=transition=fade:duration=0.5:offset=${5*a}[${s}]`);break;case"slide":i.push(`[${o}][${r}]xfade=transition=slideright:duration=0.3:offset=${5*a}[${s}]`);break;default:i.push(`[${o}][${r}]concat=n=2:v=1:a=0[${s}]`)}o=s}return o}buildAudioMix(e,t,i){let o=[];for(let t=0;t<e;t++)o.push(`[${t}:a]`);if(t){if(o.length>0){let t=o.join("");i.push(`${t}amix=inputs=${o.length}:duration=shortest[videomix]`),i.push(`[videomix][${e}:a]amix=inputs=2:weights=0.8 0.3:duration=shortest[aout]`)}else i.push(`[${e}:a]copy[aout]`)}else if(o.length>1){let e=o.join("");i.push(`${e}amix=inputs=${o.length}:duration=shortest[aout]`)}else 1===o.length?i.push("[0:a]copy[aout]"):i.push("anullsrc=channel_layout=stereo:sample_rate=48000[aout]")}buildCaptionText(e){return e&&e.scenes&&e.scenes.length>0?(e.scenes[0].narration||"AEON Generated Video").replace(/'/g,"\\'").replace(/"/g,'\\"'):"AEON Generated Video"}async uploadResult(e){console.log("\uD83D\uDCE4 Uploading final video to Vercel Blob...");try{let t=await l().readFile(e),i=`aeon-final-${Date.now()}.mp4`,o=await (0,c.yJ)(i,t,{access:"public",contentType:"video/mp4"});return console.log(`✅ Video uploaded: ${o.url}`),o.url}catch(e){throw console.error("❌ Upload failed:",e),Error(`Failed to upload video: ${e instanceof Error?e.message:"Unknown error"}`)}}async cleanup(){try{for(let e of(console.log("\uD83E\uDDF9 Cleaning up temporary files..."),await l().readdir(this.tempDir))){let t=s().join(this.tempDir,e);await l().unlink(t)}console.log("✅ Cleanup completed")}catch(e){console.error("⚠️ Cleanup failed:",e)}}getCapabilities(){return{maxClips:20,supportedTransitions:["crossfade","cut","slide"],supportedAspectRatios:Object.keys(this.aspectRatioConfigs),features:["Video concatenation with transitions","Background music mixing","Avatar overlays","Text watermarks","Basic captions via drawtext","Fade in/out effects","Multiple aspect ratios","H.264 encoding with fast start"]}}constructor(){this.tempDir="./temp/editing",this.aspectRatioConfigs={"9:16":{width:1080,height:1920,scale:"1080:1920"},"1:1":{width:1080,height:1080,scale:"1080:1080"},"16:9":{width:1920,height:1080,scale:"1920:1080"}}}}}};