exports.id=3010,exports.ids=[3010],exports.modules={63874:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var a=r(23405);let s=()=>(0,a.createBrowserClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs")},69702:(e,t,r)=>{"use strict";r.d(t,{XL:()=>a,gz:()=>s}),r(63874),r(79737);let a={compileShader:()=>Promise.resolve(null),applyTransition:()=>Promise.resolve(null),applyGPUTransition:()=>Promise.resolve(null),preloadTransition:()=>Promise.resolve(),clearCache:()=>{}};function s(e,t){let r={high_energy:["zoom_punch","glitch_blast","viral_cut"],smooth_flow:["crossfade","slide","film_burn"],dramatic:["3d_flip","zoom_punch","cube_rotate"],tech_gaming:["glitch_blast","viral_cut","digital_noise"],lifestyle:["slide","crossfade","zoom_punch"]},a=r[e]||r.smooth_flow;return t>7&&(a=["zoom_punch","glitch_blast",...a]),a}},78335:()=>{},79737:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var a=r(63874),s=r(69702),i=r(97513);class o{constructor(){this.supabase=(0,a.U)(),this.DEFAULT_ROYALTY=.15,this.APPROVAL_THRESHOLD=6,this.MAX_GLSL_SIZE=1e4,console.log("\uD83C\uDFEA MarketplaceAgent initialized for creator transitions")}async publishTransition(e){try{console.log(`ðŸ“¤ Publishing transition: ${e.name} by ${e.creatorId}`);let t=await this.validateTransition(e);if(!t.isValid)return{success:!1,error:t.error};let r=await this.compileAndTestGLSL(e.glslCode);if(!r.success)return{success:!1,error:`GLSL compilation failed: ${r.error}`};let a=await this.generateTransitionPreview(e),s=await this.estimateViralScore(e),i=s<this.APPROVAL_THRESHOLD,o={id:e.id||`creator_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:e.name,category:e.category,duration:.5,intensity:"moderate",viral_score:s,preview_url:a,glsl_code:e.glslCode,parameters:[],description:e.description,tags:e.tags,is_active:!i,creator_id:e.creatorId,royalty_percentage:e.royaltyPercentage||this.DEFAULT_ROYALTY,is_official:!1,is_public:e.isPublic,price_credits:e.price,approval_status:i?"pending":"approved",created_at:new Date().toISOString()},{data:n,error:c}=await this.supabase.from("transitions").insert(o).select().single();if(c)throw Error(`Database insert failed: ${c.message}`);return await this.trackCreatorActivity(e.creatorId,"publish",n.id),console.log(`âœ… Transition published: ${n.id} (approval: ${!i})`),{success:!0,transitionId:n.id,requiresApproval:i}}catch(e){return console.error("âŒ Failed to publish transition:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getMarketplaceTransitions(e={}){try{let t=this.supabase.from("transitions").select(`
          *,
          creator_profile:creator_id(name, avatar_url),
          transition_analytics(viral_score_impact, usage_count)
        `).eq("is_public",!0).eq("approval_status","approved");e.category&&(t=t.eq("category",e.category)),e.creatorId&&(t=t.eq("creator_id",e.creatorId)),e.minViralScore&&(t=t.gte("viral_score",e.minViralScore)),e.maxPrice&&(t=t.lte("price_credits",e.maxPrice)),e.tags&&e.tags.length>0&&(t=t.overlaps("tags",e.tags));let r=e.sortBy||"viral_score",a=e.sortOrder||"desc";t=t.order(r,{ascending:"asc"===a}),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||20)-1));let{data:s,error:i}=await t;if(i)throw i;return(s||[]).map(this.mapToCreatorTransition)}catch(e){return console.error("Failed to get marketplace transitions:",e),[]}}async purchaseTransition(e,t){try{console.log(`ðŸ›’ Processing purchase: ${e} by user ${t}`);let{data:r,error:a}=await this.supabase.from("transitions").select("*").eq("id",e).eq("is_active",!0).eq("approval_status","approved").single();if(a||!r)return{success:!1,error:"Transition not found or not available"};let s=r.price_credits||0,o=r.royalty_percentage||this.DEFAULT_ROYALTY;if(0===s)return await this.grantFreeTransitionAccess(t,e,r.creator_id),{success:!0,creditsUsed:0,royaltyPaid:0};let n=await i.O.processPurchase(t,r.creator_id,e,s,o);if(!n.success)return{success:!1,error:n.error};return await this.grantTransitionAccess(t,e,n.purchaseId),await this.trackMarketplaceMetrics(e,r.creator_id,s),console.log(`âœ… Purchase completed: ${e} for ${s} credits`),{success:!0,creditsUsed:s,royaltyPaid:n.creatorEarnings,purchaseId:n.purchaseId,userBalance:n.userBalance}}catch(e){return console.error("Failed to purchase transition:",e),{success:!1,error:e instanceof Error?e.message:"Purchase failed"}}}async checkTransitionAccess(e,t){try{let{data:r}=await this.supabase.from("transitions").select("is_official, price_credits").eq("id",t).single();if(!r)return!1;if(r.is_official||0===r.price_credits)return!0;let{data:a}=await this.supabase.from("transition_purchases").select("id").eq("user_id",e).eq("transition_id",t).eq("status","completed").single();return!!a}catch(e){return console.error("Failed to check transition access:",e),!1}}async getMarketplaceStats(){try{let{count:e}=await this.supabase.from("transitions").select("*",{count:"exact",head:!0}).eq("is_official",!1).eq("is_public",!0),{data:t}=await this.supabase.from("transitions").select("creator_id").eq("is_official",!1).eq("is_public",!0),r=new Set(t?.map(e=>e.creator_id)).size,{data:a}=await this.supabase.from("transitions").select("*").eq("is_official",!1).eq("is_public",!0).order("viral_score",{ascending:!1}).limit(10),s=(a||[]).map(this.mapToCreatorTransition);return{totalTransitions:e||0,totalCreators:r,totalRevenue:0,topTransitions:s,topCreators:[]}}catch(e){return console.error("Failed to get marketplace stats:",e),{totalTransitions:0,totalCreators:0,totalRevenue:0,topTransitions:[],topCreators:[]}}}async validateTransition(e){if(!e.name||!e.glslCode||!e.creatorId)return{isValid:!1,error:"Missing required fields"};if(e.glslCode.length>this.MAX_GLSL_SIZE)return{isValid:!1,error:"GLSL code too large"};for(let t of[/while\s*\(\s*true\s*\)/i,/for\s*\([^)]*;\s*true\s*;/i,/discard/i])if(t.test(e.glslCode))return{isValid:!1,error:"GLSL contains potentially harmful patterns"};return e.price<0||e.price>1e3?{isValid:!1,error:"Price must be between 0 and 1000 credits"}:{isValid:!0}}async compileAndTestGLSL(e){try{if(!e.includes("vec4 transition("))return{success:!1,error:"GLSL must contain a transition function"};let t=`test_${Date.now()}`;if(!await s.XL.compileShader(t,e))return{success:!1,error:"GLSL compilation failed"};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Compilation error"}}}async generateTransitionPreview(e){return`/api/transitions/preview/${e.name.toLowerCase().replace(/\s+/g,"-")}`}async estimateViralScore(e){let t=5;t=({"tiktok-essentials":8,glitch:7.5,"3d-transforms":7,cinematic:6,organic:5.5})[e.category]||t;let r=["viral","trending","explosive","punch","blast"];return t+=.5*e.tags.filter(e=>r.some(t=>e.toLowerCase().includes(t))).length,Math.max(0,Math.min(10,t+=Math.min(e.glslCode.length/1e3,2)))}async grantFreeTransitionAccess(e,t,r){await this.supabase.from("transition_purchases").insert({user_id:e,transition_id:t,creator_id:r,credits_paid:0,status:"completed",payment_method:"free"}),await this.trackCreatorActivity(r,"free_download",t)}async grantTransitionAccess(e,t,r){await this.supabase.from("transition_purchases").update({access_granted_at:new Date().toISOString(),status:"completed"}).eq("id",r),await this.supabase.rpc("increment_transition_usage",{p_transition_id:t})}async trackMarketplaceMetrics(e,t,r){try{await this.supabase.from("transitions").update({purchase_count:this.supabase.raw("purchase_count + 1"),total_earnings:this.supabase.raw(`total_earnings + ${r}`)}).eq("id",e),await this.supabase.from("creator_profiles").update({total_sales:this.supabase.raw("total_sales + 1")}).eq("user_id",t),console.log(`ðŸ“Š Marketplace metrics updated for transition ${e}`)}catch(e){console.error("Failed to track marketplace metrics:",e)}}async trackCreatorActivity(e,t,r){console.log(`ðŸ“Š Creator activity: ${e} - ${t} - ${r}`)}async trackTransitionPurchase(e,t,r){console.log(`ðŸ’° Transition purchased: ${e} by ${t} for ${r} credits`)}mapToCreatorTransition(e){return{id:e.id,name:e.name,description:e.description||"",glslCode:e.glsl_code||"",ffmpegParams:e.ffmpeg_params||{},creatorId:e.creator_id,category:e.category,tags:e.tags||[],previewUrl:e.preview_url,thumbnailUrl:e.thumbnail_url,price:e.price_credits||0,royaltyPercentage:e.royalty_percentage||this.DEFAULT_ROYALTY,isPublic:e.is_public||!1,isApproved:"approved"===e.approval_status,viralScore:e.viral_score}}}let n=new o},96487:()=>{},97513:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});var a=r(63874);class s{constructor(){this.supabase=(0,a.U)(),this.PLATFORM_FEE_RATE=.025,this.MIN_PAYOUT_AMOUNT=10,this.CREDIT_TO_USD_RATE=.01,console.log("\uD83D\uDCB3 CreditEngine initialized for automated payments")}async getCreditBalance(e){try{let{data:t,error:r}=await this.supabase.from("profiles").select("credits").eq("id",e).single();if(r)throw Error(`Failed to get user profile: ${r.message}`);let{data:a,error:s}=await this.supabase.from("credit_transactions").select("amount, transaction_type").eq("user_id",e);if(s)throw Error(`Failed to get transactions: ${s.message}`);let i=a?.filter(e=>["royalty","bonus","refund"].includes(e.transaction_type)).reduce((e,t)=>e+(t.amount||0),0)||0,o=a?.filter(e=>["purchase","fee"].includes(e.transaction_type)).reduce((e,t)=>e+Math.abs(t.amount||0),0)||0,{data:n}=await this.supabase.from("credit_transactions").select("amount").eq("user_id",e).eq("status","pending"),c=n?.reduce((e,t)=>e+(t.amount||0),0)||0;return{userId:e,credits:t?.credits||0,pendingCredits:c,totalEarned:i,totalSpent:o}}catch(t){return console.error("Failed to get credit balance:",t),{userId:e,credits:0,pendingCredits:0,totalEarned:0,totalSpent:0}}}async validateCredits(e,t){try{let r=await this.getCreditBalance(e),a=r.credits-r.pendingCredits;if(a<t)return{valid:!1,currentBalance:a,error:`Insufficient credits. Required: ${t}, Available: ${a}`};return{valid:!0,currentBalance:a}}catch(e){return{valid:!1,currentBalance:0,error:e instanceof Error?e.message:"Validation failed"}}}async deductCredits(e,t,r,a){try{let s=await this.validateCredits(e,t);if(!s.valid)return{success:!1,error:s.error};let{data:i,error:o}=await this.supabase.rpc("deduct_user_credits",{p_user_id:e,p_amount:t,p_transition_id:r,p_description:a||`Purchase transition ${r}`});if(o)throw Error(`Credit deduction failed: ${o.message}`);return console.log(`ðŸ’³ Credits deducted: ${t} from user ${e}`),{success:!0,transactionId:i?.transaction_id,newBalance:i?.new_balance}}catch(e){return console.error("Failed to deduct credits:",e),{success:!1,error:e instanceof Error?e.message:"Deduction failed"}}}async addCredits(e,t,r,a){try{let{data:s,error:i}=await this.supabase.rpc("add_user_credits",{p_user_id:e,p_amount:t,p_transaction_type:r,p_description:a||`${r} credits`});if(i)throw Error(`Credit addition failed: ${i.message}`);return console.log(`ðŸ’° Credits added: ${t} to user ${e}`),{success:!0,transactionId:s?.transaction_id,newBalance:s?.new_balance}}catch(e){return console.error("Failed to add credits:",e),{success:!1,error:e instanceof Error?e.message:"Addition failed"}}}async recordRoyalty(e){try{let t=e.amount*this.PLATFORM_FEE_RATE,r=e.amount-t,{data:a,error:s}=await this.supabase.rpc("update_creator_wallet",{p_creator_id:e.creatorId,p_amount:r,p_transition_id:e.transitionId,p_purchase_id:e.purchaseId,p_royalty_rate:e.royaltyRate});if(s)throw Error(`Royalty recording failed: ${s.message}`);return await this.recordPlatformFee(t,e.transitionId),console.log(`ðŸ‘‘ Royalty recorded: ${r} to creator ${e.creatorId}`),{success:!0,transactionId:a?.transaction_id,newBalance:a?.new_balance}}catch(e){return console.error("Failed to record royalty:",e),{success:!1,error:e instanceof Error?e.message:"Royalty recording failed"}}}async processPurchase(e,t,r,a,s){try{let i=`purchase_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=await this.deductCredits(e,a,r,`Purchase transition ${r}`);if(!o.success)return{success:!1,error:o.error};let n=a*s,c=await this.recordRoyalty({creatorId:t,amount:n,transitionId:r,purchaseId:i,royaltyRate:s});if(!c.success)return await this.addCredits(e,a,"refund","Royalty processing failed - refund"),{success:!1,error:`Royalty processing failed: ${c.error}`};return await this.recordPurchaseTransaction(e,t,r,a,i),console.log(`âœ… Purchase completed: ${r} by ${e} for ${a} credits`),{success:!0,purchaseId:i,userBalance:o.newBalance,creatorEarnings:n-n*this.PLATFORM_FEE_RATE}}catch(e){return console.error("Purchase processing failed:",e),{success:!1,error:e instanceof Error?e.message:"Purchase failed"}}}async getCreatorWallet(e){try{let{data:t,error:r}=await this.supabase.from("creator_wallets").select("*").eq("creator_id",e).single();if(r&&"PGRST116"!==r.code)throw r;if(!t)return await this.createCreatorWallet(e),{balance:0,pendingPayouts:0,totalEarnings:0,canPayout:!1};let a=t.balance*this.CREDIT_TO_USD_RATE>=this.MIN_PAYOUT_AMOUNT;return{balance:t.balance,pendingPayouts:t.pending_payouts||0,totalEarnings:t.total_earnings||0,canPayout:a}}catch(e){return console.error("Failed to get creator wallet:",e),{balance:0,pendingPayouts:0,totalEarnings:0,canPayout:!1}}}async requestPayout(e){try{let t=await this.getCreatorWallet(e.creatorId);if(!t.canPayout)return{success:!1,error:`Minimum payout amount is $${this.MIN_PAYOUT_AMOUNT}`};if(t.balance<e.amount)return{success:!1,error:"Insufficient balance for payout"};let r=`payout_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,{error:a}=await this.supabase.from("payout_requests").insert({id:r,creator_id:e.creatorId,amount:e.amount,method:e.method,destination:e.destination,status:"pending",estimated_usd:e.amount*this.CREDIT_TO_USD_RATE});if(a)throw a;return await this.supabase.rpc("update_creator_pending_payout",{p_creator_id:e.creatorId,p_amount:e.amount}),console.log(`ðŸ’¸ Payout requested: ${e.amount} credits for creator ${e.creatorId}`),{success:!0,payoutId:r,estimatedAmount:e.amount*this.CREDIT_TO_USD_RATE}}catch(e){return console.error("Payout request failed:",e),{success:!1,error:e instanceof Error?e.message:"Payout request failed"}}}async getTransactionHistory(e,t=50,r=0){try{let{data:a,error:s}=await this.supabase.from("credit_transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(s)throw s;return a||[]}catch(e){return console.error("Failed to get transaction history:",e),[]}}async createCreatorWallet(e){await this.supabase.from("creator_wallets").insert({creator_id:e,balance:0,pending_payouts:0,total_earnings:0})}async recordPlatformFee(e,t){await this.supabase.from("platform_earnings").insert({amount:e,source:"transition_fee",transition_id:t,created_at:new Date().toISOString()})}async recordPurchaseTransaction(e,t,r,a,s){await this.supabase.from("transition_purchases").insert({id:s,user_id:e,creator_id:t,transition_id:r,credits_paid:a,status:"completed"})}}let i=new s}};