(()=>{var e={};e.id=8083,e.ids=[8083],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32327:(e,t,r)=>{"use strict";let i;r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>R,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>p});var a=r(96559),n=r(48088),o=r(37719),u=r(32190),l=r(72289);let d=l.Ik({topic:l.Yj().min(5,"Topic is required and must be at least 5 characters"),style:l.Yj().optional(),email:l.Yj().email("Invalid email address"),duration:l.ai().min(15).max(300).default(60)});function c(e,t,r,i=400){return u.NextResponse.json({errorCode:e,message:t,...r&&{hint:r}},{status:i})}async function p(e){try{var t;let{userId:r}=auth();if(!r)return c("UNAUTHORIZED","Authentication required","Please sign in to generate videos.",401);let s=function(e){let t=Date.now(),r=i.get(e);if(i.size>1e3)for(let[e,r]of i.entries())t>r.resetTime&&i.delete(e);return!r||t>r.resetTime?(i.set(e,{count:1,resetTime:t+6e4}),{allowed:!0}):r.count<5?(r.count++,{allowed:!0}):{allowed:!1,resetTime:r.resetTime}}(r);if(!s.allowed){let e=s.resetTime?Math.ceil((s.resetTime-Date.now())/1e3):60;return c("RATE_LIMIT_EXCEEDED","Too many requests. Please wait before trying again.",`Rate limit resets in ${e} seconds. Maximum 5 requests per minute.`,429)}let a=await e.json(),n=d.safeParse(a);if(!n.success)return c("VALIDATION_ERROR","Invalid request data",n.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", "));let{topic:o,style:l,email:p,duration:m}=n.data,E=l?`${o} in ${l} style`:o;if(!process.env.AEON_SCHEDULER_URL)return console.error("AEON_SCHEDULER_URL environment variable not configured"),c("CONFIGURATION_ERROR","Service temporarily unavailable","Backend configuration issue. Please try again later.",503);let f=await fetch(`${process.env.AEON_SCHEDULER_URL}/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,prompt:E,duration:m,title:`Video: ${o.substring(0,50)}${o.length>50?"...":""}`})}),R=await f.json();if(!f.ok){let e=R.detail||R.message||"Video generation failed";switch(f.status){case 401:return c("AUTHENTICATION_ERROR","Authentication failed","Please check your email address and try again.",401);case 402:return c("INSUFFICIENT_CREDITS","Insufficient credits","Please purchase more credits to generate videos.",402);case 429:return c("BACKEND_RATE_LIMIT","Service temporarily busy","Please try again in a few moments.",429);default:return c("BACKEND_ERROR",e,"Please try again or contact support if the issue persists.",f.status)}}if(!R.video_id)return c("BACKEND_RESPONSE_ERROR","Invalid response from video generation service","Missing video ID in response. Please try again.",500);return t=R.video_id,u.NextResponse.json({success:!0,data:{videoId:t}})}catch(e){if(console.error("Video request error:",e),"SyntaxError"===e.name)return c("INVALID_JSON","Invalid request format","Please ensure your request contains valid JSON.",400);if("ECONNREFUSED"===e.code||"ENOTFOUND"===e.code)return c("SERVICE_UNAVAILABLE","Video generation service is temporarily unavailable","Please try again in a few moments.",503);return c("INTERNAL_ERROR","An unexpected error occurred","Please try again or contact support if the issue persists.",500)}}"undefined"!=typeof globalThis?(globalThis.__rateLimitStore||(globalThis.__rateLimitStore=new Map),i=globalThis.__rateLimitStore):i=new Map;let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/video-request/route",pathname:"/api/video-request",filename:"route",bundlePath:"app/api/video-request/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\video-request\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:E,workUnitAsyncStorage:f,serverHooks:R}=m;function g(){return(0,o.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:f})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4447,580,2289],()=>r(32327));module.exports=i})();