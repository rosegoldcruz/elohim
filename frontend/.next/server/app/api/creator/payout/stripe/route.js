"use strict";(()=>{var e={};e.id=1041,e.ids=[1041],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23405:e=>{e.exports=require("@supabase/ssr")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41666:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>f,serverHooks:()=>w,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{GET:()=>x,OPTIONS:()=>h,POST:()=>d,PUT:()=>y});var o=r(96559),a=r(48088),n=r(37719),i=r(32190),u=r(34336),p=r(72289),c=r(35282);let l=p.Ik({amount:p.ai().min(1).max(1e4),creatorId:p.Yj().uuid().optional()});async function d(e){try{let{userId:t}=auth();if(!t)return i.NextResponse.json({error:"Authentication required"},{status:401});let r=await e.json(),{amount:s,creatorId:o=t}=l.parse(r);if(o!==t)return i.NextResponse.json({error:"Access denied"},{status:403});let a=await u.W.getWallet(o);if(!a)return i.NextResponse.json({error:"Creator wallet not found"},{status:404});if(a.balance<s)return i.NextResponse.json({error:"Insufficient balance",details:{requested:s,available:a.balance}},{status:400});if(s<a.payout_threshold)return i.NextResponse.json({error:"Amount below minimum payout threshold",details:{requested:s,minimum:a.payout_threshold}},{status:400});if(!a.stripe_account_id)return i.NextResponse.json({error:"Stripe account not connected",details:"Please connect your Stripe account to receive payouts"},{status:400});let n=await u.W.payoutStripe(o,s);if(!n.success)return i.NextResponse.json({error:"Payout failed",details:n.error},{status:400});let p=await u.W.getWallet(o);return i.NextResponse.json({success:!0,data:{payout:{amount:s,transactionId:n.transaction_id,estimatedArrival:n.estimated_arrival,method:"stripe"},wallet:p},message:"Stripe payout processed successfully"})}catch(e){if(console.error("Stripe payout API error:",e),e instanceof c.G)return i.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return i.NextResponse.json({error:"Failed to process Stripe payout",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function x(e){try{let{userId:e}=auth();if(!e)return i.NextResponse.json({error:"Authentication required"},{status:401});let t=await u.W.getWallet(e);if(!t)return i.NextResponse.json({error:"Creator wallet not found"},{status:404});let r={connected:!!t.stripe_account_id,accountId:t.stripe_account_id,status:t.stripe_account_status,payoutsEnabled:"active"===t.stripe_account_status,minimumPayout:t.payout_threshold},s=(await u.W.getTransactions(e,10)).filter(e=>"payout"===e.type&&"stripe"===e.payout_method);return i.NextResponse.json({success:!0,data:{stripeStatus:r,recentPayouts:s,availableBalance:t.balance,canPayout:t.balance>=t.payout_threshold&&r.payoutsEnabled}})}catch(e){return console.error("Stripe status API error:",e),i.NextResponse.json({error:"Failed to get Stripe status",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function y(e){try{let{userId:t}=auth();if(!t)return i.NextResponse.json({error:"Authentication required"},{status:401});let{payout_threshold:r,auto_payout:s}=await e.json();if(void 0!==r&&("number"!=typeof r||r<1||r>1e3))return i.NextResponse.json({error:"Payout threshold must be between 1 and 1000 credits"},{status:400});if(!await u.W.updatePayoutPreferences(t,{payout_method:"stripe",payout_threshold:r,auto_payout:s}))return i.NextResponse.json({error:"Failed to update Stripe settings"},{status:500});let o=await u.W.getWallet(t);return i.NextResponse.json({success:!0,data:{wallet:o},message:"Stripe settings updated successfully"})}catch(e){return console.error("Update Stripe settings API error:",e),i.NextResponse.json({error:"Failed to update Stripe settings",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function h(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let f=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/creator/payout/stripe/route",pathname:"/api/creator/payout/stripe",filename:"route",bundlePath:"app/api/creator/payout/stripe/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\creator\\payout\\stripe\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:j,serverHooks:w}=f;function g(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:j})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,2289,9673,219,5804],()=>r(41666));module.exports=s})();