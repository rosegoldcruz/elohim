(()=>{var e={};e.id=4903,e.ids=[4903],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6124:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>y,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>j});var s={};t.r(s),t.d(s,{GET:()=>m,POST:()=>g});var o=t(96559),n=t(48088),i=t(37719),a=t(32190),u=t(79646),p=t(33873),c=t.n(p),d=t(79748),l=t.n(d);async function g(e){try{let r=await e.json(),{scenes:t,voiceoverScript:s,options:o,projectId:n}=r;if(!t||0===t.length)return a.NextResponse.json({success:!1,error:"No scenes provided"},{status:400});if(!s)return a.NextResponse.json({success:!1,error:"Voiceover script required"},{status:400});let i=createClient(),{data:{user:u},error:p}=await i.auth.getUser();if(p||!u)return a.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let c=`python_render_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,{error:d}=await i.from("gpu_render_jobs").insert({id:c,project_id:n,user_id:u.id,job_type:"python_pipeline",status:"queued",render_options:{scenes:t.length,useGPU:o.useGPU,enableBeatSync:o.enableBeatSync,viralMode:o.viralMode,outputFormat:o.outputFormat}});if(d)return console.error("Error creating job record:",d),a.NextResponse.json({success:!1,error:"Failed to create job"},{status:500});return _(c,r,u.id),a.NextResponse.json({success:!0,jobId:c,message:"Python rendering job started",estimatedTime:30*t.length})}catch(e){return console.error("Error in POST /api/python/render:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function m(e){try{let{searchParams:r}=new URL(e.url),t=r.get("jobId");if(!t)return a.NextResponse.json({success:!1,error:"Job ID required"},{status:400});let s=createClient(),{data:{user:o},error:n}=await s.auth.getUser();if(n||!o)return a.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let{data:i,error:u}=await s.from("gpu_render_jobs").select("*").eq("id",t).eq("user_id",o.id).single();if(u||!i)return a.NextResponse.json({success:!1,error:"Job not found"},{status:404});let p={success:!0,jobId:i.id,progress:i.progress};return"completed"===i.status?(p.outputUrl=i.output_url,p.processingTime=i.processing_time_ms,p.stats={duration:i.render_options?.duration||0,transitions:i.render_options?.scenes-1||0,beatSync:i.render_options?.enableBeatSync||!1,gpuAcceleration:i.render_options?.useGPU||!1}):"failed"===i.status&&(p.error=i.error_message),a.NextResponse.json(p)}catch(e){return console.error("Error in GET /api/python/render:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function _(e,r,t){let s=createClient(),o=Date.now();try{await s.from("gpu_render_jobs").update({status:"processing",started_at:new Date().toISOString(),progress:10}).eq("id",e);let t=c().join(process.cwd(),"temp",e);await l().mkdir(t,{recursive:!0}),await l().mkdir(c().join(t,"scenes"),{recursive:!0}),await l().mkdir(c().join(t,"voiceover"),{recursive:!0}),await l().mkdir(c().join(t,"output"),{recursive:!0}),console.log(`ðŸ“¥ Downloading ${r.scenes.length} scene videos...`);for(let o=0;o<r.scenes.length;o++){let n=r.scenes[o],i=await fetch(n.videoUrl),a=await i.arrayBuffer();await l().writeFile(c().join(t,"scenes",`scene${o+1}.mp4`),Buffer.from(a));let u=10+o/r.scenes.length*30;await s.from("gpu_render_jobs").update({progress:Math.floor(u)}).eq("id",e)}await l().writeFile(c().join(t,"voiceover","script.txt"),r.voiceoverScript),await s.from("gpu_render_jobs").update({progress:50}).eq("id",e),console.log(`ðŸ Starting Python pipeline for job ${e}...`);let n=(0,u.spawn)("python",[c().join(process.cwd(),"python","aeon_pipeline.py")],{cwd:t,env:{...process.env,USE_GPU:r.options.useGPU.toString(),ENABLE_BEAT_SYNC:r.options.enableBeatSync.toString(),VIRAL_MODE:r.options.viralMode.toString()}}),i=[];n.stdout.on("data",t=>{let o=t.toString();if(i.push(o),console.log(`Python: ${o}`),o.includes("Processing scene")){let t=50+i.filter(e=>e.includes("Processing scene")).length/r.scenes.length*30;s.from("gpu_render_jobs").update({progress:Math.floor(t)}).eq("id",e)}}),n.stderr.on("data",e=>{let r=e.toString();i.push(`ERROR: ${r}`),console.error(`Python Error: ${r}`)}),await new Promise((e,r)=>{n.on("close",t=>{0===t?e(t):r(Error(`Python process exited with code ${t}`))})});let a=c().join(t,"output","AEON_6_scene_final.mp4"),p=await l().readFile(a),d=await h(p,`${e}.mp4`),g=Date.now()-o;await s.from("gpu_render_jobs").update({status:"completed",progress:100,output_url:d,processing_time_ms:g,completed_at:new Date().toISOString()}).eq("id",e),await l().rm(t,{recursive:!0,force:!0}),console.log(`âœ… Python render job ${e} completed in ${g}ms`)}catch(r){console.error(`âŒ Python render job ${e} failed:`,r),await s.from("gpu_render_jobs").update({status:"failed",error_message:r instanceof Error?r.message:"Unknown error",completed_at:new Date().toISOString()}).eq("id",e)}}async function h(e,r){return`/api/videos/${r}`}let f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/python/render/route",pathname:"/api/python/render",filename:"route",bundlePath:"app/api/python/render/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\python\\render\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:j,serverHooks:y}=f;function v(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:j})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},79748:e=>{"use strict";e.exports=require("fs/promises")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580],()=>t(6124));module.exports=s})();