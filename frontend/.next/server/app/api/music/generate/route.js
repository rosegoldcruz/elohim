(()=>{var e={};e.id=1367,e.ids=[1367],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13064:(e,t,r)=>{"use strict";r.d(t,{Y:()=>s});var i=r(71736);class s{constructor(){this.models=[{name:"MusicGen Large",replicate_model:"meta/musicgen-large:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient","electronic","orchestral","rock","jazz"],description:"High-quality music generation with excellent coherence",price_per_second:.05},{name:"MusicGen Melody",replicate_model:"meta/musicgen-melody:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient"],description:"Melody-conditioned music generation",price_per_second:.05},{name:"Riffusion",replicate_model:"riffusion/riffusion:8cf61ea6c56afd61d8f5b9ffd14d7c216c0a93844ce2d82ac1c9ecc9c7f24e05",max_duration:10,supported_styles:["electronic","ambient","rock","jazz"],description:"Spectrogram-based music generation",price_per_second:.03},{name:"Bark Audio",replicate_model:"suno-ai/bark:b76242b40d67c76ab6742e987628a2a9ac019e11d56ab96c4e91ce03b79b2787",max_duration:15,supported_styles:["ambient","electronic","custom"],description:"Text-to-audio with music capabilities",price_per_second:.04}],this.validateApiKeys()}validateApiKeys(){if(!i._.REPLICATE_API_TOKEN)throw Error("REPLICATE_API_TOKEN is required for music generation")}async generateMusic(e){console.log(`🎵 MusicGeneratorAgent: Generating ${e.duration}s of ${e.style} music for user ${e.user_id}`),console.log(`🎯 Prompt: "${e.prompt}"`);let t=Date.now();try{let r=this.selectOptimalModel(e);console.log(`🎼 Selected model: ${r.name}`);let i=await this.generateWithModel(r,e),s=Date.now()-t;return{success:!0,audio_url:i,duration:e.duration,model_used:r.name,style:e.style,processing_time:s,metadata:{tempo:e.tempo,key:e.key,format:"mp3"}}}catch(r){return console.error("❌ Music generation failed:",r),{success:!1,audio_url:"",duration:0,model_used:"none",style:e.style,processing_time:Date.now()-t,metadata:{format:"mp3"},error:r instanceof Error?r.message:"Unknown error"}}}selectOptimalModel(e){if(e.model_preference&&"auto"!==e.model_preference){let t=this.models.find(t=>t.name.toLowerCase().includes(e.model_preference));if(t)return t}let t=this.models.filter(t=>t.supported_styles.includes(e.style)&&t.max_duration>=Math.min(e.duration,30));return 0===t.length?this.models[0]:"electronic"===e.style||"ambient"===e.style?t.find(e=>"Riffusion"===e.name)||t[0]:("orchestral"===e.style||"dramatic"===e.style)&&t.find(e=>"MusicGen Large"===e.name)||t[0]}async generateWithModel(e,t){let r=this.buildMusicPrompt(t),s=Math.min(t.duration,e.max_duration);console.log(`🎹 Generating with ${e.name}: "${r}" (${s}s)`);let o=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${i._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:e.replicate_model,input:this.buildModelInput(e,r,s,t)})});if(!o.ok)throw Error(`Replicate API error: ${o.statusText}`);let n=await o.json();return this.pollReplicatePrediction(n.id)}buildMusicPrompt(e){let t=e.prompt,r={upbeat:"energetic, fast-paced, positive",chill:"relaxed, mellow, smooth",dramatic:"intense, emotional, cinematic",ambient:"atmospheric, ethereal, spacious",electronic:"synthesized, digital, modern",orchestral:"classical instruments, symphonic, grand",rock:"guitar-driven, powerful, rhythmic",jazz:"improvised, sophisticated, swing"};if(r[e.style]&&(t+=`, ${r[e.style]}`),e.tempo){let r=e.tempo>120?"fast tempo":e.tempo>90?"medium tempo":"slow tempo";t+=`, ${r}`}return e.key&&(t+=`, in ${e.key}`),e.instruments&&e.instruments.length>0&&(t+=`, featuring ${e.instruments.join(", ")}`),t}buildModelInput(e,t,r,i){let s={prompt:t,duration:r};return e.name.includes("MusicGen")?{...s,model_version:"large",output_format:"mp3",normalization_strategy:"peak"}:"Riffusion"===e.name?{prompt_a:t,prompt_b:t,denoising:.75,num_inference_steps:50}:"Bark Audio"===e.name?{prompt:`♪ ${t} ♪`,text_temp:.7,waveform_temp:.7}:s}async pollReplicatePrediction(e){let t=0;for(;t<60;){let r=await fetch(`https://api.replicate.com/v1/predictions/${e}`,{headers:{Authorization:`Token ${i._.REPLICATE_API_TOKEN}`}});if(!r.ok)throw Error(`Replicate polling error: ${r.statusText}`);let s=await r.json();if("succeeded"===s.status){if("string"==typeof s.output)return s.output;if(Array.isArray(s.output)&&s.output.length>0)return s.output[0];throw Error("Invalid output format from Replicate")}if("failed"===s.status)throw Error(`Music generation failed: ${s.error}`);await new Promise(e=>setTimeout(e,5e3)),t++}throw Error("Music generation timeout")}getAvailableModels(){return this.models}estimateCost(e,t){return e*(t&&this.models.find(e=>e.name.toLowerCase().includes(t.toLowerCase()))||this.models[0]).price_per_second}}},23405:e=>{"use strict";e.exports=require("@supabase/ssr")},28086:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var i=r(23405),s=r(44999);let o=()=>{let e=(0,s.UL)();return(0,i.createServerClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",{cookies:{get:t=>e.get(t)?.value,set(t,r,i){e.set({name:t,value:r,...i})},remove(t,r){e.set({name:t,value:"",...r})}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32871:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});var i=r(72289);function s(e){let t="object"==typeof e.client?e.client:{},r="object"==typeof e.server?e.server:{},s=e.shared,o=e.runtimeEnv?e.runtimeEnv:{...process.env,...e.experimental__runtimeEnv};return function(e){let t=e.runtimeEnvStrict??e.runtimeEnv??process.env;if(e.emptyStringAsUndefined)for(let[e,r]of Object.entries(t))""===r&&delete t[e];if(e.skipValidation)return t;let r="object"==typeof e.client?e.client:{},s="object"==typeof e.server?e.server:{},o="object"==typeof e.shared?e.shared:{},n=i.Ik(r),a=i.Ik(s),c=i.Ik(o),l=e.isServer??"undefined"==typeof window,u=n.merge(c),_=a.merge(c).merge(n),d=l?_.safeParse(t):u.safeParse(t),p=e.onValidationError??(e=>{throw console.error("❌ Invalid environment variables:",e.flatten().fieldErrors),Error("Invalid environment variables")}),m=e.onInvalidAccess??(e=>{throw Error("❌ Attempted to access a server-side environment variable on the client")});return!1===d.success?p(d.error):new Proxy(d.data,{get(t,r){if("string"==typeof r&&"__esModule"!==r&&"$$typeof"!==r)return l||!e.clientPrefix||r.startsWith(e.clientPrefix)||void 0!==c.shape[r]?t[r]:m(r)}})}({...e,shared:s,client:t,server:r,clientPrefix:"NEXT_PUBLIC_",runtimeEnv:o})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71736:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var i=r(32871),s=r(72289);let o=(0,i.w)({server:{SUPABASE_URL:s.Yj().url(),SUPABASE_SERVICE_ROLE_KEY:s.Yj().min(1),SUPABASE_JWT_SECRET:s.Yj().min(1),STRIPE_SECRET_KEY:s.Yj().min(1),STRIPE_WEBHOOK_SECRET:s.Yj().min(1),OPENAI_API_KEY:s.Yj().min(1),REPLICATE_API_TOKEN:s.Yj().min(1),DEEPSEEK_API_KEY:s.Yj().min(1).optional(),CLAUDE_API_KEY:s.Yj().min(1).optional(),ELEVENLABS_API_KEY:s.Yj().min(1).optional(),BLOB_READ_WRITE_TOKEN:s.Yj().min(1),APP_ENV:s.k5(["development","production","test"]).default("development"),ALLOWED_ORIGINS:s.Yj().default("*")},client:{NEXT_PUBLIC_APP_URL:s.Yj().url(),NEXT_PUBLIC_SUPABASE_URL:s.Yj().url(),NEXT_PUBLIC_SUPABASE_ANON_KEY:s.Yj().min(1),NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:s.Yj().min(1),NEXT_PUBLIC_STRIPE_PRICE_STARTER_PASS:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_PRO_MONTHLY:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_PRO_YEARLY:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_CREATOR_MONTHLY:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_CREATOR_YEARLY:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_STUDIO_MONTHLY:s.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_STUDIO_YEARLY:s.Yj().min(1).optional()},runtimeEnv:{SUPABASE_URL:process.env.SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:process.env.SUPABASE_SERVICE_ROLE_KEY,SUPABASE_JWT_SECRET:process.env.SUPABASE_JWT_SECRET,STRIPE_SECRET_KEY:process.env.STRIPE_SECRET_KEY,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET,OPENAI_API_KEY:process.env.OPENAI_API_KEY,REPLICATE_API_TOKEN:process.env.REPLICATE_API_TOKEN,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,CLAUDE_API_KEY:process.env.CLAUDE_API_KEY,ELEVENLABS_API_KEY:process.env.ELEVENLABS_API_KEY,BLOB_READ_WRITE_TOKEN:process.env.BLOB_READ_WRITE_TOKEN,APP_ENV:process.env.APP_ENV,ALLOWED_ORIGINS:process.env.ALLOWED_ORIGINS,NEXT_PUBLIC_APP_URL:"https://smart4technology.com",NEXT_PUBLIC_SUPABASE_URL:"https://iqcwwufogdoaiuzyqney.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,NEXT_PUBLIC_STRIPE_PRICE_STARTER_PASS:"price_1RiUVxL0i8aKDQ0rtsV8jP",NEXT_PUBLIC_STRIPE_PRICE_PRO_MONTHLY:"price_1ReF56L0i8aKDQ0rZzEwTzVD",NEXT_PUBLIC_STRIPE_PRICE_PRO_YEARLY:"price_1ReF6DL0i8aKDQ0rV0VJ7tx8",NEXT_PUBLIC_STRIPE_PRICE_CREATOR_MONTHLY:"price_1ReF9hL0i8aKDQ0riUb3x64F",NEXT_PUBLIC_STRIPE_PRICE_CREATOR_YEARLY:"price_1ReFAZL0i8aKDQ0rXHYNfLbw",NEXT_PUBLIC_STRIPE_PRICE_STUDIO_MONTHLY:"price_1ReFCML0i8aKDQ0rwmFoSEZP",NEXT_PUBLIC_STRIPE_PRICE_STUDIO_YEARLY:"price_1ReFGlL0i8aKDQ0riqTF84UA"},skipValidation:!!process.env.SKIP_ENV_VALIDATION,emptyStringAsUndefined:!0})},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=o?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}(r(61120));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let o={current:null},n="function"==typeof i.cache?i.cache:e=>e,a=console.warn;function c(e){return function(...t){a(e(...t))}}n(e=>{try{a(o.current)}finally{o.current=null}})},78335:()=>{},96487:()=>{},98528:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>p,serverHooks:()=>I,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>E});var i={};r.r(i),r.d(i,{GET:()=>d,POST:()=>_});var s=r(96559),o=r(48088),n=r(37719),a=r(32190),c=r(13064),l=r(28086),u=r(71736);async function _(e){try{let{prompt:t,duration:r=30,style:i="upbeat",user_id:s,project_id:o,model_preference:n="auto",tempo:_,key:d,instruments:p}=await e.json();if(!t)return a.NextResponse.json({error:"Prompt is required"},{status:400});if(!s)return a.NextResponse.json({error:"User ID is required"},{status:400});if(!u._.REPLICATE_API_TOKEN)return a.NextResponse.json({error:"Replicate API key not configured"},{status:500});console.log(`🎵 Generating music for user ${s}: "${t}"`),console.log(`🎼 Parameters: ${r}s, ${i} style, ${n} model`);let m=(0,l.U)(),E=null;if(o){let{data:e,error:a}=await m.from("music_generations").insert({user_id:s,project_id:o,prompt:t,style:i,duration:r,model_preference:n,status:"processing",created_at:new Date().toISOString()}).select().single();a?console.warn("⚠️ Failed to create music record:",a):E=e}let I=new c.Y,P=await I.generateMusic({prompt:t,duration:Math.min(r,30),style:i,user_id:s,project_id:o,model_preference:"auto"===n?void 0:n,tempo:_,key:d,instruments:p});if(E&&P.success?await m.from("music_generations").update({status:"completed",audio_url:P.audio_url,model_used:P.model_used,processing_time:P.processing_time,completed_at:new Date().toISOString()}).eq("id",E.id):E&&!P.success&&await m.from("music_generations").update({status:"failed",error_message:P.error,processing_time:P.processing_time,completed_at:new Date().toISOString()}).eq("id",E.id),!P.success)return a.NextResponse.json({error:"Music generation failed",details:P.error},{status:500});return console.log(`✅ Music generated successfully in ${P.processing_time}ms`),console.log(`🎵 Audio URL: ${P.audio_url}`),a.NextResponse.json({success:!0,music:{audio_url:P.audio_url,duration:P.duration,style:P.style,model_used:P.model_used,processing_time:P.processing_time,metadata:P.metadata},generation_id:E?.id,cost_estimate:I.estimateCost(r,n),message:`🎵 ${i} music generated successfully using ${P.model_used}!`})}catch(e){return console.error("❌ Music generation API error:",e),a.NextResponse.json({error:"Music generation failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action"),i=new c.Y;if("models"===r)return a.NextResponse.json({success:!0,models:i.getAvailableModels(),supported_styles:["upbeat","chill","dramatic","ambient","electronic","orchestral","rock","jazz","custom"]});if("estimate"===r){let e=parseInt(t.get("duration")||"30"),r=t.get("model")||"auto";return a.NextResponse.json({success:!0,cost_estimate:i.estimateCost(e,r),duration:e,model_used:r})}return a.NextResponse.json({success:!0,message:"AEON Music Generation API",endpoints:{"POST /api/music/generate":"Generate music from prompt","GET /api/music/generate?action=models":"Get available models","GET /api/music/generate?action=estimate&duration=30&model=musicgen":"Estimate cost"},version:"1.0.0"})}catch(e){return console.error("❌ Music API GET error:",e),a.NextResponse.json({error:"API request failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/music/generate/route",pathname:"/api/music/generate",filename:"route",bundlePath:"app/api/music/generate/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\music\\generate\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:m,workUnitAsyncStorage:E,serverHooks:I}=p;function P(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:E})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4447,580,2289,4999],()=>r(98528));module.exports=i})();