(()=>{var e={};e.id=3930,e.ids=[3930],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9036:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});var s=r(19816),o=r(84164);let i=`
You are the AEON Scriptwriter Agent for TikTok-optimized, cinematic, chronological videos.

TASK: Write a 1-minute video script and a detailed scene list for the following topic:
[TARGET TOPIC AND STYLE INJECTED HERE]

Output only JSON with this exact format:
{
  "narration": "<60-second narration, with hooks in first and last line. Chronological, no filler.>",
  "scenes": [
    {
      "scene_number": 1,
      "function": "Hook",
      "timestamp": "0-4s",
      "visual": "Describe first visual/camera/angle/movement",
      "audio": "Relevant background/foley/transition audio",
      "overlay": "TikTok text/font/emoji overlays",
      "transition": "First-frame freeze, pop, or viral effect",
      "text_on_screen": "Short, bold, TikTok-native text"
    },
    {
      "scene_number": 2,
      "function": "World Setup",
      "timestamp": "4-8s",
      "visual": "...",
      "audio": "...",
      "overlay": "...",
      "transition": "...",
      "text_on_screen": "..."
    }
    // continue up to scene 10â€“12 (ending with Resolution/CTA)
  ]
}

Rules:
- Scenes MUST be in correct narrative order: Hook â†’ Setup â†’ Conflict â†’ Escalation â†’ Climax â†’ Resolution â†’ CTA.
- Each scene MUST have all schema fields and escalate the story.
- No summaries, no bullet lists, no non-JSON output. If you can't follow, throw an error and retry.
`;async function n(e,t){let r=new s.z4({apiKey:process.env.OPENAI_API_KEY||""}),n=i.replace("[TARGET TOPIC AND STYLE INJECTED HERE]",`${e} in the style of ${t}`),a=0,c=null,l=null;for(;a<3&&!c;)try{let e=((await r.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are a disciplined cinematic script generator for TikTok and AEON."},{role:"user",content:n}],max_tokens:1200,temperature:.7})).choices[0].message.content||"").match(/\{[\s\S]*\}/);if(!e)throw Error("No JSON block found in LLM output.");if(c=JSON.parse(e[0]),!(0,o.j)(c))throw Error("Output does not match required cinematic schema.");return c}catch(e){if(a+=1,l=e,a>=3)throw Error(`ScriptWriterAgent failed after 3 attempts: ${e}`)}throw l||Error("Unknown failure in ScriptWriterAgent.")}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},13064:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var s=r(71736);class o{constructor(){this.models=[{name:"MusicGen Large",replicate_model:"meta/musicgen-large:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient","electronic","orchestral","rock","jazz"],description:"High-quality music generation with excellent coherence",price_per_second:.05},{name:"MusicGen Melody",replicate_model:"meta/musicgen-melody:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",max_duration:30,supported_styles:["upbeat","chill","dramatic","ambient"],description:"Melody-conditioned music generation",price_per_second:.05},{name:"Riffusion",replicate_model:"riffusion/riffusion:8cf61ea6c56afd61d8f5b9ffd14d7c216c0a93844ce2d82ac1c9ecc9c7f24e05",max_duration:10,supported_styles:["electronic","ambient","rock","jazz"],description:"Spectrogram-based music generation",price_per_second:.03},{name:"Bark Audio",replicate_model:"suno-ai/bark:b76242b40d67c76ab6742e987628a2a9ac019e11d56ab96c4e91ce03b79b2787",max_duration:15,supported_styles:["ambient","electronic","custom"],description:"Text-to-audio with music capabilities",price_per_second:.04}],this.validateApiKeys()}validateApiKeys(){if(!s._.REPLICATE_API_TOKEN)throw Error("REPLICATE_API_TOKEN is required for music generation")}async generateMusic(e){console.log(`ðŸŽµ MusicGeneratorAgent: Generating ${e.duration}s of ${e.style} music for user ${e.user_id}`),console.log(`ðŸŽ¯ Prompt: "${e.prompt}"`);let t=Date.now();try{let r=this.selectOptimalModel(e);console.log(`ðŸŽ¼ Selected model: ${r.name}`);let s=await this.generateWithModel(r,e),o=Date.now()-t;return{success:!0,audio_url:s,duration:e.duration,model_used:r.name,style:e.style,processing_time:o,metadata:{tempo:e.tempo,key:e.key,format:"mp3"}}}catch(r){return console.error("âŒ Music generation failed:",r),{success:!1,audio_url:"",duration:0,model_used:"none",style:e.style,processing_time:Date.now()-t,metadata:{format:"mp3"},error:r instanceof Error?r.message:"Unknown error"}}}selectOptimalModel(e){if(e.model_preference&&"auto"!==e.model_preference){let t=this.models.find(t=>t.name.toLowerCase().includes(e.model_preference));if(t)return t}let t=this.models.filter(t=>t.supported_styles.includes(e.style)&&t.max_duration>=Math.min(e.duration,30));return 0===t.length?this.models[0]:"electronic"===e.style||"ambient"===e.style?t.find(e=>"Riffusion"===e.name)||t[0]:("orchestral"===e.style||"dramatic"===e.style)&&t.find(e=>"MusicGen Large"===e.name)||t[0]}async generateWithModel(e,t){let r=this.buildMusicPrompt(t),o=Math.min(t.duration,e.max_duration);console.log(`ðŸŽ¹ Generating with ${e.name}: "${r}" (${o}s)`);let i=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:e.replicate_model,input:this.buildModelInput(e,r,o,t)})});if(!i.ok)throw Error(`Replicate API error: ${i.statusText}`);let n=await i.json();return this.pollReplicatePrediction(n.id)}buildMusicPrompt(e){let t=e.prompt,r={upbeat:"energetic, fast-paced, positive",chill:"relaxed, mellow, smooth",dramatic:"intense, emotional, cinematic",ambient:"atmospheric, ethereal, spacious",electronic:"synthesized, digital, modern",orchestral:"classical instruments, symphonic, grand",rock:"guitar-driven, powerful, rhythmic",jazz:"improvised, sophisticated, swing"};if(r[e.style]&&(t+=`, ${r[e.style]}`),e.tempo){let r=e.tempo>120?"fast tempo":e.tempo>90?"medium tempo":"slow tempo";t+=`, ${r}`}return e.key&&(t+=`, in ${e.key}`),e.instruments&&e.instruments.length>0&&(t+=`, featuring ${e.instruments.join(", ")}`),t}buildModelInput(e,t,r,s){let o={prompt:t,duration:r};return e.name.includes("MusicGen")?{...o,model_version:"large",output_format:"mp3",normalization_strategy:"peak"}:"Riffusion"===e.name?{prompt_a:t,prompt_b:t,denoising:.75,num_inference_steps:50}:"Bark Audio"===e.name?{prompt:`â™ª ${t} â™ª`,text_temp:.7,waveform_temp:.7}:o}async pollReplicatePrediction(e){let t=0;for(;t<60;){let r=await fetch(`https://api.replicate.com/v1/predictions/${e}`,{headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`}});if(!r.ok)throw Error(`Replicate polling error: ${r.statusText}`);let o=await r.json();if("succeeded"===o.status){if("string"==typeof o.output)return o.output;if(Array.isArray(o.output)&&o.output.length>0)return o.output[0];throw Error("Invalid output format from Replicate")}if("failed"===o.status)throw Error(`Music generation failed: ${o.error}`);await new Promise(e=>setTimeout(e,5e3)),t++}throw Error("Music generation timeout")}getAvailableModels(){return this.models}estimateCost(e,t){return e*(t&&this.models.find(e=>e.name.toLowerCase().includes(t.toLowerCase()))||this.models[0]).price_per_second}}},16965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>E,serverHooks:()=>I,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>P});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>f,POST:()=>_});var o=r(96559),i=r(48088),n=r(37719),a=r(32190),c=r(9036),l=r(66151),d=r(13064);class u{constructor(){this.visualAgent=new l.f,this.musicAgent=new d.Y}async generateProject(e){console.log(`ðŸš€ UnifiedGenerationAgent: Starting project generation for user ${e.user_id}`),console.log(`ðŸŽ¯ Creative prompt: "${e.creative_prompt}"`),console.log(`ðŸŽ¬ Style: ${e.style}, Platform: ${e.platform}, Duration: ${e.duration}s`);let t=Date.now(),r={success:!1,project_id:e.project_id||`project_${Date.now()}_${e.user_id}`,assets:{},total_processing_time:0,total_cost_estimate:0,ready_for_editing:!1};try{console.log("\uD83D\uDCDD Step 1: Generating cinematic script...");let s=await this.generateScript(e);if(r.assets.script=s,!s.success||!s.content)throw Error("Script generation failed - cannot proceed");console.log("\uD83C\uDFAC\uD83C\uDFB5 Step 2: Generating video and music in parallel...");let[o,i]=await Promise.allSettled([this.generateVideo(e,s.content),this.generateMusic(e,s.content)]);return"fulfilled"===o.status?r.assets.video=o.value:(console.error("âŒ Video generation failed:",o.reason),r.assets.video={id:`video_${Date.now()}`,type:"video",metadata:{processing_time:0},success:!1,error:o.reason?.message||"Video generation failed"}),"fulfilled"===i.status?r.assets.music=i.value:(console.error("âŒ Music generation failed:",i.reason),r.assets.music={id:`music_${Date.now()}`,type:"music",metadata:{processing_time:0},success:!1,error:i.reason?.message||"Music generation failed"}),r.total_processing_time=Date.now()-t,r.total_cost_estimate=this.calculateTotalCost(r.assets),r.ready_for_editing=!!(r.assets.script?.success&&(r.assets.video?.success||r.assets.music?.success)),r.success=r.ready_for_editing,console.log(`âœ… UnifiedGenerationAgent: Project generated in ${r.total_processing_time}ms`),console.log(`ðŸ’° Total cost estimate: $${r.total_cost_estimate.toFixed(4)}`),console.log(`ðŸŽ¯ Ready for editing: ${r.ready_for_editing}`),r}catch(e){return console.error("âŒ UnifiedGenerationAgent: Critical error:",e),r.total_processing_time=Date.now()-t,r.error=e instanceof Error?e.message:"Unknown error",r.success=!1,r}}async generateScript(e){let t=Date.now();try{let r=this.enhancePromptForScript(e),s=await (0,c.m)(r,e.style);return{id:`script_${Date.now()}`,type:"script",content:s,metadata:{model_used:"gpt-4o",processing_time:Date.now()-t,cost_estimate:.02},success:!0}}catch(e){return{id:`script_${Date.now()}`,type:"script",metadata:{processing_time:Date.now()-t},success:!1,error:e instanceof Error?e.message:"Script generation failed"}}}async generateVideo(e,t){let r=Date.now();try{let s={user_id:e.user_id,project_id:e.project_id,scenes:t.scenes.map((t,r)=>({description:t.description,duration:t.duration,sceneNumber:r+1,visualStyle:e.preferences?.video_style||e.style,mood:t.mood||"neutral"})),style:e.style,platform:e.platform,preferredModel:e.preferences?.preferred_models?.video},o=await this.visualAgent.generateScenes(s);if(!o.success)throw Error(o.error||"Video generation failed");let i=o.scenes.filter(e=>e.success).map(e=>e.videoUrl);return{id:`video_${Date.now()}`,type:"video",url:i[0],content:{scenes:o.scenes,totalScenes:o.totalScenes,successfulScenes:o.successfulScenes},metadata:{model_used:"multi-provider",processing_time:Date.now()-r,cost_estimate:this.visualAgent.estimateCost(o.totalScenes)},success:!0}}catch(e){return{id:`video_${Date.now()}`,type:"video",metadata:{processing_time:Date.now()-r},success:!1,error:e instanceof Error?e.message:"Video generation failed"}}}async generateMusic(e,t){let r=Date.now();try{let s={prompt:this.buildMusicPrompt(e,t),duration:Math.min(e.duration,30),style:this.mapStyleToMusicStyle(e.style),user_id:e.user_id,project_id:e.project_id,model_preference:e.preferences?.preferred_models?.music},o=await this.musicAgent.generateMusic(s);if(!o.success)throw Error(o.error||"Music generation failed");return{id:`music_${Date.now()}`,type:"music",url:o.audio_url,content:{duration:o.duration,style:o.style,metadata:o.metadata},metadata:{model_used:o.model_used,processing_time:Date.now()-r,cost_estimate:this.musicAgent.estimateCost(e.duration)},success:!0}}catch(e){return{id:`music_${Date.now()}`,type:"music",metadata:{processing_time:Date.now()-r},success:!1,error:e instanceof Error?e.message:"Music generation failed"}}}enhancePromptForScript(e){return`Create ${({tiktok:"viral TikTok content with strong hooks and trending elements",reels:"Instagram Reels optimized for engagement and shareability",shorts:"YouTube Shorts with clear value proposition and retention",youtube:"YouTube video with educational or entertainment value"})[e.platform]} ${({viral:"designed to go viral with pattern interrupts and engagement hooks",cinematic:"with cinematic storytelling and visual appeal",educational:"that educates while entertaining",entertainment:"focused on pure entertainment value",commercial:"with clear commercial intent and call-to-action"})[e.style]} about: ${e.creative_prompt}. Duration: ${e.duration} seconds.`}buildMusicPrompt(e,t){let r=t.scenes[0]?.mood||"energetic",s=e.preferences?.music_genre||"electronic";return`${s} music with ${r} mood for ${e.platform} video about ${e.creative_prompt}`}mapStyleToMusicStyle(e){return({viral:"upbeat",cinematic:"dramatic",educational:"ambient",entertainment:"upbeat",commercial:"electronic"})[e]||"upbeat"}calculateTotalCost(e){let t=0;return e.script?.metadata.cost_estimate&&(t+=e.script.metadata.cost_estimate),e.video?.metadata.cost_estimate&&(t+=e.video.metadata.cost_estimate),e.music?.metadata.cost_estimate&&(t+=e.music.metadata.cost_estimate),t}}var p=r(28086),m=r(71736);async function _(e){try{let{user_id:t,project_id:r,creative_prompt:s,style:o="viral",platform:i="tiktok",duration:n=60,preferences:c={}}=await e.json();if(!t)return a.NextResponse.json({error:"User ID is required"},{status:400});if(!s)return a.NextResponse.json({error:"Creative prompt is required"},{status:400});if(!m._.OPENAI_API_KEY||!m._.REPLICATE_API_TOKEN)return a.NextResponse.json({error:"Required API keys not configured"},{status:500});console.log(`ðŸš€ Studio Generation Request from user ${t}`),console.log(`ðŸŽ¯ Prompt: "${s}"`),console.log(`ðŸŽ¬ Style: ${o}, Platform: ${i}, Duration: ${n}s`);let l=(0,p.U)(),{data:d,error:_}=await l.from("projects").insert({user_id:t,name:`${s.substring(0,50)}...`,description:s,style:o,platform:i,duration:n,status:"generating",preferences:c,created_at:new Date().toISOString()}).select().single();if(_)return console.error("âŒ Failed to create project:",_),a.NextResponse.json({error:"Failed to create project"},{status:500});let f=r||d.id,g=new u,E=await g.generateProject({user_id:t,project_id:f,creative_prompt:s,style:o,platform:i,duration:Math.min(n,120),preferences:c}),h={status:E.success?"completed":"failed",processing_time:E.total_processing_time,cost_estimate:E.total_cost_estimate,ready_for_editing:E.ready_for_editing,updated_at:new Date().toISOString()};if(E.error&&(h.error_message=E.error),E.assets.script?.success&&(h.script_content=E.assets.script.content),E.assets.video?.success&&(h.video_url=E.assets.video.url,h.video_scenes=E.assets.video.content),E.assets.music?.success&&(h.music_url=E.assets.music.url,h.music_metadata=E.assets.music.content),await l.from("projects").update(h).eq("id",f),!E.success)return a.NextResponse.json({error:"Project generation failed",details:E.error,project_id:f,partial_results:E.assets},{status:500});return console.log(`âœ… Project generated successfully in ${E.total_processing_time}ms`),console.log(`ðŸ’° Total cost: $${E.total_cost_estimate.toFixed(4)}`),a.NextResponse.json({success:!0,project_id:f,assets:{script:E.assets.script?.success?{content:E.assets.script.content,processing_time:E.assets.script.metadata.processing_time}:null,video:E.assets.video?.success?{url:E.assets.video.url,scenes:E.assets.video.content?.scenes,model_used:E.assets.video.metadata.model_used,processing_time:E.assets.video.metadata.processing_time}:null,music:E.assets.music?.success?{url:E.assets.music.url,duration:E.assets.music.content?.duration,style:E.assets.music.content?.style,model_used:E.assets.music.metadata.model_used,processing_time:E.assets.music.metadata.processing_time}:null},metrics:{total_processing_time:E.total_processing_time,total_cost_estimate:E.total_cost_estimate,ready_for_editing:E.ready_for_editing},editor_url:`/studio/editor/${f}`,message:`ðŸŽ¬ Complete video project generated successfully! Ready for editing in AEON Studio.`})}catch(e){return console.error("âŒ Studio generation API error:",e),a.NextResponse.json({error:"Project generation failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function f(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action"),s=t.get("user_id");if("projects"===r&&s){let e=(0,p.U)(),{data:t,error:r}=await e.from("projects").select("*").eq("user_id",s).order("created_at",{ascending:!1});if(r)throw r;return a.NextResponse.json({success:!0,projects:t||[]})}if("project"===r&&t.get("project_id")){let e=t.get("project_id"),r=(0,p.U)(),{data:s,error:o}=await r.from("projects").select("*").eq("id",e).single();if(o)throw o;return a.NextResponse.json({success:!0,project:s})}return a.NextResponse.json({success:!0,message:"AEON Studio Generation API",endpoints:{"POST /api/studio/generate":"Generate complete video project from creative prompt","GET /api/studio/generate?action=projects&user_id=xxx":"Get user's projects","GET /api/studio/generate?action=project&project_id=xxx":"Get specific project"},supported_styles:["viral","cinematic","educational","entertainment","commercial"],supported_platforms:["tiktok","reels","shorts","youtube"],version:"1.0.0"})}catch(e){return console.error("âŒ Studio API GET error:",e),a.NextResponse.json({error:"API request failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("project_id"),s=t.get("user_id");if(!r||!s)return a.NextResponse.json({error:"Project ID and User ID are required"},{status:400});let o=(0,p.U)(),{error:i}=await o.from("projects").delete().eq("id",r).eq("user_id",s);if(i)throw i;return a.NextResponse.json({success:!0,message:"Project deleted successfully"})}catch(e){return console.error("âŒ Studio API DELETE error:",e),a.NextResponse.json({error:"Failed to delete project",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/studio/generate/route",pathname:"/api/studio/generate",filename:"route",bundlePath:"app/api/studio/generate/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\studio\\generate\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:P,serverHooks:I}=E;function y(){return(0,n.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:P})}},23405:e=>{"use strict";e.exports=require("@supabase/ssr")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var s=r(23405),o=r(44999);let i=()=>{let e=(0,o.UL)();return(0,s.createServerClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){e.set({name:t,value:r,...s})},remove(t,r){e.set({name:t,value:"",...r})}}})}},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},37830:e=>{"use strict";e.exports=require("node:stream/web")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66151:(e,t,r)=>{"use strict";r.d(t,{f:()=>o});var s=r(71736);class o{async generateScenes(e){console.log(`ðŸŽ¥ VisualGeneratorAgent: Generating ${e.scenes.length} scenes for user ${e.user_id}`);let t=Date.now(),r=[];try{this.validateApiKeys();for(let t=0;t<e.scenes.length;t++){let s=e.scenes[t];console.log(`ðŸŽ¬ Generating scene ${t+1}/${e.scenes.length}: ${s.description.substring(0,50)}...`);try{let o=await this.generateSingleScene(s,t,e);r.push(o),o.success?console.log(`âœ… Scene ${t+1} generated successfully: ${o.videoUrl}`):console.error(`âŒ Scene ${t+1} failed: ${o.error}`)}catch(e){console.error(`âŒ Scene ${t+1} generation error:`,e),r.push({sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:s.description,videoUrl:"",duration:s.duration,modelUsed:"none",success:!1,error:e instanceof Error?e.message:"Unknown error",processingTime:0})}}let s=Date.now()-t,o=r.filter(e=>e.success).length,i=r.length-o;return console.log(`ðŸŽ¯ VisualGeneratorAgent: Completed ${o}/${r.length} scenes in ${s}ms`),{success:o>0,scenes:r,totalScenes:r.length,successfulScenes:o,failedScenes:i,totalProcessingTime:s,error:i>0?`${i} scenes failed to generate`:void 0}}catch(s){return console.error("âŒ VisualGeneratorAgent: Critical error:",s),{success:!1,scenes:r,totalScenes:e.scenes.length,successfulScenes:0,failedScenes:e.scenes.length,totalProcessingTime:Date.now()-t,error:s instanceof Error?s.message:"Unknown error"}}}async generateSingleScene(e,t,r){let s=Date.now(),o=this.buildVideoPrompt(e,r.style);console.log(`ðŸŽ¥ Generating scene ${t+1} with multi-provider fallback: "${o.substring(0,100)}..."`);let i=this.getProviderPriority(r.preferredModel),n=null;for(let r of i){let i=this.models.find(e=>e.provider===r);if(!i){console.warn(`âš ï¸ No model found for provider: ${r}`);continue}try{let r;switch(console.log(`ðŸ”„ Attempting scene ${t+1} with ${i.name}`),i.provider){case"replicate":r=await this.generateWithReplicate(i.modelId,o,e.duration);break;case"minimax":r=await this.generateWithMinimax(i.modelId,o,e.duration);break;case"kling":r=await this.generateWithKling(i.modelId,o,e.duration);break;default:throw Error(`Unsupported provider: ${i.provider}`)}let n=Date.now()-s;return console.log(`âœ… Scene ${t+1} generated successfully with ${i.name}`),{sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:o,videoUrl:r,duration:e.duration,modelUsed:i.name,success:!0,processingTime:n}}catch(e){console.warn(`âš ï¸ ${i.name} failed for scene ${t+1}:`,e),n=e instanceof Error?e:Error(`${i.name} generation failed`);continue}}return console.error(`âŒ Scene ${t+1} failed with all providers`),{sceneIndex:t,sceneId:`scene_${t}_${Date.now()}`,prompt:o,videoUrl:"",duration:e.duration,modelUsed:"none",success:!1,error:n?.message||"All video generation providers failed",processingTime:Date.now()-s}}getProviderPriority(e){let t=["replicate","minimax","kling"];if(e){let r=this.models.find(t=>t.name.toLowerCase().includes(e.toLowerCase()))?.provider;if(r)return[r,...t.filter(e=>e!==r)]}return t}async generateWithReplicate(e,t,r){let o=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:e,input:{prompt:t,duration:Math.min(r,10),aspect_ratio:"16:9",fps:30}})});if(!o.ok)throw Error(`Replicate API error: ${o.statusText}`);let i=await o.json();return this.pollReplicatePrediction(i.id)}async pollReplicatePrediction(e){let t=0;for(;t<60;){let r=await fetch(`https://api.replicate.com/v1/predictions/${e}`,{headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`}});if(!r.ok)throw Error(`Replicate polling error: ${r.statusText}`);let o=await r.json();if("succeeded"===o.status)return o.output;if("failed"===o.status)throw Error(`Replicate generation failed: ${o.error}`);await new Promise(e=>setTimeout(e,5e3)),t++}throw Error("Replicate generation timeout")}async generateWithMinimax(e,t,r){console.log(`ðŸŽ¬ Minimax generation: ${e}, ${t}, ${r}s`);let o=this.getMinimaxReplicateModel(e),i=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:o,input:{prompt:t,duration:Math.min(r,6),prompt_optimizer:!0,aspect_ratio:"16:9"}})});if(!i.ok)throw Error(`Minimax API error: ${i.statusText}`);let n=await i.json();return this.pollReplicatePrediction(n.id)}async generateWithKling(e,t,r){console.log(`ðŸŽ¬ Kling generation: ${e}, ${t}, ${r}s`);let o=this.getKlingReplicateModel(e),i=await fetch("https://api.replicate.com/v1/predictions",{method:"POST",headers:{Authorization:`Token ${s._.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({version:o,input:{prompt:t,duration:Math.min(r,5),aspect_ratio:"16:9",cfg_scale:7.5}})});if(!i.ok)throw Error(`Kling API error: ${i.statusText}`);let n=await i.json();return this.pollReplicatePrediction(n.id)}selectModelForScene(e){return e.energy>=8?this.models.find(e=>e.name.includes("Runway"))||this.models[0]:e.duration>5&&this.models.find(e=>"minimax"===e.provider)||this.models[0]}buildVideoPrompt(e,t){let r=e.description;return e.camera&&(r+=`, ${e.camera}`),e.shotType&&(r+=`, ${e.shotType}`),t&&(r+=`, ${t} style`),r+=", high quality, professional cinematography, 4K"}validateApiKeys(){if(!s._.REPLICATE_API_TOKEN)throw Error("REPLICATE_API_TOKEN is required for video generation");console.log("âœ… API keys validated")}constructor(){this.models=[{name:"Runway Gen-3",provider:"replicate",modelId:"runway-ml/runway-gen3-alpha:b05b1dff1d8c6dc63d14b0cdb42135378dcb87f6373b0d3d341ede46e59e2dbe",maxDuration:10,aspectRatio:"16:9"},{name:"Stable Video Diffusion",provider:"replicate",modelId:"stability-ai/stable-video-diffusion:3f0457e4619daac51203dedb1a4c069c4c7e0e5e",maxDuration:4,aspectRatio:"16:9"},{name:"Minimax Video-01",provider:"minimax",modelId:"video-01",maxDuration:6,aspectRatio:"16:9"},{name:"Kling v1.6",provider:"kling",modelId:"kling-v1.6-standard",maxDuration:5,aspectRatio:"16:9"},{name:"Luma Dream Machine",provider:"replicate",modelId:"lumalabs/dream-machine:b49c4d9e0d7c4e8b9a8b9c8d9e0f1a2b3c4d5e6f",maxDuration:5,aspectRatio:"16:9"},{name:"Haiper Video",provider:"replicate",modelId:"haiper-ai/haiper-video-v2:c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3",maxDuration:4,aspectRatio:"16:9"}]}}},71736:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});var s=r(32871),o=r(72289);let i=(0,s.w)({server:{SUPABASE_URL:o.Yj().url(),SUPABASE_SERVICE_ROLE_KEY:o.Yj().min(1),SUPABASE_JWT_SECRET:o.Yj().min(1),STRIPE_SECRET_KEY:o.Yj().min(1),STRIPE_WEBHOOK_SECRET:o.Yj().min(1),OPENAI_API_KEY:o.Yj().min(1),REPLICATE_API_TOKEN:o.Yj().min(1),DEEPSEEK_API_KEY:o.Yj().min(1).optional(),CLAUDE_API_KEY:o.Yj().min(1).optional(),ELEVENLABS_API_KEY:o.Yj().min(1).optional(),BLOB_READ_WRITE_TOKEN:o.Yj().min(1),APP_ENV:o.k5(["development","production","test"]).default("development"),ALLOWED_ORIGINS:o.Yj().default("*")},client:{NEXT_PUBLIC_APP_URL:o.Yj().url(),NEXT_PUBLIC_SUPABASE_URL:o.Yj().url(),NEXT_PUBLIC_SUPABASE_ANON_KEY:o.Yj().min(1),NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:o.Yj().min(1),NEXT_PUBLIC_STRIPE_PRICE_STARTER_PASS:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_PRO_MONTHLY:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_PRO_YEARLY:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_CREATOR_MONTHLY:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_CREATOR_YEARLY:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_STUDIO_MONTHLY:o.Yj().min(1).optional(),NEXT_PUBLIC_STRIPE_PRICE_STUDIO_YEARLY:o.Yj().min(1).optional()},runtimeEnv:{SUPABASE_URL:process.env.SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:process.env.SUPABASE_SERVICE_ROLE_KEY,SUPABASE_JWT_SECRET:process.env.SUPABASE_JWT_SECRET,STRIPE_SECRET_KEY:process.env.STRIPE_SECRET_KEY,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET,OPENAI_API_KEY:process.env.OPENAI_API_KEY,REPLICATE_API_TOKEN:process.env.REPLICATE_API_TOKEN,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,CLAUDE_API_KEY:process.env.CLAUDE_API_KEY,ELEVENLABS_API_KEY:process.env.ELEVENLABS_API_KEY,BLOB_READ_WRITE_TOKEN:process.env.BLOB_READ_WRITE_TOKEN,APP_ENV:process.env.APP_ENV,ALLOWED_ORIGINS:process.env.ALLOWED_ORIGINS,NEXT_PUBLIC_APP_URL:"https://smart4technology.com",NEXT_PUBLIC_SUPABASE_URL:"https://iqcwwufogdoaiuzyqney.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,NEXT_PUBLIC_STRIPE_PRICE_STARTER_PASS:"price_1RiUVxL0i8aKDQ0rtsV8jP",NEXT_PUBLIC_STRIPE_PRICE_PRO_MONTHLY:"price_1ReF56L0i8aKDQ0rZzEwTzVD",NEXT_PUBLIC_STRIPE_PRICE_PRO_YEARLY:"price_1ReF6DL0i8aKDQ0rV0VJ7tx8",NEXT_PUBLIC_STRIPE_PRICE_CREATOR_MONTHLY:"price_1ReF9hL0i8aKDQ0riUb3x64F",NEXT_PUBLIC_STRIPE_PRICE_CREATOR_YEARLY:"price_1ReFAZL0i8aKDQ0rXHYNfLbw",NEXT_PUBLIC_STRIPE_PRICE_STUDIO_MONTHLY:"price_1ReFCML0i8aKDQ0rwmFoSEZP",NEXT_PUBLIC_STRIPE_PRICE_STUDIO_YEARLY:"price_1ReFGlL0i8aKDQ0riqTF84UA"},skipValidation:!!process.env.SKIP_ENV_VALIDATION,emptyStringAsUndefined:!0})},73024:e=>{"use strict";e.exports=require("node:fs")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=i?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(s,n,a):s[n]=e[n]}return s.default=e,r&&r.set(e,s),s}(r(61120));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}let i={current:null},n="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function c(e){return function(...t){a(e(...t))}}n(e=>{try{a(i.current)}finally{i.current=null}})},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},84164:(e,t,r)=>{"use strict";function s(e){if(!e||"string"!=typeof e.narration||!Array.isArray(e.scenes)||e.scenes.length<8)return!1;for(let t=0;t<e.scenes.length;t++){let r=e.scenes[t];if("number"!=typeof r.scene_number||"string"!=typeof r.function||"string"!=typeof r.timestamp||"string"!=typeof r.visual||"string"!=typeof r.audio||"string"!=typeof r.overlay||"string"!=typeof r.transition||"string"!=typeof r.text_on_screen||r.scene_number!==t+1)return!1;r.function.toLowerCase().includes("escalation"),r.scene_number}let t=e.scenes.map(e=>e.function.toLowerCase());return!!(t.some(e=>e.includes("hook"))&&t.some(e=>e.includes("climax"))&&t.some(e=>e.includes("resolution")||e.includes("cta")))}r.d(t,{j:()=>s})},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,2289,4999,1746],()=>r(16965));module.exports=s})();