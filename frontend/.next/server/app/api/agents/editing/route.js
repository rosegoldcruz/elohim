(()=>{var e={};e.id=3125,e.ids=[3125],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},13440:e=>{"use strict";e.exports=require("util/types")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54287:e=>{"use strict";e.exports=require("console")},55511:e=>{"use strict";e.exports=require("crypto")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},62841:(e,t,r)=>{"use strict";r.d(t,{_:()=>p});var s=r(79646),i=r(28354),o=r(33873),a=r.n(o),n=r(79748),l=r.n(n),c=r(97478);let u=(0,i.promisify)(s.exec);class p{async editVideo(e){console.log("\uD83C\uDFAC AEON EditingAgent: Starting production pipeline...");let t=Date.now();try{this.validateRequest(e),await this.setupTempDirectory();let r=await this.downloadClips(e.videoClips),s="",i="";e.bgmUrl&&(s=await this.downloadFile(e.bgmUrl,"bgm.mp3")),e.avatarOverlayUrl&&(i=await this.downloadFile(e.avatarOverlayUrl,"avatar.png"));let o=await this.processVideo(e,r,s,i),a=await this.uploadResult(o);await this.cleanup();let n=Date.now()-t;return console.log(`‚úÖ EditingAgent: Video processed successfully in ${n}ms`),a}catch(e){throw console.error("‚ùå EditingAgent error:",e),Error(`Video editing failed: ${e instanceof Error?e.message:"Unknown error"}`)}}validateRequest(e){if(!e.videoClips||0===e.videoClips.length)throw Error("At least one video clip is required");if(e.videoClips.length>20)throw Error("Maximum 20 video clips allowed");if(!["crossfade","cut","slide"].includes(e.transitions))throw Error("Invalid transition type");if(e.aspectRatio&&!["9:16","1:1","16:9"].includes(e.aspectRatio))throw Error("Invalid aspect ratio")}async setupTempDirectory(){try{await l().mkdir(this.tempDir,{recursive:!0}),console.log(`üìÅ Created temp directory: ${this.tempDir}`)}catch(e){throw Error(`Failed to create temp directory: ${e instanceof Error?e.message:"Unknown error"}`)}}async downloadClips(e){console.log(`üì• Downloading ${e.length} video clips...`);let t=[];for(let r=0;r<e.length;r++){let s=e[r],i=`clip_${r}.mp4`,o=await this.downloadFile(s,i);t.push(o)}return console.log(`‚úÖ Downloaded all clips successfully`),t}async downloadFile(e,t){let r=a().join(this.tempDir,t);try{console.log(`üì• Downloading: ${e}`);let s=await fetch(e);if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let i=await s.arrayBuffer();await l().writeFile(r,Buffer.from(i));let o=await l().stat(r);if(0===o.size)throw Error("Downloaded file is empty");return console.log(`‚úÖ Downloaded: ${t} (${o.size} bytes)`),r}catch(t){throw console.error(`‚ùå Download failed for ${e}:`,t),Error(`Failed to download ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}}async processVideo(e,t,r,s){console.log("\uD83C\uDFAC Building FFmpeg command...");let i=a().join(this.tempDir,`aeon_final_${Date.now()}.mp4`),o=this.aspectRatioConfigs[e.aspectRatio||"16:9"],n=this.buildFilterComplex(e,t,!!r,!!s,o),c=[];t.forEach(e=>{c.push(`-i "${e}"`)}),r&&c.push(`-i "${r}"`),s&&c.push(`-i "${s}"`);let p=["ffmpeg",...c,"-filter_complex",`"${n}"`,'-map "[vout]"','-map "[aout]"',"-c:v libx264","-pix_fmt yuv420p","-r 30",`-s ${o.width}x${o.height}`,"-c:a aac","-b:a 128k","-shortest","-movflags +faststart","-y",`"${i}"`].join(" ");console.log("\uD83D\uDE80 Executing FFmpeg command..."),console.log(`Command preview: ${p.substring(0,200)}...`);try{let{stdout:e,stderr:t}=await u(p,{maxBuffer:0xa00000});t&&console.log("FFmpeg stderr:",t.substring(0,500));let r=await l().stat(i);if(0===r.size)throw Error("Output video file is empty");return console.log(`‚úÖ Video processed successfully: ${r.size} bytes`),i}catch(e){throw console.error("‚ùå FFmpeg execution failed:",e),Error(`Video processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}}buildFilterComplex(e,t,r,s,i){let o=[],a=t.length;for(let t=0;t<a;t++){let r=`[${t}:v]scale=${i.scale},setsar=1`;e.fadeInOut&&(0===t&&(r+=",fade=t=in:st=0:d=0.5"),t===a-1&&(r+=",fade=t=out:st=4.5:d=0.5")),o.push(`${r}[v${t}]`)}let n=this.buildTransitions(e,a,o);if(e.addCaptions){let t=this.buildCaptionText(e.scenePlan);o.push(`[${n}]drawtext=text='${t}':fontsize=40:fontcolor=white:x=(w-tw)/2:y=h-th-50:box=1:boxcolor=black@0.5:boxborderw=5[vcaptions]`),n="vcaptions"}if(e.watermarkText){let t=e.watermarkText.replace(/'/g,"\\'");o.push(`[${n}]drawtext=text='${t}':fontsize=30:fontcolor=white:x=w-tw-20:y=20:box=1:boxcolor=black@0.7:boxborderw=3[vwatermark]`),n="vwatermark"}if(s){let e=a+ +!!r;o.push(`[${n}][${e}:v]overlay=W-w-30:30[vout]`)}else o.push(`[${n}]copy[vout]`);return this.buildAudioMix(a,r,o),o.join(";")}buildTransitions(e,t,r){if(1===t)return"v0";let s="v0";for(let i=1;i<t;i++){let o=`v${i}`,a=i===t-1?"vtransitions":`vt${i}`;switch(e.transitions){case"crossfade":r.push(`[${s}][${o}]xfade=transition=fade:duration=0.5:offset=${5*i}[${a}]`);break;case"slide":r.push(`[${s}][${o}]xfade=transition=slideright:duration=0.3:offset=${5*i}[${a}]`);break;default:r.push(`[${s}][${o}]concat=n=2:v=1:a=0[${a}]`)}s=a}return s}buildAudioMix(e,t,r){let s=[];for(let t=0;t<e;t++)s.push(`[${t}:a]`);if(t){if(s.length>0){let t=s.join("");r.push(`${t}amix=inputs=${s.length}:duration=shortest[videomix]`),r.push(`[videomix][${e}:a]amix=inputs=2:weights=0.8 0.3:duration=shortest[aout]`)}else r.push(`[${e}:a]copy[aout]`)}else if(s.length>1){let e=s.join("");r.push(`${e}amix=inputs=${s.length}:duration=shortest[aout]`)}else 1===s.length?r.push("[0:a]copy[aout]"):r.push("anullsrc=channel_layout=stereo:sample_rate=48000[aout]")}buildCaptionText(e){return e&&e.scenes&&e.scenes.length>0?(e.scenes[0].narration||"AEON Generated Video").replace(/'/g,"\\'").replace(/"/g,'\\"'):"AEON Generated Video"}async uploadResult(e){console.log("\uD83D\uDCE4 Uploading final video to Vercel Blob...");try{let t=await l().readFile(e),r=`aeon-final-${Date.now()}.mp4`,s=await (0,c.yJ)(r,t,{access:"public",contentType:"video/mp4"});return console.log(`‚úÖ Video uploaded: ${s.url}`),s.url}catch(e){throw console.error("‚ùå Upload failed:",e),Error(`Failed to upload video: ${e instanceof Error?e.message:"Unknown error"}`)}}async cleanup(){try{for(let e of(console.log("\uD83E\uDDF9 Cleaning up temporary files..."),await l().readdir(this.tempDir))){let t=a().join(this.tempDir,e);await l().unlink(t)}console.log("‚úÖ Cleanup completed")}catch(e){console.error("‚ö†Ô∏è Cleanup failed:",e)}}getCapabilities(){return{maxClips:20,supportedTransitions:["crossfade","cut","slide"],supportedAspectRatios:Object.keys(this.aspectRatioConfigs),features:["Video concatenation with transitions","Background music mixing","Avatar overlays","Text watermarks","Basic captions via drawtext","Fade in/out effects","Multiple aspect ratios","H.264 encoding with fast start"]}}constructor(){this.tempDir="./temp/editing",this.aspectRatioConfigs={"9:16":{width:1080,height:1920,scale:"1080:1920"},"1:1":{width:1080,height:1080,scale:"1080:1080"},"16:9":{width:1920,height:1080,scale:"1920:1080"}}}}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74998:e=>{"use strict";e.exports=require("perf_hooks")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},82637:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>c});var i=r(96559),o=r(48088),a=r(37719),n=r(32190),l=r(62841);async function c(e){try{let t=await e.json();if(!t.videoClips||!Array.isArray(t.videoClips)||0===t.videoClips.length)return n.NextResponse.json({error:"videoClips array is required and must not be empty"},{status:400});let r={videoClips:t.videoClips,scenePlan:t.scenePlan,bgmUrl:t.bgmUrl,avatarOverlayUrl:t.avatarOverlayUrl,transitions:t.transitions||"cut",fadeInOut:t.fadeInOut||!1,watermarkText:t.watermarkText,addCaptions:t.addCaptions||!1,aspectRatio:t.aspectRatio||"16:9"};console.log(`üé¨ EditingAgent API: Processing ${r.videoClips.length} clips`);let s=new l._,i=await s.editVideo(r);return console.log(`‚úÖ EditingAgent API: Video processed successfully`),n.NextResponse.json({success:!0,final_video_url:i,metadata:{clips_processed:r.videoClips.length,transitions:r.transitions,aspect_ratio:r.aspectRatio,has_bgm:!!r.bgmUrl,has_avatar:!!r.avatarOverlayUrl,has_captions:r.addCaptions,has_watermark:!!r.watermarkText}})}catch(e){return console.error("‚ùå EditingAgent API error:",e),n.NextResponse.json({error:"Video editing failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action"),s=new l._;if("capabilities"===r){let e=s.getCapabilities();return n.NextResponse.json({capabilities:e,timestamp:new Date().toISOString()})}return n.NextResponse.json({message:"AEON EditingAgent API",version:"1.0.0",description:"Production-grade video editing with FFmpeg",endpoints:{"POST /":"Process video editing request","GET /?action=capabilities":"Get editing capabilities"},features:["Video concatenation with transitions","Background music mixing","Avatar overlays","Text watermarks","Basic captions via drawtext","Fade in/out effects","Multiple aspect ratios (9:16, 1:1, 16:9)","H.264 encoding with fast start"],supported_transitions:["crossfade","cut","slide"],max_clips:20})}catch(e){return console.error("‚ùå EditingAgent API GET error:",e),n.NextResponse.json({error:"Failed to process request",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/agents/editing/route",pathname:"/api/agents/editing",filename:"route",bundlePath:"app/api/agents/editing/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\agents\\editing\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:h}=p;function f(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}},84297:e=>{"use strict";e.exports=require("async_hooks")},91645:e=>{"use strict";e.exports=require("net")},94175:e=>{"use strict";e.exports=require("stream/web")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,7478],()=>r(82637));module.exports=s})();