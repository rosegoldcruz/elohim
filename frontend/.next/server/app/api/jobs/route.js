(()=>{var e={};e.id=4622,e.ids=[4622],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23405:e=>{"use strict";e.exports=require("@supabase/ssr")},28086:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var s=r(23405),n=r(44999);let o=()=>{let e=(0,n.UL)();return(0,s.createServerClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){e.set({name:t,value:r,...s})},remove(t,r){e.set({name:t,value:"",...r})}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(s,i,a):s[i]=e[i]}return s.default=e,r&&r.set(e,s),s}(r(61120));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}let o={current:null},i="function"==typeof s.cache?s.cache:e=>e,a=console.warn;function u(e){return function(...t){a(e(...t))}}i(e=>{try{a(o.current)}finally{o.current=null}})},78335:()=>{},87568:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>j,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>p});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),u=r(28086),c=r(72289),l=r(35282);let d=c.Ik({title:c.Yj().min(1).max(100),description:c.Yj().min(1).max(500),style:c.k5(["viral","cinematic","casual","professional"]),duration:c.ai().min(15).max(300),transitions:c.YO(c.Yj()).optional(),music_style:c.Yj().optional()});async function p(e){try{let t=await (0,u.U)(),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let n=await e.json(),o=d.parse(n),{data:i,error:c}=await t.from("users").select("credits").eq("id",r.id).single();if(c)return a.NextResponse.json({error:"Failed to get user profile"},{status:500});let l=100*Math.ceil(o.duration/60);if(i.credits<l)return a.NextResponse.json({error:"Insufficient credits",required:l,available:i.credits},{status:400});let{data:p,error:f}=await t.from("agent_jobs").insert({user_id:r.id,title:o.title,description:o.description,status:"created",job_type:"video_generation",input_data:{style:o.style,duration:o.duration,transitions:o.transitions||[],music_style:o.music_style},credits_cost:l}).select().single();if(f)return a.NextResponse.json({error:"Failed to create job"},{status:500});let{error:j}=await t.from("users").update({credits:i.credits-l}).eq("id",r.id);if(j)return await t.from("agent_jobs").delete().eq("id",p.id),a.NextResponse.json({error:"Failed to deduct credits"},{status:500});return a.NextResponse.json({success:!0,job:p,credits_remaining:i.credits-l})}catch(e){if(console.error("Job creation error:",e),e instanceof l.G)return a.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){try{let t=await (0,u.U)(),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),o=parseInt(n.get("limit")||"10"),i=parseInt(n.get("offset")||"0"),{data:c,error:l}=await t.from("agent_jobs").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).range(i,i+o-1);if(l)return a.NextResponse.json({error:"Failed to fetch jobs"},{status:500});return a.NextResponse.json({jobs:c})}catch(e){return console.error("Jobs fetch error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let j=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\jobs\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:y}=j;function g(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,2289,4999],()=>r(87568));module.exports=s})();