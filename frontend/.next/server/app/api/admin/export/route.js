"use strict";(()=>{var e={};e.id=5980,e.ids=[5980],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},23405:e=>{e.exports=require("@supabase/ssr")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37366:e=>{e.exports=require("dns")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73038:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>v,serverHooks:()=>h,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>S});var a={};r.r(a),r.d(a,{GET:()=>m,OPTIONS:()=>g});var o=r(96559),s=r(48088),n=r(37719),i=r(32190),u=r(15637),l=r(72289),p=r(35282);let d=l.Ik({type:l.k5(["transactions","revenue","creators","full_report"]).default("transactions"),format:l.k5(["csv","json","xlsx"]).default("csv"),startDate:l.Yj(),endDate:l.Yj(),includeMetadata:l.au.boolean().default(!0)});async function c(e){return(process.env.ADMIN_USER_IDS?.split(",")||[]).includes(e)}async function m(e){try{let{userId:t}=auth();if(!t)return i.NextResponse.json({error:"Authentication required"},{status:401});if(!await c(t))return i.NextResponse.json({error:"Admin access required"},{status:403});let{searchParams:r}=new URL(e.url),a={type:r.get("type"),format:r.get("format"),startDate:r.get("startDate"),endDate:r.get("endDate"),includeMetadata:r.get("includeMetadata")},{type:o,format:s,startDate:n,endDate:u,includeMetadata:l}=d.parse(a);if(!n||!u)return i.NextResponse.json({error:"Start date and end date are required"},{status:400});let p=new Date(n),m=new Date(u);if(p>=m)return i.NextResponse.json({error:"Start date must be before end date"},{status:400});let g=`${p.toISOString().split("T")[0]}_to_${m.toISOString().split("T")[0]}`,v=`aeon_${o}_${g}.${s}`,w=null,S="application/json",h={};switch(o){case"transactions":w=await x(n,u,s,l);break;case"revenue":w=await _(n,u,s,l);break;case"creators":w=await y(s,l);break;case"full_report":w=await f(n,u,s,l);break;default:return i.NextResponse.json({error:"Invalid export type"},{status:400})}return S="csv"===s?"text/csv":"xlsx"===s?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/json",h["Content-Disposition"]=`attachment; filename="${v}"`,console.log(`Admin ${t} exported ${o} data (${s}) for period ${n} to ${u}`),new i.NextResponse(w,{headers:{"Content-Type":S,...h}})}catch(e){if(console.error("Admin export API error:",e),e instanceof p.G)return i.NextResponse.json({error:"Invalid query parameters",details:e.errors},{status:400});return i.NextResponse.json({error:"Failed to export data",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function x(e,t,r,a){let o=await u.B.exportTransactionData(e,t,r);return"json"===r&&a?JSON.stringify({metadata:{export_type:"transactions",period:{startDate:e,endDate:t},generated_at:new Date().toISOString(),record_count:Array.isArray(o)?o.length:0},data:o},null,2):"json"===r?JSON.stringify(o,null,2):o}async function _(e,t,r,a){let[o,s]=await Promise.all([u.B.getPlatformRevenue(e,t),u.B.getDailySummaries(30)]),n={revenue_summary:o,daily_breakdown:s};return"csv"===r?["# Revenue Summary","Date,Gross Revenue,Net Revenue,Royalties Paid,Payouts Processed,Platform Fees,Active Creators,Total Transactions",[new Date().toISOString().split("T")[0],o.gross_revenue,o.net_revenue,o.total_royalties_paid,o.total_payouts_processed,o.platform_fees_collected,o.active_creators,o.total_transactions].join(","),"","# Daily Breakdown","Date,Purchases,Royalties,Payouts,Net Flow,Transaction Count",...s.map(e=>[e.date,e.purchases,e.royalties,e.payouts,e.net_flow,e.transaction_count].join(","))].join("\n"):JSON.stringify(a?{metadata:{export_type:"revenue",period:{startDate:e,endDate:t},generated_at:new Date().toISOString()},...n}:n,null,2)}async function y(e,t){let r=await u.B.getTopCreators(100);return"csv"===e?["Creator ID,Email,Total Earnings,Total Payouts,Pending Balance,Payout Method,Status,Created At,Last Payout Date",...r.map(e=>[e.creator_id,e.creator_email||"",e.total_earnings,e.total_payouts,e.pending_balance,e.payout_method,e.status,e.created_at,e.last_payout_date||""].join(","))].join("\n"):JSON.stringify(t?{metadata:{export_type:"creators",generated_at:new Date().toISOString(),total_creators:r.length},data:r}:r,null,2)}async function f(e,t,r,a){let[o,s,n,i]=await Promise.all([u.B.getPlatformRevenue(e,t),u.B.getTopCreators(50),u.B.getDailySummaries(30),u.B.getPlatformHealth()]),l={revenue:o,top_creators:s,daily_summaries:n,platform_health:i};return"csv"===r?["# AEON Platform Full Report",`# Generated: ${new Date().toISOString()}`,`# Period: ${e} to ${t}`,"","# Revenue Summary","Metric,Value",`Gross Revenue,${o.gross_revenue}`,`Net Revenue,${o.net_revenue}`,`Royalties Paid,${o.total_royalties_paid}`,`Payouts Processed,${o.total_payouts_processed}`,`Platform Fees,${o.platform_fees_collected}`,`Active Creators,${o.active_creators}`,"","# Top Creators","Creator ID,Email,Total Earnings,Status",...s.slice(0,20).map(e=>`${e.creator_id},${e.creator_email||""},${e.total_earnings},${e.status}`)].join("\n"):JSON.stringify(a?{metadata:{export_type:"full_report",period:{startDate:e,endDate:t},generated_at:new Date().toISOString()},...l}:l,null,2)}async function g(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let v=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/admin/export/route",pathname:"/api/admin/export",filename:"route",bundlePath:"app/api/admin/export/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\admin\\export\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:S,serverHooks:h}=v;function P(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:S})}},74075:e=>{e.exports=require("zlib")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},79748:e=>{e.exports=require("fs/promises")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,2289,9526,1563,9157,5637],()=>r(73038));module.exports=a})();