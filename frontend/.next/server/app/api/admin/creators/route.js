"use strict";(()=>{var e={};e.id=9389,e.ids=[9389],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{e.exports=require("os")},23405:e=>{e.exports=require("@supabase/ssr")},27910:e=>{e.exports=require("stream")},28086:(e,t,r)=>{r.d(t,{U:()=>s});var a=r(23405),n=r(44999);let s=()=>{let e=(0,n.UL)();return(0,a.createServerClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){e.set({name:t,value:r,...a})},remove(t,r){e.set({name:t,value:"",...r})}}})}},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37366:e=>{e.exports=require("dns")},39727:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>j,routeModule:()=>v,serverHooks:()=>b,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>k});var a={};r.r(a),r.d(a,{GET:()=>m,OPTIONS:()=>w,POST:()=>y,getCreatorDetails:()=>_});var n=r(96559),s=r(48088),i=r(37719),o=r(32190),u=r(28086),l=r(15637),c=r(72435),d=r(72289),p=r(35282);let g=d.Ik({limit:d.au.number().min(1).max(100).default(20),sortBy:d.k5(["earnings","payouts","balance","created_at"]).default("earnings"),order:d.k5(["asc","desc"]).default("desc"),includeAnalytics:d.au.boolean().default(!1),riskAssessment:d.au.boolean().default(!1)}),h=d.Ik({creatorId:d.Yj().uuid(),action:d.k5(["suspend","activate","investigate","clear_flags"]),reason:d.Yj().optional(),notes:d.Yj().optional()});async function f(e){return(process.env.ADMIN_USER_IDS?.split(",")||[]).includes(e)}async function m(e){try{let t=(0,u.U)(),{data:{user:r},error:a}=await t.auth.getUser();if(!r)return o.NextResponse.json({error:"Authentication required"},{status:401});if(!await f(r.id))return o.NextResponse.json({error:"Admin access required"},{status:403});let{searchParams:n}=new URL(e.url),s={limit:n.get("limit"),sortBy:n.get("sortBy"),order:n.get("order"),includeAnalytics:n.get("includeAnalytics"),riskAssessment:n.get("riskAssessment")},{limit:i,sortBy:d,order:p,includeAnalytics:h,riskAssessment:m}=g.parse(s),y=await l.B.getTopCreators(i),_=null;if(h||m){let e=await l.B.getRecentTransactions(2e3);if(h){let t=c.R.analyzeCreatorPatterns(e);_={patterns:t.slice(0,i),summary:{total_creators:t.length,high_volatility:t.filter(e=>e.volatility_score>.5).length,trending_up:t.filter(e=>"up"===e.trend_direction).length,trending_down:t.filter(e=>"down"===e.trend_direction).length,stable:t.filter(e=>"stable"===e.trend_direction).length}}}if(m){let t=y.map(t=>c.R.assessFraudRisk(t.creator_id,e));t={assessments:t,summary:{high_risk:t.filter(e=>e.risk_score>50).length,medium_risk:t.filter(e=>e.risk_score>30&&e.risk_score<=50).length,low_risk:t.filter(e=>e.risk_score<=30).length,requires_investigation:t.filter(e=>"investigate"===e.recommended_action).length,requires_suspension:t.filter(e=>"suspend"===e.recommended_action).length}}}}return"earnings"!==d&&y.sort((e,t)=>{let r=e[d]||0,a=t[d]||0;return"desc"===p?a-r:r-a}),o.NextResponse.json({success:!0,data:{creators:y,analytics:_,risk_assessments:null,metadata:{total_returned:y.length,sorted_by:d,order:p,generated_at:new Date().toISOString()}}})}catch(e){if(console.error("Admin creators API error:",e),e instanceof p.G)return o.NextResponse.json({error:"Invalid query parameters",details:e.errors},{status:400});return o.NextResponse.json({error:"Failed to fetch creator data",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function y(e){try{let t=(0,u.U)(),{data:{user:r},error:a}=await t.auth.getUser();if(!r)return o.NextResponse.json({error:"Authentication required"},{status:401});if(!await f(r.id))return o.NextResponse.json({error:"Admin access required"},{status:403});let n=await e.json(),{creatorId:s,action:i,reason:l,notes:c}=h.parse(n);console.log(`Admin ${r.id} performed action ${i} on creator ${s}`,{reason:l,notes:c,timestamp:new Date().toISOString()});let d=null;switch(i){case"suspend":d={message:"Creator suspended successfully"};break;case"activate":d={message:"Creator activated successfully"};break;case"investigate":d={message:"Creator flagged for investigation"};break;case"clear_flags":d={message:"Investigation flags cleared"};break;default:return o.NextResponse.json({error:"Invalid action"},{status:400})}return o.NextResponse.json({success:!0,data:{action_performed:i,creator_id:s,result:d,performed_by:r.id,performed_at:new Date().toISOString()}})}catch(e){if(console.error("Admin creator action API error:",e),e instanceof p.G)return o.NextResponse.json({error:"Invalid request data",details:e.errors},{status:400});return o.NextResponse.json({error:"Failed to perform admin action",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function _(e,t){try{if(!await f(t))throw Error("Admin access required");let r=await l.B.getCreatorPerformance(e),a=await l.B.getRecentTransactions(500,void 0,e),n=c.R.assessFraudRisk(e,a),s=c.R.analyzeCreatorPatterns(a).find(t=>t.creator_id===e);return{creator_id:e,performance:r,risk_assessment:n,pattern_analysis:s,recent_transactions:a.slice(0,20),generated_at:new Date().toISOString()}}catch(e){throw console.error("Error getting creator details:",e),e}}async function w(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let v=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/admin/creators/route",pathname:"/api/admin/creators",filename:"route",bundlePath:"app/api/admin/creators/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\admin\\creators\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:x,workUnitAsyncStorage:k,serverHooks:b}=v;function j(){return(0,i.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:k})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72435:(e,t,r)=>{r.d(t,{R:()=>a});class a{static detectAnomalies(e){let t=[];for(let[r,a]of Object.entries(this.groupTransactionsByCreator(e))){let e=a.filter(e=>e.amount>1e3&&"royalty"===e.transaction_type);e.length>0&&t.push({id:`large_tx_${r}_${Date.now()}`,type:"large_transaction",severity:e[0].amount>5e3?"high":"medium",description:`Creator ${r} received ${e.length} large transaction(s)`,affected_entity:r,amount:Math.max(...e.map(e=>e.amount)),detected_at:new Date().toISOString(),status:"new"});let n=a.filter(e=>"payout"===e.transaction_type).filter(e=>new Date(e.created_at)>new Date(Date.now()-864e5));n.length>3&&t.push({id:`rapid_payout_${r}_${Date.now()}`,type:"rapid_payouts",severity:"medium",description:`Creator ${r} made ${n.length} payouts in 24 hours`,affected_entity:r,detected_at:new Date().toISOString(),status:"new"});let s=a.filter(e=>"royalty"===e.transaction_type);if(s.length>0){let e=s.reduce((e,t)=>e+t.amount,0)/s.length;s.filter(t=>t.amount>5*e).length>0&&t.push({id:`unusual_pattern_${r}_${Date.now()}`,type:"unusual_pattern",severity:"low",description:`Creator ${r} has earnings significantly above average`,affected_entity:r,detected_at:new Date().toISOString(),status:"new"})}}return t}static analyzeCreatorPatterns(e){let t=this.groupTransactionsByCreator(e),r=[];for(let[e,a]of Object.entries(t)){let t=a.filter(e=>"royalty"===e.transaction_type);if(0===t.length)continue;t.reduce((e,t)=>e+t.amount,0);let n=this.groupByDate(t),s=this.groupByWeek(t),i=this.groupByMonth(t),o=Object.values(n).reduce((e,t)=>e+t.reduce((e,t)=>e+t.amount,0),0)/Object.keys(n).length,u=Object.values(s).reduce((e,t)=>e+t.reduce((e,t)=>e+t.amount,0),0)/Object.keys(s).length,l=Object.values(i).reduce((e,t)=>e+t.reduce((e,t)=>e+t.amount,0),0)/Object.keys(i).length,c=Object.values(n).map(e=>e.reduce((e,t)=>e+t.amount,0)),d=this.calculateVolatility(c),p=t.slice(-7),g=t.slice(-14,-7),h=p.reduce((e,t)=>e+t.amount,0)/p.length,f=g.reduce((e,t)=>e+t.amount,0)/g.length,m="stable";h>1.1*f?m="up":h<.9*f&&(m="down");let y=t.filter(e=>e.amount>3*o),_=y.length/t.length,w=y.length>0?y[y.length-1].created_at:void 0;r.push({creator_id:e,daily_average:o,weekly_average:u,monthly_average:l,volatility_score:d,trend_direction:m,last_spike_date:w,spike_frequency:_})}return r}static generateInsights(e,t){let r=[],a=e.filter(e=>"purchase"===e.transaction_type).reduce((e,t)=>e+t.amount,0),n=e.filter(e=>"royalty"===e.transaction_type).reduce((e,t)=>e+t.amount,0),s=a>0?n/a*100:0;s>30&&r.push({type:"risk_factor",title:"High Royalty Rate",description:`Platform is paying ${s.toFixed(1)}% in royalties, which may impact profitability`,impact:"high",recommended_action:"Consider adjusting royalty rates or platform fees",data_points:[{royalty_rate:s,total_revenue:a}]});let i=t.filter(e=>"up"===e.trend_direction&&e.monthly_average>100).sort((e,t)=>t.monthly_average-e.monthly_average).slice(0,5);i.length>0&&r.push({type:"growth_opportunity",title:"Rising Star Creators",description:`${i.length} creators showing strong upward trends`,impact:"medium",recommended_action:"Consider featuring these creators or offering incentives",data_points:i});let o=t.filter(e=>e.volatility_score>.5);return o.length>.2*t.length&&r.push({type:"risk_factor",title:"High Creator Volatility",description:`${o.length} creators have highly volatile earnings`,impact:"medium",recommended_action:"Investigate causes of volatility and consider stabilization measures",data_points:o}),r}static assessFraudRisk(e,t){let r=t.filter(t=>t.creator_id===e),a=0,n=[],s=[],i=this.getAccountAge(r),o=r.filter(e=>"royalty"===e.transaction_type).reduce((e,t)=>e+t.amount,0);i<7&&o>500&&(a+=30,n.push("New account with high immediate earnings"));let u=r.filter(e=>"payout"===e.transaction_type).filter(e=>new Date(e.created_at)>new Date(Date.now()-864e5));u.length>2&&(a+=20,n.push("Multiple rapid payouts"),s.push(...u)),r.filter(e=>e.amount%100==0&&e.amount>100).length>.5*r.length&&(a+=15,n.push("High frequency of round-number transactions"));let l="clear";return a>50?l="suspend":a>30?l="investigate":a>15&&(l="monitor"),{creator_id:e,risk_score:Math.min(a,100),indicators:n,suspicious_transactions:s,recommended_action:l}}static groupTransactionsByCreator(e){return e.reduce((e,t)=>{let r=t.creator_id||"unknown";return e[r]||(e[r]=[]),e[r].push(t),e},{})}static groupByDate(e){return e.reduce((e,t)=>{let r=new Date(t.created_at).toISOString().split("T")[0];return e[r]||(e[r]=[]),e[r].push(t),e},{})}static groupByWeek(e){return e.reduce((e,t)=>{let r=new Date(t.created_at),a=`${r.getFullYear()}-W${Math.ceil(r.getDate()/7)}`;return e[a]||(e[a]=[]),e[a].push(t),e},{})}static groupByMonth(e){return e.reduce((e,t)=>{let r=new Date(t.created_at),a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;return e[a]||(e[a]=[]),e[a].push(t),e},{})}static calculateVolatility(e){if(e.length<2)return 0;let t=e.reduce((e,t)=>e+t,0)/e.length,r=Math.sqrt(e.reduce((e,r)=>e+Math.pow(r-t,2),0)/e.length);return t>0?r/t:0}static getAccountAge(e){if(0===e.length)return 0;let t=e.reduce((e,t)=>new Date(t.created_at)<new Date(e.created_at)?t:e);return Math.floor((Date.now()-new Date(t.created_at).getTime())/864e5)}}},74075:e=>{e.exports=require("zlib")},76926:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=s?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}(r(61120));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}let s={current:null},i="function"==typeof a.cache?a.cache:e=>e,o=console.warn;function u(e){return function(...t){o(e(...t))}}i(e=>{try{o(s.current)}finally{s.current=null}})},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},79748:e=>{e.exports=require("fs/promises")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,2289,4999,9526,1563,9157,5637],()=>r(39727));module.exports=a})();