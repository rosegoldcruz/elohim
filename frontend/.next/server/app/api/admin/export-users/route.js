(()=>{var e={};e.id=9803,e.ids=[9803],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23405:e=>{"use strict";e.exports=require("@supabase/ssr")},28086:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var n=r(23405),s=r(44999);let a=()=>{let e=(0,s.UL)();return(0,n.createServerClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs",{cookies:{get:t=>e.get(t)?.value,set(t,r,n){e.set({name:t,value:r,...n})},remove(t,r){e.set({name:t,value:"",...r})}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(61120));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let a={current:null},i="function"==typeof n.cache?n.cache:e=>e,o=console.warn;function u(e){return function(...t){o(e(...t))}}i(e=>{try{o(a.current)}finally{a.current=null}})},78335:()=>{},78423:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>_,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>l,POST:()=>c});var s=r(96559),a=r(48088),i=r(37719),o=r(32190),u=r(28086);async function l(e){try{let t=(0,u.U)(),{data:{user:r},error:n}=await t.auth.getUser();if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});if(!(process.env.ADMIN_USER_IDS?.split(",")||[]).includes(r.id))return o.NextResponse.json({error:"Forbidden"},{status:403});let{searchParams:s}=new URL(e.url),a=s.get("format")||"csv",i="true"===s.get("marketing_only"),l=t.from("users").select(`
        id,
        email,
        first_name,
        last_name,
        full_name,
        birthday,
        marketing_consent,
        subscription_tier,
        subscription_status,
        credits,
        login_count,
        last_login_at,
        created_at
      `);i&&(l=l.eq("marketing_consent",!0));let{data:c,error:p}=await l.order("created_at",{ascending:!1});if(p)return o.NextResponse.json({error:"Failed to fetch users"},{status:500});if("csv"===a){let e=c?.map(e=>{let t=e.birthday?new Date(e.birthday):null,r=t?Math.floor((Date.now()-t.getTime())/(365.25*24*60*60*1e3)):null,n=new Date(e.created_at),s=Math.floor((Date.now()-n.getTime())/(24*60*60*1e3));return[e.id,e.email,e.first_name||"",e.last_name||"",e.full_name||"",t?t.toISOString().split("T")[0]:"",r||"",e.marketing_consent?"Yes":"No",e.subscription_tier||"",e.subscription_status||"",e.credits||0,e.login_count||0,e.last_login_at?new Date(e.last_login_at).toISOString():"",n.toISOString(),s]})||[],t=["ID,Email,First Name,Last Name,Full Name,Birthday,Age,Marketing Consent,Subscription Tier,Subscription Status,Credits,Login Count,Last Login,Signup Date,Days Since Signup",...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),r=i?`aeon-marketing-users-${new Date().toISOString().split("T")[0]}.csv`:`aeon-all-users-${new Date().toISOString().split("T")[0]}.csv`;return new o.NextResponse(t,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${r}"`}})}return o.NextResponse.json({users:c?.map(e=>({...e,age:e.birthday?Math.floor((Date.now()-new Date(e.birthday).getTime())/(365.25*24*60*60*1e3)):null,days_since_signup:Math.floor((Date.now()-new Date(e.created_at).getTime())/(24*60*60*1e3))})),total:c?.length||0,marketing_opted_in:c?.filter(e=>e.marketing_consent).length||0,exported_at:new Date().toISOString()})}catch(e){return console.error("Export users error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let t=(0,u.U)(),{data:{user:r},error:n}=await t.auth.getUser();if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});if(!(process.env.ADMIN_USER_IDS?.split(",")||[]).includes(r.id))return o.NextResponse.json({error:"Forbidden"},{status:403});if((await e.json()).analytics){let{data:e}=await t.from("users").select("birthday, marketing_consent, subscription_tier, created_at, login_count"),r=new Date,n={total_users:e?.length||0,marketing_opted_in:e?.filter(e=>e.marketing_consent).length||0,paid_users:e?.filter(e=>"free_trial"!==e.subscription_tier).length||0,age_groups:{},signup_trends:{},engagement_stats:{avg_logins:e?.reduce((e,t)=>e+(t.login_count||0),0)/(e?.length||1),active_users:e?.filter(e=>e.login_count>0).length||0}};return e?.forEach(e=>{if(e.birthday){let t=Math.floor((r.getTime()-new Date(e.birthday).getTime())/(365.25*24*60*60*1e3)),s="65+";t<18?s="Under 18":t<=24?s="18-24":t<=34?s="25-34":t<=44?s="35-44":t<=54?s="45-54":t<=64&&(s="55-64"),n.age_groups[s]=(n.age_groups[s]||0)+1}}),e?.forEach(e=>{let t=new Date(e.created_at);if(30>=Math.floor((r.getTime()-t.getTime())/(24*60*60*1e3))){let e=t.toISOString().split("T")[0];n.signup_trends[e]=(n.signup_trends[e]||0)+1}}),o.NextResponse.json(n)}return o.NextResponse.json({error:"Invalid request"},{status:400})}catch(e){return console.error("Analytics error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/export-users/route",pathname:"/api/admin/export-users",filename:"route",bundlePath:"app/api/admin/export-users/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\admin\\export-users\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:_}=p;function f(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4447,580,4999],()=>r(78423));module.exports=n})();