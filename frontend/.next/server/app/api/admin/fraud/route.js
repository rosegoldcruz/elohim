(()=>{var e={};e.id=1584,e.ids=[1584],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19115:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var a=r(63874);class n{static{this.DEFAULT_RULES=[{id:"large_single_transaction",name:"Large Single Transaction",description:"Single transaction exceeds threshold",severity:"medium",enabled:!0,threshold:1e3,timeWindow:1,action:"flag"},{id:"rapid_payouts",name:"Rapid Payouts",description:"Multiple payouts in short time period",severity:"high",enabled:!0,threshold:3,timeWindow:24,action:"suspend"},{id:"new_account_high_earnings",name:"New Account High Earnings",description:"New account with unusually high earnings",severity:"high",enabled:!0,threshold:500,timeWindow:168,action:"flag"},{id:"round_number_pattern",name:"Round Number Pattern",description:"High frequency of round number transactions",severity:"low",enabled:!0,threshold:.7,timeWindow:168,action:"flag"},{id:"velocity_spike",name:"Transaction Velocity Spike",description:"Sudden increase in transaction frequency",severity:"medium",enabled:!0,threshold:5,timeWindow:24,action:"flag"}]}async runFraudDetection(){try{console.log("\uD83D\uDD0D Starting fraud detection scan...");let{data:e,error:t}=await this.supabase.from("credit_transactions").select("*").gte("created_at",new Date(Date.now()-6048e5).toISOString()).order("created_at",{ascending:!1});if(t)throw t;let r=[],a=[],n=[],i=this.groupTransactionsByCreator(e||[]);for(let[e,t]of Object.entries(i)){let i=await this.runFraudRules(e,t);r.push(...i);let s=await this.detectSuspiciousActivities(e,t);a.push(...s);let o=await this.calculateFraudScore(e,t);n.push(o)}return console.log(`✅ Fraud detection complete: ${r.length} alerts, ${a.length} suspicious activities`),{alerts:r,suspicious_activities:a,fraud_scores:n}}catch(e){throw console.error("❌ Fraud detection failed:",e),e}}async runFraudRules(e,t){let r=[];for(let a of n.DEFAULT_RULES)if(a.enabled)try{let n=await this.evaluateRule(a,e,t);n&&r.push(n)}catch(e){console.error(`Error evaluating rule ${a.id}:`,e)}return r}async evaluateRule(e,t,r){let a=36e5*e.timeWindow,n=new Date(Date.now()-a),i=r.filter(e=>new Date(e.created_at)>=n);switch(e.id){case"large_single_transaction":let s=i.find(t=>"royalty"===t.transaction_type&&t.amount>e.threshold);if(s)return{id:`${e.id}_${t}_${Date.now()}`,type:"large_transaction",severity:e.severity,description:`Creator received ${s.amount} credits in single transaction`,affected_entity:t,amount:s.amount,detected_at:new Date().toISOString(),status:"new"};break;case"rapid_payouts":let o=i.filter(e=>"payout"===e.transaction_type);if(o.length>=e.threshold)return{id:`${e.id}_${t}_${Date.now()}`,type:"rapid_payouts",severity:e.severity,description:`Creator made ${o.length} payouts in ${e.timeWindow} hours`,affected_entity:t,detected_at:new Date().toISOString(),status:"new"};break;case"new_account_high_earnings":let c=await this.getAccountAge(t);if(c<=7){let r=i.filter(e=>"royalty"===e.transaction_type).reduce((e,t)=>e+t.amount,0);if(r>e.threshold)return{id:`${e.id}_${t}_${Date.now()}`,type:"suspicious_creator",severity:e.severity,description:`New account (${c} days) earned ${r} credits`,affected_entity:t,amount:r,detected_at:new Date().toISOString(),status:"new"}}break;case"round_number_pattern":let u=i.filter(e=>e.amount%100==0&&e.amount>100),d=i.length>0?u.length/i.length:0;if(d>=e.threshold)return{id:`${e.id}_${t}_${Date.now()}`,type:"unusual_pattern",severity:e.severity,description:`${(100*d).toFixed(1)}% of transactions are round numbers`,affected_entity:t,detected_at:new Date().toISOString(),status:"new"};break;case"velocity_spike":let l=await this.calculateNormalVelocity(t),p=i.length/(e.timeWindow/24);if(l>0&&p>l*e.threshold)return{id:`${e.id}_${t}_${Date.now()}`,type:"unusual_pattern",severity:e.severity,description:`Transaction velocity ${p.toFixed(1)}/day vs normal ${l.toFixed(1)}/day`,affected_entity:t,detected_at:new Date().toISOString(),status:"new"}}return null}async detectSuspiciousActivities(e,t){let r=[],a=this.analyzeTimingPatterns(t);a.suspicion_score>.7&&r.push({id:`timing_pattern_${e}_${Date.now()}`,creator_id:e,activity_type:"timing_pattern",description:"Transactions show consistent timing patterns suggesting automation",risk_score:100*a.suspicion_score,evidence:a.evidence,detected_at:new Date().toISOString(),status:"new"});let n=await this.detectCoordinatedActivity(e,t);return n>.6&&r.push({id:`coordination_${e}_${Date.now()}`,creator_id:e,activity_type:"coordinated_activity",description:"Activity patterns suggest coordination with other creators",risk_score:100*n,evidence:[],detected_at:new Date().toISOString(),status:"new"}),r}async calculateFraudScore(e,t){let r=[],a=0,n=await this.getAccountAge(e),i=t.filter(e=>"royalty"===e.transaction_type).reduce((e,t)=>e+t.amount,0),s=30*Math.min((n>0?i/n:0)/50,1);r.push({factor:"account_age_earnings_ratio",score:s,weight:.3}),a+=s;let o=25*this.analyzeTransactionPatterns(t);r.push({factor:"transaction_patterns",score:o,weight:.25}),a+=o;let c=20*this.analyzePayoutBehavior(t);r.push({factor:"payout_behavior",score:c,weight:.2}),a+=c;let u=25*this.analyzeVolumeAnomalies(t);r.push({factor:"volume_anomalies",score:u,weight:.25});let d="low";return(a+=u)>75?d="critical":a>50?d="high":a>25&&(d="medium"),{creator_id:e,overall_score:Math.min(a,100),risk_level:d,contributing_factors:r,last_calculated:new Date().toISOString()}}groupTransactionsByCreator(e){return e.reduce((e,t)=>{let r=t.creator_id||"unknown";return e[r]||(e[r]=[]),e[r].push(t),e},{})}async getAccountAge(e){try{let{data:t}=await this.supabase.from("creator_wallets").select("created_at").eq("creator_id",e).single();if(!t)return 0;let r=Date.now()-new Date(t.created_at).getTime();return Math.floor(r/864e5)}catch{return 0}}async calculateNormalVelocity(e){let t=new Date(Date.now()-2592e6),r=new Date(Date.now()-864e5);try{let{data:a}=await this.supabase.from("credit_transactions").select("created_at").eq("creator_id",e).gte("created_at",t.toISOString()).lt("created_at",r.toISOString());return a?a.length/29:0}catch{return 0}}analyzeTimingPatterns(e){if(e.length<5)return{suspicion_score:0,evidence:[]};let t={};e.forEach(e=>{let r=new Date(e.created_at).getHours();t[r]=(t[r]||0)+1});let r=Object.keys(t).map(Number),a=this.calculateVariance(r);return{suspicion_score:.8*(a<2),evidence:[{hour_distribution:t,variance:a}]}}async detectCoordinatedActivity(e,t){return 0}analyzeTransactionPatterns(e){let t=e.map(e=>e.amount),r=this.calculateVariance(t),a=t.reduce((e,t)=>e+t,0)/t.length;return a>0?Math.min(r/a,1):0}analyzePayoutBehavior(e){let t=e.filter(e=>"payout"===e.transaction_type),r=e.filter(e=>"royalty"===e.transaction_type);if(0===r.length)return 0;let a=0;return t.forEach(e=>{let t=new Date(e.created_at).getTime();r.find(e=>t-new Date(e.created_at).getTime()<36e5)&&a++}),t.length>0?a/t.length:0}analyzeVolumeAnomalies(e){if(e.length<3)return 0;let t=e.map(e=>e.amount),r=t.reduce((e,t)=>e+t,0)/t.length,a=t.filter(e=>e>3*r);return t.length>0?a.length/t.length:0}calculateVariance(e){if(e.length<2)return 0;let t=e.reduce((e,t)=>e+t,0)/e.length;return e.map(e=>Math.pow(e-t,2)).reduce((e,t)=>e+t,0)/e.length}constructor(){this.supabase=(0,a.U)()}}let i=new n},23405:e=>{"use strict";e.exports=require("@supabase/ssr")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33614:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>S,serverHooks:()=>A,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>D});var a={};r.r(a),r.d(a,{GET:()=>_,OPTIONS:()=>v,POST:()=>g,PUT:()=>w});var n=r(96559),i=r(48088),s=r(37719),o=r(32190),c=r(19115),u=r(72289),d=r(35282);let l=u.Ik({scope:u.k5(["all","creator","recent"]).default("recent"),creatorId:u.Yj().uuid().optional(),timeRange:u.k5(["24h","7d","30d"]).default("7d")}),p=u.Ik({alertId:u.Yj(),action:u.k5(["investigate","resolve","false_positive"]),notes:u.Yj().optional()});async function h(e){return(process.env.ADMIN_USER_IDS?.split(",")||[]).includes(e)}async function _(e){try{let{userId:t}=auth();if(!t)return o.NextResponse.json({error:"Authentication required"},{status:401});if(!await h(t))return o.NextResponse.json({error:"Admin access required"},{status:403});let{searchParams:r}=new URL(e.url),a={scope:r.get("scope"),creatorId:r.get("creatorId"),timeRange:r.get("timeRange")},{scope:n,creatorId:i,timeRange:s}=l.parse(a);console.log(`🔍 Running fraud detection scan (scope: ${n}, range: ${s})`);let u=await c.N.runFraudDetection(),d=u;"creator"===n&&i&&(d={alerts:u.alerts.filter(e=>e.affected_entity===i),suspicious_activities:u.suspicious_activities.filter(e=>e.creator_id===i),fraud_scores:u.fraud_scores.filter(e=>e.creator_id===i)});let p={total_alerts:d.alerts.length,critical_alerts:d.alerts.filter(e=>"critical"===e.severity).length,high_risk_creators:d.fraud_scores.filter(e=>"high"===e.risk_level||"critical"===e.risk_level).length,suspicious_activities:d.suspicious_activities.length,avg_fraud_score:d.fraud_scores.length>0?d.fraud_scores.reduce((e,t)=>e+t.overall_score,0)/d.fraud_scores.length:0};return o.NextResponse.json({success:!0,data:{...d,summary:p,scan_info:{scope:n,time_range:s,scanned_at:new Date().toISOString(),scanned_by:t}}})}catch(e){if(console.error("Fraud detection API error:",e),e instanceof d.G)return o.NextResponse.json({error:"Invalid query parameters",details:e.errors},{status:400});return o.NextResponse.json({error:"Failed to run fraud detection",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{let{userId:t}=auth();if(!t)return o.NextResponse.json({error:"Authentication required"},{status:401});if(!await h(t))return o.NextResponse.json({error:"Admin access required"},{status:403});let{action_type:r,...a}=await e.json();switch(r){case"alert_action":return await f(a,t);case"manual_scan":return await y(a,t);case"update_rules":return await m(a,t);default:return o.NextResponse.json({error:"Invalid action type"},{status:400})}}catch(e){return console.error("Fraud action API error:",e),o.NextResponse.json({error:"Failed to perform fraud action",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function f(e,t){let{alertId:r,action:a,notes:n}=p.parse(e);return console.log(`Admin ${t} performed action ${a} on alert ${r}`,{notes:n,timestamp:new Date().toISOString()}),o.NextResponse.json({success:!0,data:{alert_id:r,action_performed:a,performed_by:t,performed_at:new Date().toISOString(),notes:n}})}async function y(e,t){let{target_creator:r,scan_depth:a="standard"}=e;console.log(`Admin ${t} initiated manual fraud scan`,{target_creator:r,scan_depth:a,timestamp:new Date().toISOString()});let n=await c.N.runFraudDetection(),i=n;return r&&(i={alerts:n.alerts.filter(e=>e.affected_entity===r),suspicious_activities:n.suspicious_activities.filter(e=>e.creator_id===r),fraud_scores:n.fraud_scores.filter(e=>e.creator_id===r)}),o.NextResponse.json({success:!0,data:{scan_results:i,scan_info:{type:"manual",target_creator:r,scan_depth:a,initiated_by:t,completed_at:new Date().toISOString()}}})}async function m(e,t){let{rules:r}=e;return console.log(`Admin ${t} updated fraud detection rules`,{rules_count:r?.length||0,timestamp:new Date().toISOString()}),o.NextResponse.json({success:!0,data:{rules_updated:r?.length||0,updated_by:t,updated_at:new Date().toISOString()}})}async function w(e){try{let{userId:t}=auth();if(!t)return o.NextResponse.json({error:"Authentication required"},{status:401});if(!await h(t))return o.NextResponse.json({error:"Admin access required"},{status:403});let{settings:r}=await e.json();return console.log(`Admin ${t} updated fraud detection settings`,{settings:r,timestamp:new Date().toISOString()}),o.NextResponse.json({success:!0,data:{settings_updated:!0,updated_by:t,updated_at:new Date().toISOString()}})}catch(e){return console.error("Fraud settings update error:",e),o.NextResponse.json({error:"Failed to update fraud settings",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function v(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let S=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/fraud/route",pathname:"/api/admin/fraud",filename:"route",bundlePath:"app/api/admin/fraud/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\admin\\fraud\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:I,workUnitAsyncStorage:D,serverHooks:A}=S;function x(){return(0,s.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:D})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63874:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var a=r(23405);let n=()=>(0,a.createBrowserClient)("https://iqcwwufogdoaiuzyqney.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY3d3dWZvZ2RvYWl1enlxbmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNjUwNTIsImV4cCI6MjA2Nzk0MTA1Mn0.3ltBkJWpgrzwu0Rlrdj9LmoNbnk7cki_2B9y1x6HlWs")},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,2289],()=>r(33614));module.exports=a})();