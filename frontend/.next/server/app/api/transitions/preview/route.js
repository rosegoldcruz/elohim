"use strict";(()=>{var e={};e.id=9843,e.ids=[9843],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23405:e=>{e.exports=require("@supabase/ssr")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},94248:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>p});var n=t(96559),i=t(48088),o=t(37719),a=t(32190),u=t(69702);async function p(e){try{let{glslCode:r,name:t}=await e.json();if(!r)return a.NextResponse.json({success:!1,error:"GLSL code is required"},{status:400});let s=await c(r);if(!s.isValid)return a.NextResponse.json({success:!1,error:s.error},{status:400});let n=await l(r,t||"Preview");if(!n.success)return a.NextResponse.json({success:!1,error:n.error},{status:500});return a.NextResponse.json({success:!0,previewUrl:n.previewUrl,thumbnailUrl:n.thumbnailUrl,processingTime:n.processingTime})}catch(e){return console.error("Preview generation failed:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function c(e){if(!e.includes("vec4 transition("))return{isValid:!1,error:"GLSL must contain a transition function: vec4 transition(sampler2D tex1, sampler2D tex2, vec2 uv, float progress)"};for(let r of[/while\s*\(\s*true\s*\)/i,/for\s*\([^)]*;\s*true\s*;/i,/discard/i,/#include/i,/#define.*\n.*#define/i])if(r.test(e))return{isValid:!1,error:"GLSL contains potentially harmful patterns"};if(e.length>1e4)return{isValid:!1,error:"GLSL code too large (max 10,000 characters)"};try{let r=`preview_${Date.now()}`;if(!await u.XL.compileShader(r,e))return{isValid:!1,error:"GLSL compilation failed"};return{isValid:!0}}catch(e){return{isValid:!1,error:`Compilation error: ${e instanceof Error?e.message:"Unknown error"}`}}}async function l(e,r){let t=Date.now();try{let e=`preview_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await new Promise(e=>setTimeout(e,1e3));let r=`/api/transitions/preview/${e}.mp4`,s=`/api/transitions/preview/${e}_thumb.jpg`,n=Date.now()-t;return{success:!0,previewUrl:r,thumbnailUrl:s,processingTime:n}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Preview generation failed"}}}async function d(e,{params:r}){try{let e=r.filename;if(e.endsWith(".mp4"))return new a.NextResponse("Video preview placeholder",{headers:{"Content-Type":"video/mp4","Cache-Control":"public, max-age=3600"}});if(e.endsWith(".jpg"))return new a.NextResponse("Thumbnail placeholder",{headers:{"Content-Type":"image/jpeg","Cache-Control":"public, max-age=3600"}});return a.NextResponse.json({error:"File not found"},{status:404})}catch(e){return console.error("Preview file serving failed:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/transitions/preview/route",pathname:"/api/transitions/preview",filename:"route",bundlePath:"app/api/transitions/preview/route"},resolvedPagePath:"C:\\Users\\Administrator\\Elohim\\frontend\\app\\api\\transitions\\preview\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:v,serverHooks:w}=m;function x(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:v})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,3010],()=>t(94248));module.exports=s})();